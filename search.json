[{"title":"ä¼˜é›…çš„ä¿®æ”¹ä»–äººè´¡çŒ®çš„ Pull Request","url":"/2020/09/19/add-commits-to-others-pr/","content":"\n2019 å¹´ï¼Œæˆ‘åœ¨ Github ä¸Šå¼€æºäº†è‡ªå·±çš„ç¬¬ä¸€ä¸ªå¼€æºé¡¹ç›® [hexo-theme-stun](https://github.com/liuyib/hexo-theme-stun)ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŸºäº Hexo æ¡†æ¶çš„åšå®¢ä¸»é¢˜ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œåœ¨ç»´æŠ¤æœŸé—´ï¼Œæœ‰è®¸å¤š Github ç”¨æˆ·ä¸ºè¿™ä¸ªé¡¹ç›®è´¡çŒ®äº† Pull Requestã€‚\n\n<!-- more -->\n\næœ‰æ—¶ï¼Œä»–äººæå‡ºçš„ Pull Request å¹¶ä¸èƒ½ç›´æ¥è¢«æ¥çº³ï¼Œå¾€å¾€éœ€è¦ä¸€äº›å°çš„è°ƒæ•´ï¼šä¿®æ”¹é”™åˆ«å­—ã€è°ƒæ•´ä»£ç é€»è¾‘ã€å®Œå–„æ–‡æ¡£ç­‰ç­‰ã€‚æœ€ç›´æ¥çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¯„è®ºï¼Œè¦æ±‚è´¡çŒ®è€…ä¿®æ”¹ã€‚ä½†æ²Ÿé€šæ˜¯æœ‰æˆæœ¬çš„ï¼Œè€Œä¸”ä¸å¤ŸåŠæ—¶ã€‚\n\næœ‰æ²¡æœ‰æ›´ä¾¿æ·çš„æ–¹æ³•ï¼Ÿç›´æ¥å°†è‡ªå·±çš„ Commit è¿½åŠ åˆ°æŸä¸ª Pull Request ä¸­ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚\n\n> å¯¹äºä¸‹æ–‡çš„æ“ä½œï¼Œè¯»è€…å¯ä»¥å…ˆåœ¨æµ‹è¯•é¡¹ç›®ä¸­éªŒè¯ï¼Œç„¶åå†åº”ç”¨åˆ°å®é™…é¡¹ç›®ä¸­ã€‚\n\n## Step 1: å…‹éš†é¡¹ç›®\n\né¦–å…ˆï¼Œå°†è‡ªå·±çš„é¡¹ç›®å…‹éš†ä¸‹æ¥ï¼š\n\n```bash\n$ git clone git@github.com:liuyib/trial-test.git\n```\n\n## Step 2: æ·»åŠ æ–°çš„è¿œç¨‹ä»“åº“\n\nä¸ºäº†ä¿®æ”¹ä»–äºº Fork çš„ä»“åº“ï¼Œä½ éœ€è¦å°†å…¶æ·»åŠ åˆ°è‡ªå·±çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ä¸­ï¼š\n\n```bash\n$ git remote add EvanOne0616 https://github.com/EvanOne0616/trial-test.git\n```\n\nç°åœ¨ï¼Œå½“ä½ æ‰§è¡Œ `git remote -v` æŒ‡ä»¤æ—¶ï¼Œå°±å¯ä»¥çœ‹åˆ°ä»–äºº Fork çš„ä»“åº“ï¼Œå‡ºç°åœ¨ä½ çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ä¸­ï¼š\n\n```\n$ git remote -v\norigin  git@github.com:liuyib/trial-test.git (fetch)\norigin  git@github.com:liuyib/trial-test.git (push)\nEvanOne0616     https://github.com/EvanOne0616/trial-test.git (fetch)\nEvanOne0616     https://github.com/EvanOne0616/trial-test.git (push)\n```\n\n## Step 3: æ‹‰å–æ–°çš„è¿œç¨‹ä»“åº“\n\n```bash\n$ git fetch EvanOne0616\n```\n\n## Step 4: åˆ‡æ¢åˆ°å¯¹åº”çš„åˆ†æ”¯\n\nä½ éœ€è¦ç¡®è®¤ä¸€ä¸‹ï¼Œè´¡çŒ®è€…æå‡º Pull Request æ—¶æ‰€ç”¨çš„åˆ†æ”¯ï¼ˆå¦‚æœä½ ä¸ç¡®å®šä»–ä»¬ä½¿ç”¨çš„å“ªä¸ªåˆ†æ”¯ï¼Œè¯·çœ‹ Pull Request é¡¶éƒ¨çš„ä¿¡æ¯ï¼‰ï¼š\n\n![PR Meta Info](/assets/banner/add-commits-to-others-pr/pr-meta-info-branch.png)\n\nåœ¨æœ¬åœ°ï¼Œç»™è¯¥åˆ†æ”¯èµ·ä¸€ä¸ªä¸é‡å¤çš„åå­—ï¼Œä¾‹å¦‚ `EvanOne0616-patch`ï¼Œç„¶ååˆ‡æ¢åˆ°è´¡çŒ®è€…æå‡º Pull Request æ‰€ç”¨çš„åˆ†æ”¯ï¼š\n\n```bash\n$ git checkout -b EvanOne0616-patch EvanOne0616/patch-1\n```\n\n## Step 5: æäº¤ä¿®æ”¹ï¼Œæ¨é€è¿œç¨‹\n\nåœ¨æœ¬åœ°è¿›è¡Œä½ æƒ³è¦çš„ä¿®æ”¹ï¼Œæäº¤ Commit åï¼Œæ¨é€åˆ°è´¡çŒ®è€… Fork çš„ä»“åº“ï¼š\n\n```bash\n$ git commit -m \"Fix the wrong spelling of the word\"\n$ git push EvanOne0616 HEAD:patch-1\n```\n\næœ€åï¼Œå¦‚æœä¸€äº›é¡ºåˆ©ï¼Œä½ çš„ Commit å°†å‡ºç°åœ¨ Pull Request çš„åé¢ï¼š\n\n![Modify Others PR](/assets/banner/add-commits-to-others-pr/add-commit-to-others-pr.png)\n\n## æ€»ç»“ä¸Šæ–‡\n\nä¸Šæ–‡è¯¦è¿°äº†æŒ‡ä»¤çš„å…·ä½“æ“ä½œï¼Œè¿™é‡Œè¿›è¡Œæ€»ç»“ï¼š\n\n```bash\n# å…‹éš†è‡ªå·±çš„ä»“åº“\n$ git clone git@github.com:liuyib/trial-test.git\n\n# å°†è´¡çŒ®è€… Fork çš„ä»“åº“åœ°å€ï¼Œæ·»åŠ ä¸ºæ–°çš„è¿œç¨‹ä»“åº“\n$ git remote add EvanOne0616 https://github.com/EvanOne0616/trial-test.git\n\n# æ‹‰å–è´¡çŒ®è€…çš„ Commit\n$ git fetch EvanOne0616\n# åˆ‡æ¢åˆ°è´¡çŒ®è€…æå‡º Pull Request æ‰€ç”¨çš„åˆ†æ”¯\n$ git checkout -b EvanOne0616-patch EvanOne0616/patch-1\n\n# ä½ åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç ï¼Œç„¶åæäº¤\n$ git add .\n$ git commit -m \"Add some changes\"\n\n# å°†ä½ çš„ Commit æäº¤åˆ°è´¡çŒ®è€… Fork çš„ä»“åº“\n$ git push EvanOne0616 HEAD:patch-1\n```\n\n## å…¶ä»–æ–¹å¼\n\n### å‘½ä»¤è¡Œæ–¹å¼\n\nä¸ä¸Šæ–‡çš„æ“ä½œç±»ä¼¼ï¼Œæœ‰å¦ä¸€ç»„æŒ‡ä»¤æ“ä½œä¹Ÿå¯ä»¥å®ç°åŒæ ·çš„æ•ˆæœï¼š\n\n```bash\n# å…‹éš†è‡ªå·±çš„ä»“åº“\n$ git clone git@github.com:liuyib/trial-test.git\n\n# æ‹‰å– PRï¼ˆå…¶ä¸­ patch-1 ä¸ºè´¡çŒ®è€…æå‡º PR æ‰€ç”¨çš„åˆ†æ”¯åï¼Œ411 æ˜¯ PR çš„ IDï¼‰\n$ git pull origin pull/411/head:patch-1\n# åˆ‡æ¢åˆ°è´¡çŒ®è€…æå‡º Pull Request æ‰€ç”¨çš„åˆ†æ”¯\n$ git checkout patch-1\n\n# ä½ åœ¨æœ¬åœ°ä¿®æ”¹ä»£ç ï¼Œç„¶åæäº¤\n$ git add .\n$ git commit -m \"Add some changes\"\n\n# å°†è´¡çŒ®è€… Fork çš„ä»“åº“åœ°å€ï¼Œæ·»åŠ ä¸ºæ–°çš„è¿œç¨‹ä»“åº“\n$ git remote add EvanOne0616 https://github.com/EvanOne0616/trial-test.git\n# å°†ä½ çš„ Commit æäº¤åˆ°è´¡çŒ®è€… Fork çš„ä»“åº“\n$ git push EvanOne0616 patch-1\n```\n\n### å›¾å½¢åŒ–æ–¹å¼\n\nå¯¹äºä¸Šè¿°ä¸¤ç§æŒ‡ä»¤æ“ä½œï¼Œå¼€å‘è€…å¯ä»¥æ ¹æ®ä¸ªäººå–œå¥½è‡ªè¡Œé€‰æ‹©ã€‚ä½†æ˜¯å¦‚æœéœ€è¦ç»å¸¸ä¿®æ”¹ä»–äººè´¡çŒ®çš„ Pull Requestï¼Œä¸ç®¡å“ªä¸€ç§æŒ‡ä»¤æ“ä½œï¼Œéƒ½éš¾å…ä¼šæ˜¾å¾—æœ‰äº›ç¹çã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´ä¸ºç®€ä¾¿çš„æ–¹å¼ â€”â€” å›¾å½¢åŒ–æ“ä½œã€‚\n\n{% note warning no-icon %}\nç”±äºæˆ‘ä½¿ç”¨çš„ç¼–è¾‘å™¨æ˜¯ VS Codeï¼Œæ‰€ä»¥å¯¹äºä½¿ç”¨å…¶ä»–ç¼–è¾‘å™¨çš„å¼€å‘è€…ï¼Œä¸‹æ–‡ä»…éƒ¨åˆ†æœ‰ç”¨ã€‚\n{% endnote %}\n\nå¯¹äºå›¾å½¢åŒ– Git æ“ä½œï¼ŒVS Code å·²ç»å†…ç½®äº†è¯¥åŠŸèƒ½ï¼Œåœ¨ä¾§è¾¹æ´»åŠ¨æ ä¸­å¯ä»¥æ‰¾åˆ°ï¼š\n\n![VSCode built-in Git UI](/assets/banner/add-commits-to-others-pr/vscode-built-in-git-ui.png)\n\n{% note success %}\nå¦‚æœä½ åœ¨ VS Code çš„ä¾§è¾¹æ´»åŠ¨æ ä¸­ï¼Œæ‰¾ä¸åˆ°è¯¥åŠŸèƒ½çš„å›¾æ ‡ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½è¢«éšè—äº†ã€‚æœ‰ä¸¤ç§æ–¹å¼å°†å…¶æ˜¾ç¤ºï¼š1. åœ¨ä¾§è¾¹æ´»åŠ¨æ ä¸Šï¼Œå•å‡»é¼ æ ‡å³é”®ï¼Œç„¶åå‹¾é€‰ã€æºä»£ç ç®¡ç†ã€‘ã€‚2. ä½¿ç”¨å¿«æ·é”® <kbd>Ctrl + Shift + G</kbd> <kbd>G</kbd>ï¼ˆè¯¥å¿«æ·é”®çš„ä½¿ç”¨æ–¹æ³•ï¼šå…ˆæŒ‰ä¸‹ç»„åˆé”® <kbd>Ctrl + Shift + G</kbd>ï¼Œæ¾å¼€æ‰€æœ‰æŒ‰é”®åï¼Œå†æŒ‰ä¸‹ <kbd>G</kbd>ï¼‰\n{% endnote %}\n\nVS Code è™½ç„¶å†…ç½®äº†ã€æºä»£ç ç®¡ç†ã€‘åŠŸèƒ½ï¼Œä½†æ˜¯ä¸å¤Ÿå¼ºå¤§ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å®‰è£… [GitLens](https://github.com/eamodio/vscode-gitlens) æ’ä»¶ï¼Œä¸¤è€…é…åˆä½¿ç”¨ã€‚\n\n> åœ¨ VS Code ä¸­å®‰è£…æ’ä»¶è¾ƒä¸ºç®€å•ï¼Œå› æ­¤è¿™é‡Œçœç•¥ GitLens çš„å®‰è£…ä»‹ç»ã€‚\n\nå®‰è£… GitLens ä¹‹åï¼Œåœ¨ VS Code çš„ä¾§è¾¹æ´»åŠ¨æ ä¸­ï¼Œä¼šæ–°æ·»ä¸€ä¸ªå›¾æ ‡ï¼Œç›´æ¥ç‚¹å‡»è¯¥å›¾æ ‡å°±å¯ä»¥ä½¿ç”¨ GitLens äº†ã€‚\n\næ¥ä¸‹æ¥è¿›å…¥æ­£æ–‡ï¼šâ€œå¦‚ä½•é€šè¿‡å›¾å½¢åŒ–ç•Œé¢ï¼Œæ¥ä¿®æ”¹ä»–äººè´¡çŒ®çš„ Pull Requestâ€ã€‚\n\n**1 ) å…‹éš†é¡¹ç›®**\n\nå°†ä½ çš„é¡¹ç›®å…‹éš†ä¸‹æ¥ï¼Œä½¿ç”¨ VS Code æ‰“å¼€ï¼Œç„¶åç‚¹å‡»ä¾§è¾¹æ´»åŠ¨æ çš„ GitLens çš„å›¾æ ‡ã€‚\n\n**2 ) æ·»åŠ è¿œç¨‹ä»“åº“**\n\nç‚¹å‡» Remotes å³é¢çš„ `ï¼‹`ï¼ˆAdd Remoteï¼‰ï¼š\n\n![VSCode Plugins GitLens -- Add Remote](/assets/banner/add-commits-to-others-pr/vscode-plugins-gitlens-add-remote.png)\n\nåœ¨å¼¹å‡ºçš„è¾“å…¥æ¡†ä¸­ï¼Œè¾“å…¥**è¿œç¨‹ä»“åº“çš„åå­—**ï¼ˆè¯¥åå­—åªæ˜¯ä¸€ç§æ ‡è¯†ï¼Œæ–¹ä¾¿ä½ åŒºåˆ†å°±å¥½ï¼Œæˆ‘ä¹ æƒ¯ä½¿ç”¨è´¡çŒ®è€…çš„ Github ç”¨æˆ·åæ¥å……å½“ï¼‰ï¼ŒæŒ‰ä¸‹ Enter ç¡®è®¤åï¼Œå†è¾“å…¥**è¿œç¨‹ä»“åº“çš„ URL**ï¼ˆè¯¥ URL æœ‰ä¸¤ç§æ–¹å¼è·å–ï¼š1. è®¿é—®è´¡çŒ®è€…çš„ä»“åº“åˆ—è¡¨ï¼Œæ‰¾åˆ° Fork çš„ä»“åº“ï¼Œå¤åˆ¶å…¶ URLã€‚2. åœ¨ Pull Request æœ€åº•éƒ¨ï¼Œæ‰¾åˆ° `command line instructions`ï¼Œç‚¹å‡»ä¹‹åå¯ä»¥çœ‹åˆ°è¯¥ URLï¼‰ã€‚è¿™æ ·å°±æŠŠè´¡çŒ®è€… Fork çš„ä»“åº“åœ°å€ï¼Œæ·»åŠ åˆ°ä½ æœ¬åœ°é¡¹ç›®çš„è¿œç¨‹ä»“åº“åˆ—è¡¨ä¸­äº†ã€‚\n\nç„¶åæ˜¯æ‹‰å– Pull Request ä¸­çš„ä»£ç ï¼Œåœ¨æ–°æ·»åŠ çš„ Remote ä¸Šå•å‡»é¼ æ ‡å³é”® -> ç‚¹å‡» Fetchï¼š\n\n![VSCode Plugins GitLens -- Fetch Others](/assets/banner/add-commits-to-others-pr/vscode-plugins-gitlens-fetch-others.png)\n\næ¥ç€ï¼Œæ‰¾åˆ°è´¡çŒ®è€…æå‡º Pull Request æ‰€ä½¿ç”¨çš„åˆ†æ”¯ï¼Œä¾‹å¦‚ `patch-1`ã€‚ç„¶åï¼Œç‚¹å‡»å³è¾¹çš„ç®­å¤´ï¼ˆSwitch to Branchï¼‰ï¼Œåˆ‡æ¢åˆ°è¯¥åˆ†æ”¯ï¼š\n\n![VSCode Plugins GitLens -- Switch Branch](/assets/banner/add-commits-to-others-pr/vscode-plugins-gitlens-switch-branch-to-others.png)\n\næ­¤æ—¶ï¼Œå¦‚æœæ²¡æœ‰æ„å¤–çš„è¯ï¼ŒPull Request ä¸­çš„ä»£ç å°±è¢«æ‹‰å–åˆ°äº†æœ¬åœ°ã€‚æ¥ç€ä½ æ ¹æ®ä¹‹å‰çš„æƒ³æ³•ï¼Œåšä¸€äº›ä¿®æ”¹ï¼Œæäº¤å¹¶æ¨é€åˆ°è¿œç¨‹ï¼Œå°±å®ç°äº†å¯¹ Pull Request çš„ä¿®æ”¹ã€‚\n\nè¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼ŒGitLens æ’ä»¶çš„åŠŸèƒ½å¦‚æ­¤å¼ºå¤§ï¼Œç«Ÿç„¶ä¸æ”¯æŒ `git commit` çš„å›¾å½¢åŒ–æ“ä½œã€‚ã€‚ã€‚å…·ä½“åŸå› è§ï¼š[How to commit?](https://github.com/eamodio/vscode-gitlens/issues/375)ï¼Œå…¶ä¸­ GitLens çš„ç»´æŠ¤äººå‘˜æåˆ°ï¼šç”±äº VS Code å†…ç½®äº† `git commit` çš„å›¾å½¢åŒ–æ“ä½œï¼Œå› æ­¤ GitLens ä¸æ‰“ç®—å¯¹å…¶è¿›è¡Œæ”¯æŒã€‚\n\næäº¤ Commit å¹¶æ¨é€åˆ°è¿œç¨‹çš„å›¾å½¢åŒ–æ“ä½œå¦‚ä¸‹ï¼š\n\n> æ³¨æ„ï¼šæ­¤å¤„æ˜¯ç”¨çš„ VS Code å†…ç½®çš„ã€æºä»£ç ç®¡ç†ã€‘åŠŸèƒ½ï¼Œä¸æ˜¯ GitLensã€‚\n\n![VSCode Plugins GitLens -- Git Add / Commit](/assets/banner/add-commits-to-others-pr/vscode-built-in-git-ui-add-commit.png)\n\næœ€åï¼Œåœ¨ GitLens ä¸­ï¼Œç‚¹å‡» `â†‘`ï¼ˆPush Repositoriesï¼‰ -> `Push`ï¼š\n\n![VSCode Plugins GitLens -- Git Push](/assets/banner/add-commits-to-others-pr/vscode-plugins-gitlens-push.png)\n\nåˆ°è¿™é‡Œï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œä½ çš„ Commit å°±è¿½åŠ åˆ°äº†åˆ«äººè´¡çŒ®çš„ Pull Request åé¢ ğŸ‰ã€‚\n\n### Web ç«¯æ–¹å¼\n\nè¿˜æœ‰ä¸€ç§ç®€å•çš„æ–¹å¼ï¼Œç›´æ¥åœ¨ Github ä¸­åœ¨çº¿ä¿®æ”¹ Pull Requestï¼š\n\n![Github PR -- Edit File](/assets/banner/add-commits-to-others-pr/github-pr-files-changed-edit-file.png)\n\n{% note tips %}\nè¯¥æ–¹å¼ä¸€æ¬¡åªèƒ½ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œæ›´é€‚ç”¨äºéœ€è¦å°‘é‡ä¿®æ”¹çš„ Pull Requestã€‚\n{% endnote %}\n\n## æ½œåœ¨é—®é¢˜\n\nå½“ä½ å°†ä»£ç  Push åˆ°è´¡çŒ®è€… Fork çš„ä»“åº“ä¸­æ—¶ï¼Œå¦‚æœé‡åˆ°ç±»ä¼¼å¦‚ä¸‹æŠ¥é”™ä¿¡æ¯ï¼š\n\n```bash\n! [remote rejected] HEAD -> master (permission denied)\nerror: failed to push some refs to 'https://github.com/EvanOne0616/trial-test.git'\n```\n\nè¿™æ˜¯å› ä¸ºè´¡çŒ®è€…åœ¨æå‡ºçš„ Pull Request ä¸­ï¼Œå–æ¶ˆå‹¾é€‰äº†â€œAllow edits from maintainersâ€é€‰é¡¹ã€‚è¯·é€šçŸ¥è´¡çŒ®è€…é‡æ–°å‹¾é€‰è¯¥é€‰é¡¹ï¼Œç„¶åè¯¥æŠ¥é”™å³å¯è§£å†³ã€‚\n\n## æ€»ç»“å…¨æ–‡\n\nä¸ç®¡å“ªç§æ–¹å¼ï¼Œæœ€ç»ˆ Pull Request ä¸­éƒ½å¯èƒ½ä¼šåŒ…å«å¾ˆå¤š Commitã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ›´å€¾å‘äº Pull Request åˆå¹¶æ—¶ï¼Œåªäº§ç”Ÿä¸€ä¸ª Commitã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æœ€ç»ˆåˆå¹¶æ—¶ï¼Œé€šè¿‡é€‰æ‹© `Squash and merge`ï¼Œå°†å¤šæ¬¡ Commit åˆå¹¶ä¸ºä¸€æ¬¡ã€‚\n\n---\n\nå‚è€ƒèµ„æ–™ï¼š\n\n- [Adding Commits to Someone Else's Pull Request](https://tighten.co/blog/adding-commits-to-a-pull-request/)\n- [Keep your fork synced](https://docs.github.com/en/github/getting-started-with-github/fork-a-repo#step-3-configure-git-to-sync-your-fork-with-the-original-spoon-knife-repository)\n- [å¦‚ä½•ä¿®æ”¹äººå®¶è´¡çŒ®çš„ PRï¼Œä¸æƒ³å…ˆåˆå¹¶å†ä¿®æ”¹](https://d.cosx.org/d/420363-pr)\n","tags":["Github","Git","Pull Request"],"categories":["ç‰ˆæœ¬æ§åˆ¶"]},{"title":"æ·±å…¥æ¢ç©¶ SSL/TLS åè®®","url":"/2020/04/18/deep-study-ssl-tls/","content":"\nSSL/TLS åè®®æ˜¯ HTTPS ä¸­ç‰¹åˆ«é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤æœ‰å¿…è¦æ·±å…¥äº†è§£å…¶åŸç†å’Œè¿ä½œè¿‡ç¨‹ã€‚\n\n## HTTP ä¸ºä»€ä¹ˆä¸å®‰å…¨\n\nHTTP æ˜¯æ˜æ–‡ä¼ è¾“åè®®ï¼Œé€šä¿¡è¿‡ç¨‹å’Œæ•°æ®ä¼ è¾“éƒ½æ²¡æœ‰è¿›è¡ŒåŠ å¯†ï¼Œä¹Ÿæ²¡æœ‰éªŒè¯é€šä¿¡åŒæ–¹çš„èº«ä»½ã€‚å› æ­¤é€šä¿¡è¿‡ç¨‹å¾ˆå®¹æ˜“é­åˆ°åŠ«æŒã€çªƒå¬ã€ç¯¡æ”¹ç­‰ã€‚\n\n<!-- more -->\n\nä½¿ç”¨ HTTP åè®®ä¼ è¾“ä¿¡æ¯æ—¶ï¼Œå°±å¥½æ¯”é‚®å¯„ä¿¡ä»¶ï¼Œé‚®ä»¶ä¼šç»è¿‡å¾ˆå¤šå¿«é€’å‘˜ï¼Œä½†æ˜¯æ¯ä¸ªå¿«é€’å‘˜éƒ½å¯ä»¥æ‹†å¼€é‚®ä»¶å¹¶è¯»å–å†…å®¹ï¼ˆå› ä¸º HTTP æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼‰ï¼Œæ‰€ä»¥é‚®ä»¶çš„å†…å®¹å¯ä»¥è¢«è½»æ˜“çªƒå–ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¿«é€’å‘˜è¿˜å¯ä»¥ä¼ªé€ ã€ç¯¡æ”¹é‚®ä»¶ï¼Œä½¿å¾—ç”¨æˆ·æœ€ç»ˆæ”¶åˆ°çš„é‚®ä»¶æ˜¯å‡çš„ã€‚\n\n## HTTPS å¦‚ä½•ä¿è¯å®‰å…¨\n\nHTTPS = HTTP + SSL/TLSï¼Œå¦‚ä»Š SSL å·²åºŸå¼ƒï¼Œè¿™é‡Œæˆ‘ä»¬åªè®¨è®º HTTP + TLSã€‚\n\nä¸ºäº†è§£å†³ HTTP åè®®çš„é—®é¢˜ï¼ŒHTTPS å¼•å…¥äº†**æ•°æ®åŠ å¯†**å’Œ**èº«ä»½éªŒè¯æœºåˆ¶**ã€‚åœ¨å¼€å§‹ä¼ è¾“æ•°æ®ä¹‹å‰ï¼Œé€šè¿‡å®‰å…¨å¯é çš„ TLS åè®®è¿›è¡ŒåŠ å¯†ï¼Œä»è€Œä¿è¯åç»­åŠ å¯†ä¼ è¾“æ•°æ®çš„å®‰å…¨æ€§ã€‚\n\n## TLS åè®®\n\n**ä¼ è¾“å±‚å®‰å…¨æ€§åè®®**ï¼ˆTransport Layer Securityï¼Œ**TLS**ï¼‰åŠå…¶å‰èº«**å®‰å…¨å¥—æ¥å±‚**ï¼ˆSecure Sockets Layerï¼Œ**SSL**ï¼‰æ˜¯ä¸€ç§å®‰å…¨åè®®ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿è¯**ç½‘ç»œé€šä¿¡å®‰å…¨**å’Œ**æ•°æ®å®Œæ•´æ€§**ã€‚\n\nå— TLS åè®®ä¿æŠ¤çš„é€šä¿¡è¿‡ç¨‹ï¼Œå…·æœ‰ä»¥ä¸‹ä¸€ç§æˆ–å‡ ç§å±æ€§ï¼š\n\n- è¿æ¥æ˜¯å®‰å…¨çš„\n\n  > å› ä¸ºä¼ è¾“çš„æ•°æ®è¿›è¡Œäº†åŠ å¯†ï¼ˆä½¿ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ã€‚å¹¶ä¸”å¯¹ç§°åŠ å¯†çš„å¯†é’¥æ˜¯ä¸ºæ¯ä¸€ä¸ªè¿æ¥å”¯ä¸€ç”Ÿæˆçš„ï¼ˆåŸºäº TLS æ¡æ‰‹é˜¶æ®µåå•†çš„[åŠ å¯†ç®—æ³•](https://en.wikipedia.org/wiki/Transport_Layer_Security#Key_exchange_or_key_agreement)å’Œ[å…±äº«å¯†é’¥](https://en.wikipedia.org/wiki/Shared_secret)ï¼‰ã€‚\n  >\n  > å…¶ä¸­ï¼Œ**å…±äº«å¯†é’¥**çš„åå•†æ˜¯å®‰å…¨å¯é çš„ã€‚å¦‚æœæœ‰æ”»å‡»è€…ä¿®æ”¹äº†é€šä¿¡ï¼Œé‚£ä¹ˆè¯¥ä¿®æ”¹ä¸€å®šä¼šè¢«æ£€æµ‹å‡ºæ¥å¹¶è¢«é˜»æ­¢ã€‚å¹¶ä¸”å³ä½¿æ”»å‡»è€…å¤„äºæ•´ä¸ªè¿æ¥çš„ä¸­é—´ï¼ˆçªƒå¬ TLS æ¡æ‰‹ï¼‰ï¼Œä¹Ÿæ— æ³•åˆ©ç”¨çªƒå¬åˆ°çš„å¯†é’¥ã€‚\n\n- è¿æ¥æ˜¯å¯é çš„\n\n  > å‘é€çš„æ¯æ¡æ¶ˆæ¯éƒ½ä¼šé€šè¿‡[æ¶ˆæ¯éªŒè¯ç ](https://en.wikipedia.org/wiki/Message_authentication_code)ï¼ˆMessage authentication code, MACï¼‰ï¼Œæ¥è¿›è¡Œæ¶ˆæ¯å®Œæ•´æ€§æ£€æŸ¥ã€‚\n\n- å¯ä»¥ä½¿ç”¨å…¬é’¥å¯¹é€šä¿¡åŒæ–¹è¿›è¡Œèº«ä»½éªŒè¯\n\n  > è¯¥é¡¹ä¸€èˆ¬åªéœ€è¦éªŒè¯ä¸€æ–¹çš„èº«ä»½ï¼ˆé€šå¸¸æ˜¯æœåŠ¡ç«¯ï¼‰ã€‚å¯¹äºä¸€äº›éå¸¸ä¿å¯†çš„åº”ç”¨ï¼Œè¿˜æ˜¯éœ€è¦éªŒè¯åŒæ–¹çš„èº«ä»½ã€‚ä¾‹å¦‚ï¼Œé‡‘èæœºæ„å¾€å¾€åªå…è®¸è®¤è¯åçš„ç”¨æˆ·è¿å…¥è‡ªå·±çš„ç½‘ç»œã€‚\n\nTLS åè®®åŒ…æ‹¬ä¸¤å±‚ï¼š[TLS è®°å½•](https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_record)å’Œ [TLS æ¡æ‰‹åè®®](https://en.wikipedia.org/wiki/Transport_Layer_Security#TLS_handshake)ã€‚æœ¬æ–‡ä¸»è¦è®²è¿° TLS æ¡æ‰‹åè®®ã€‚\n\nç”±äºè¯¸å¤šåŸå› ï¼ˆä¸»è¦æ˜¯å®‰å…¨æ–¹é¢ï¼‰ï¼ŒSSL åè®®çš„æ‰€æœ‰ç‰ˆæœ¬ï¼ˆSSL 1.0ã€SSL 2.0ã€SSL 3.0ï¼‰éƒ½å·²å¼ƒç”¨ã€‚å¹¶ä¸” TLS 1.0ã€TLS 1.1 ä¹Ÿå°†åœ¨ 2020 å¹´å¼ƒç”¨ï¼Œå› æ­¤ç›®å‰ä¸»æµçš„é€šä¿¡åŠ å¯†åè®®ç‰ˆæœ¬æ˜¯ TLS 1.2 å’Œ TLS 1.3ã€‚\n\n## TLS æ¡æ‰‹\n\nä¸€å¼ å›¾è§£ TLS æ¡æ‰‹ï¼ˆä¸‹é¢ä¼šè¯¦ç»†ä»‹ç»ï¼‰ï¼š\n\n> å¸¦è¯ä¹¦çš„åŒå‘èº«ä»½éªŒè¯çš„ TLS æ¡æ‰‹ã€‚\n\n![](/assets/posts/deep-study-ssl-tls/tls-four-handshake.png)\n\n> å›¾ç‰‡åŸå§‹æ¥æºï¼š[Wikipedia - File:SSL handshake with two way authentication with certificates.svg](https://zh.wikipedia.org/wiki/File:SSL_handshake_with_two_way_authentication_with_certificates.svg)ï¼Œç”±æˆ‘ç¿»è¯‘å¹¶ç»˜åˆ¶ä¸ºä¸­æ–‡ã€‚\n\nè¯¦ç»†è¿‡ç¨‹å¦‚ä¸‹ï¼š\n\n- ç¬¬ä¸€æ¬¡æ¡æ‰‹\n\n  - å®¢æˆ·ç«¯å‘é€ ClientHello æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«**æ”¯æŒçš„æœ€é«˜ TLS åè®®ç‰ˆæœ¬**ã€**éšæœºæ•°**ï¼ˆç¨åç”¨äºç”Ÿæˆâ€œä¼šè¯å¯†é’¥â€ï¼‰ã€**åŠ å¯†ç®—æ³•åˆ—è¡¨**ï¼ˆå¦‚ RSA å…¬é’¥åŠ å¯†ï¼‰å’Œ**å‹ç¼©ç®—æ³•åˆ—è¡¨**\n\n    > å¦‚æœå®¢æˆ·ç«¯æ­£åœ¨å°è¯•æ¢å¤æ¡æ‰‹ï¼Œåˆ™å®ƒå¯ä»¥å‘é€ä¼šè¯ IDã€‚\n    >\n    > å¦‚æœå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨[åº”ç”¨åè®®åå•†](https://en.wikipedia.org/wiki/Application-Layer_Protocol_Negotiation)ï¼Œåˆ™å®ƒå¯èƒ½åŒ…æ‹¬å—æ”¯æŒçš„åº”ç”¨ç¨‹åºåè®®åˆ—è¡¨ï¼Œä¾‹å¦‚ [HTTP 2.0](https://en.wikipedia.org/wiki/HTTP/2)ã€‚\n\n  - æœåŠ¡ç«¯å›åº” ServerHello æ¶ˆæ¯ï¼Œå…¶ä¸­åŒ…å«**è¦ä½¿ç”¨çš„ TLS åè®®ç‰ˆæœ¬**ã€**éšæœºæ•°**ï¼ˆç¨åç”¨äºç”Ÿæˆâ€œä¼šè¯å¯†é’¥â€ï¼‰ã€**è¦ä½¿ç”¨çš„åŠ å¯†ç®—æ³•**å’Œ**è¦ä½¿ç”¨çš„å‹ç¼©ç®—æ³•**\n\n    > ä¸ºäº†ç¡®è®¤æ¢å¤æ¡æ‰‹ï¼Œåˆ™æœåŠ¡ç«¯å¯ä»¥å‘é€ä¼šè¯ IDã€‚\n    >\n    > è¦ä½¿ç”¨çš„åè®®ç‰ˆæœ¬åº”è¯¥æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æ”¯æŒçš„æœ€é«˜ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå®¢æˆ·ç«¯æ”¯æŒ TLS 1.1ï¼ŒæœåŠ¡ç«¯æ”¯æŒ TLS 1.2ï¼Œåˆ™åº”è¯¥é€‰æ‹© TLS 1.1 ç‰ˆæœ¬ã€‚\n\n- ç¬¬äºŒæ¬¡æ¡æ‰‹\n\n  - æœåŠ¡ç«¯å‘é€å…¶è¯ä¹¦ï¼ˆå¯é€‰ï¼Œå–å†³äºä½¿ç”¨çš„åŠ å¯†ç®—æ³•ï¼‰\n\n    > ç›®å‰ä¸»æµçš„ RSA ç®—æ³•å°±æ˜¯åŸºäºè¯ä¹¦çš„ã€‚ä½¿ç”¨è¯ä¹¦ä¹Ÿæ˜¯æ›´æ¨èçš„åšæ³•ï¼Œå› ä¸ºç›¸æ¯”äºæ— è¯ä¹¦çš„æœºåˆ¶ï¼Œä½¿ç”¨è¯ä¹¦æ›´å®‰å…¨\n\n  - æœåŠ¡ç«¯å‘é€ ServerKeyExchange æ¶ˆæ¯ï¼ˆå¯é€‰ï¼Œå–å†³äºä½¿ç”¨çš„åŠ å¯†ç®—æ³•ã€‚DHE å’Œ DH_anon ç®—æ³•ä¼šå‘é€è¯¥æ¶ˆæ¯ï¼‰\n  - æœåŠ¡ç«¯å‘é€ CertificateRequest æ¶ˆæ¯ï¼Œè¯·æ±‚è·å–å®¢æˆ·ç«¯è¯ä¹¦ï¼Œä»¥ä¾¿è¿›è¡Œç›¸äº’è®¤è¯ï¼ˆå¯é€‰ï¼Œå¦‚æœæ˜¯å•å‘èº«ä»½è®¤è¯ï¼Œé€šå¸¸æ˜¯æœåŠ¡ç«¯è®¤è¯ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸€æ­¥ï¼‰\n  - æœåŠ¡ç«¯å‘é€ ServerHelloDone æ¶ˆæ¯ï¼Œè¡¨ç¤º**æœåŠ¡ç«¯æ¡æ‰‹åå•†å®Œæˆ**ï¼ˆæ³¨æ„ï¼Œæ˜¯åå•†å®Œæˆï¼Œè€Œä¸æ˜¯æ•´ä¸ª TLS æ¡æ‰‹å®Œæˆï¼‰ã€‚\n  - å®¢æˆ·ç«¯æ ¡éªŒæœåŠ¡ç«¯è¯ä¹¦ï¼ˆå¦‚æœè¯ä¹¦ä¸åˆæ³•ï¼Œå®¢æˆ·ç«¯ä¼š**å‘ç”¨æˆ·å‘å‡ºè­¦å‘Šä¿¡æ¯**å¹¶**æ–­å¼€ TLS æ¡æ‰‹**ï¼‰\n\n- ç¬¬ä¸‰æ¬¡æ¡æ‰‹\n\n  - å®¢æˆ·ç«¯å‘é€å…¶è¯ä¹¦ï¼Œä¾›æœåŠ¡ç«¯ä½¿ç”¨å’Œæ ¡éªŒï¼ˆå¯é€‰ï¼Œå¦‚æœæ˜¯å•å‘èº«ä»½è®¤è¯ï¼Œé€šå¸¸æ˜¯æœåŠ¡ç«¯è®¤è¯ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸€æ­¥ï¼‰\n  - å®¢æˆ·ç«¯å‘é€ ClientKeyExchange æ¶ˆæ¯ï¼ˆå¯é€‰ï¼ŒåŒæ ·å–å†³äºä½¿ç”¨çš„åŠ å¯†ç®—æ³•ã€‚DHE å’Œ DH_anon ç®—æ³•ä¼šç”¨åˆ°ï¼‰ï¼Œå…¶ä¸­å¯èƒ½åŒ…å« Pre-Master-Secretã€å…¬é’¥ã€‚\n\n    > Pre-Master-Secret (PMSï¼Œé¢„ä¸»å¯†é’¥) æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼Œåœ¨å‘é€ä¹‹å‰ï¼Œä¼šä½¿ç”¨æœåŠ¡ç«¯è¯ä¹¦ä¸­çš„å…¬é’¥å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚\n\n  - å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª CertificateVerify æ¶ˆæ¯ï¼ˆå¯é€‰ï¼Œå¦‚æœæ˜¯å•å‘èº«ä»½è®¤è¯ï¼Œé€šå¸¸æ˜¯æœåŠ¡ç«¯è®¤è¯ï¼Œåˆ™ä¸éœ€è¦è¿™ä¸€æ­¥ï¼‰ï¼Œå…¶ä¸­åŒ…å«ä½¿ç”¨å®¢æˆ·ç«¯**ç§é’¥**å¯¹ä¹‹å‰æ¡æ‰‹ä¿¡æ¯çš„ç­¾åã€‚æœåŠ¡ç«¯å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯å…¬é’¥æ¥éªŒè¯æ­¤ç­¾åï¼Œä»¥ç¡®å®šå®¢æˆ·ç«¯æ˜¯å¦æ‹¥æœ‰æ­¤è¯ä¹¦\n\n  - åˆ°æ­¤ä¸ºæ­¢ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½å…·æœ‰äº†ä¸‰ä¸ªéšæœºæ•°ï¼ˆä¸¤ä¸ªéšæœºæ•° + PMSï¼‰ï¼Œç„¶åå®ƒä»¬åˆ†åˆ«ä½¿ç”¨ä¹‹å‰åå•†çš„**å¯¹ç§°åŠ å¯†ç®—æ³•**å’Œ**ä¸‰ä¸ªéšæœºæ•°**æ¥ç”Ÿæˆ Master-Secretï¼Œç”¨äºåŠ å¯†ä¹‹åä¼ è¾“çš„æ•°æ®\n\n    > Master-Secretï¼ˆMSï¼Œä¸»å¯†é’¥ï¼Œä¹Ÿç§°ä¸ºâ€œä¼šè¯å¯†é’¥â€ï¼‰\n\n- ç¬¬å››æ¬¡æŒ¥æ‰‹\n\n  - å®¢æˆ·ç«¯å‘é€ ChangeCipherSpec è®°å½•ï¼Œç”¨äºå‘Šè¯‰æœåŠ¡ç«¯â€œä¹‹åçš„æ‰€æœ‰æ•°æ®éƒ½å°†è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆå¦‚æœæœåŠ¡ç«¯è¯ä¹¦ä¸­å­˜åœ¨åŠ å¯†å‚æ•°ï¼Œåˆ™ä¼šè¿›è¡ŒåŠ å¯†ï¼‰â€ã€‚å…·ä½“å¦‚ä¸‹ï¼š\n\n    - å®¢æˆ·ç«¯å‘é€ç»è¿‡èº«ä»½éªŒè¯å’ŒåŠ å¯†çš„ Finished æ¶ˆæ¯ï¼Œå…¶åŒ…å«ä¹‹å‰æ‰€æœ‰æ¡æ‰‹ä¿¡æ¯çš„ Hash å’Œ [MAC](https://en.wikipedia.org/wiki/Message_authentication_code)\n    - æœåŠ¡ç«¯å°è¯•è§£å¯† Finished æ¶ˆæ¯ï¼Œè·å–å¹¶éªŒè¯ Hash å’Œ MACã€‚å¦‚æœè§£å¯†æˆ–éªŒè¯å¤±è´¥ï¼Œåˆ™è®¤ä¸ºæ¡æ‰‹å¤±è´¥ï¼Œæ–­å¼€ TLS é“¾æ¥ã€‚\n\n  - æœåŠ¡ç«¯å›åº” ChangeCipherSpec è®°å½•ï¼ŒåŒæ ·ç”¨äºå‘Šè¯‰å®¢æˆ·ç«¯â€œä¹‹åçš„æ‰€æœ‰æ•°æ®éƒ½å°†è¿›è¡Œèº«ä»½éªŒè¯ï¼ˆå¦‚æœæœåŠ¡ç«¯è¯ä¹¦ä¸­å­˜åœ¨åŠ å¯†å‚æ•°ï¼Œåˆ™ä¼šè¿›è¡ŒåŠ å¯†ï¼‰â€ã€‚å…·ä½“å¦‚ä¸‹ï¼š\n\n    - æœåŠ¡ç«¯å‘é€ç»è¿‡èº«ä»½éªŒè¯å’ŒåŠ å¯†çš„ Finished æ¶ˆæ¯ï¼Œå…¶åŒ…å«ä¹‹å‰æ‰€æœ‰æ¡æ‰‹ä¿¡æ¯çš„ Hash å’Œ [MAC](https://en.wikipedia.org/wiki/Message_authentication_code)\n    - å®¢æˆ·ç«¯æ‰§è¡Œä¸æœåŠ¡ç«¯ä¸Šä¸€æ­¥ç›¸åŒçš„è§£å¯†å’ŒéªŒè¯è¿‡ç¨‹\n\nä¸Šé¢å¯¹ TLS å››æ¬¡æ¡æ‰‹è¿›è¡Œäº†å…¨é¢çš„ä»‹ç»ï¼Œä½†æ¯”è¾ƒæ™¦æ¶©éš¾æ‡‚ï¼Œä¸‹é¢æˆ‘ä»¬å°†å…¶ç®€åŒ–å¹¶æ€»ç»“ä¸€ä¸‹ï¼š\n\n> ç”±äºä¸ç”¨è¯ä¹¦çš„ TLS æ¡æ‰‹ä¸å¤Ÿå®‰å…¨ï¼Œä¹Ÿå¾ˆå°‘ä½¿ç”¨ï¼Œå› æ­¤è¿™é‡Œåªè®¨è®ºéœ€è¦è¯ä¹¦çš„ã€‚\n\n- ç¬¬ä¸€æ¬¡æ¡æ‰‹\n\n  - å®¢æˆ·ç«¯å‘é€ TLS æ¡æ‰‹è¯·æ±‚ï¼Œå…¶ä¸­åŒ…å«**æ”¯æŒçš„æœ€é«˜ TLS åè®®ç‰ˆæœ¬**ã€**éšæœºæ•°**ã€**åŠ å¯†ç®—æ³•åˆ—è¡¨**ã€**å‹ç¼©ç®—æ³•åˆ—è¡¨**\n  - æœåŠ¡ç«¯å›åº”è¯·æ±‚ï¼Œå›åº”çš„å†…å®¹åŒ…å«**è¦ä½¿ç”¨çš„ TLS åè®®ç‰ˆæœ¬**ã€**éšæœºæ•°**ã€**è¦ä½¿ç”¨çš„åŠ å¯†ç®—æ³•**ã€**è¦ä½¿ç”¨çš„å‹ç¼©ç®—æ³•**\n\n- ç¬¬äºŒæ¬¡æ¡æ‰‹\n\n  - æœåŠ¡ç«¯å‘é€å…¶è¯ä¹¦ï¼Œè¯·æ±‚è·å–å®¢æˆ·ç«¯è¯ä¹¦ï¼Œç„¶åå‘é€ ServerHelloDone æ¶ˆæ¯\n  - å®¢æˆ·ç«¯éªŒè¯æœåŠ¡ç«¯è¯ä¹¦ï¼Œå¦‚æœä¸åˆæ³•ï¼Œåˆ™æ–­å¼€ TLS æ¡æ‰‹è¿æ¥\n\n- ç¬¬ä¸‰æ¬¡æ¡æ‰‹\n\n  å®¢æˆ·ç«¯å‘é€ä»¥ä¸‹ä¿¡æ¯ï¼š\n\n  - å®¢æˆ·ç«¯è¯ä¹¦\n  - ä¸€ä¸ªéšæœºæ•°ï¼ˆPMSï¼‰ã€‚è¯¥éšæœºæ•°ä½¿ç”¨æœåŠ¡ç«¯çš„å…¬é’¥åŠ å¯†\n  - ä½¿ç”¨å®¢æˆ·ç«¯**ç§é’¥**å¯¹å…ˆå‰æ¡æ‰‹ä¿¡æ¯çš„ç­¾å\n\n  æ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½æœ‰äº†ä¸‰ä¸ªéšæœºæ•°ï¼Œç„¶ååŒæ–¹å„è‡ªä½¿ç”¨åå•†çš„å¯¹ç§°åŠ å¯†ç®—æ³•å’Œä¸‰ä¸ªéšæœºæ•°ï¼Œæ¥ç”Ÿæˆå¯¹è¯å¯†é’¥ï¼ˆMSï¼‰ï¼Œç”¨äºåŠ å¯†ä¹‹åä¼ è¾“çš„æ•°æ®ã€‚\n\n- ç¬¬å››æ¬¡æŒ¥æ‰‹\n\n  å®¢æˆ·ç«¯å‘é€å¦‚ä¸‹ä¿¡æ¯ï¼š\n\n  - ç¼–ç æ”¹å˜é€šçŸ¥ï¼ˆç”¨äºå‘Šè¯‰æœåŠ¡ç«¯åŠ å¯†ä¼ è¾“æ¥ä¸‹æ¥çš„æ•°æ®ï¼‰\n  - æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼ˆè¯¥é€šçŸ¥åŒ…å«ä¹‹å‰æ‰€æœ‰æ¡æ‰‹ä¿¡æ¯çš„ Hash å’Œ [MAC](https://en.wikipedia.org/wiki/Message_authentication_code)ï¼Œä¾›æœåŠ¡ç«¯æ ¡éªŒï¼‰\n\n  æœåŠ¡ç«¯å‘é€å¦‚ä¸‹ä¿¡æ¯ï¼š\n\n  - ç¼–ç æ”¹å˜é€šçŸ¥ï¼ˆç”¨äºå‘Šè¯‰å®¢æˆ·ç«¯åŠ å¯†ä¼ è¾“æ¥ä¸‹æ¥çš„æ•°æ®ï¼‰\n  - æ¡æ‰‹ç»“æŸé€šçŸ¥ï¼ˆè¯¥é€šçŸ¥åŒ…å«ä¹‹å‰æ‰€æœ‰æ¡æ‰‹ä¿¡æ¯çš„ Hash å’Œ [MAC](https://en.wikipedia.org/wiki/Message_authentication_code)ï¼Œä¾›å®¢æˆ·ç«¯æ ¡éªŒï¼‰\n\n## è¯ä¹¦æ ¡éªŒ\n\nTLS åè®®ä¸­é‡è¦çš„ä¸€ç¯æ˜¯å¦‚ä½•æ ¡éªŒè¯ä¹¦çš„çœŸå®æ€§ã€‚è™½ç„¶æœ‰äº› TLS æ¡æ‰‹ä¸éœ€è¦è¯ä¹¦ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨ [Diffie-Hellman](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman)ï¼ˆDHï¼‰ ç®—æ³•çš„ TLS æ¡æ‰‹ï¼‰ï¼Œä½†æ˜¯è¿™äº›æƒ…å†µéƒ½è¢«è¯å®ä¸å®‰å…¨ï¼Œè€Œä¸”å¾ˆå°‘ä½¿ç”¨ã€‚\n\nè¦è¯æ˜è¯ä¹¦çš„çœŸå®æ€§ï¼Œé€šå¸¸ä¾èµ–äº**ä¸€ç»„**å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹**è¯ä¹¦é¢å‘æœºæ„**ï¼ˆCertificate authorities, **CA**ï¼‰ã€‚éªŒè¯ TLS è¯ä¹¦æœ‰æ•ˆæ€§çš„æ–¹æ³•å¦‚ä¸‹ï¼š\n\n1. æ£€æŸ¥è¯ä¹¦æ˜¯å¦æ˜¯æµè§ˆå™¨ä¸­**å—ä¿¡ä»»çš„æ ¹è¯ä¹¦æœºæ„**é¢å‘\n\n   è¯ä¹¦éƒ½æ˜¯ä¸Šçº§ CA ç­¾å‘çš„ï¼Œä¸Šçº§çš„ CA å¯èƒ½è¿˜æœ‰ä¸Šçº§ï¼Œç›´åˆ°æ‰¾åˆ°æ ¹è¯ä¹¦ã€‚\n\n2. æ£€æŸ¥è¯ä¹¦ä¸­çš„**è¯ä¹¦åŠé”€åˆ—è¡¨**ï¼ˆCRLï¼‰ï¼Œçœ‹è¯ä¹¦æ˜¯å¦å·²ç»è¢«åŠé”€\n\n   è¯ä¹¦è¢«åŠé”€åï¼Œä¼šè¢«è®°å½•åœ¨è¯ä¹¦åŠé”€åˆ—è¡¨ä¸­ï¼ŒCA ä¼šå®šæœŸå‘å¸ƒ CRLã€‚åº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ® CRL æ¥æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¢«åŠé”€ã€‚\n\n3. é€šè¿‡**åœ¨çº¿è¯ä¹¦çŠ¶æ€åè®®**ï¼ˆOCSPï¼‰æ£€æŸ¥è¯ä¹¦æ˜¯å¦æœ‰æ•ˆ\n\n   CA ä¼šæä¾›å®æ—¶çš„æŸ¥è¯¢æ¥å£ï¼Œç”¨æ¥æŸ¥è¯¢è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚åœ¨çº¿å®æ—¶æŸ¥è¯¢ä¼šä½¿å¾— TLS æ¡æ‰‹æ—¶é—´å»¶é•¿ï¼Œå› ä¸ºæµè§ˆå™¨éœ€è¦ç­‰å¾…æŸ¥è¯¢ç»“æŸæ‰èƒ½ç»§ç»­ TLS æ¡æ‰‹ã€‚è‡³äºä½¿ç”¨**åœ¨çº¿æŸ¥è¯¢**è¿˜æ˜¯è¯ä¹¦ä¸­çš„**åŠé”€åˆ—è¡¨**ï¼Œç”±æµè§ˆå™¨å†³å®šã€‚\n\n4. æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ\n5. æ£€æŸ¥åŸŸåå’Œè¯ä¹¦ä¸­çš„åŸŸåæ˜¯å¦ä¸€è‡´\n6. æŸ¥è¯¢ç½‘ç«™æ˜¯å¦è¢«åˆ—å…¥äº†æ¬ºè¯ˆç½‘ç«™é»‘åå•\n\n   è¿™ä¸€æ­¥ IE7 ä¼šè¿›è¡Œï¼ŒIE7 ä¼šåˆ°**æ¬ºè¯ˆç½‘ç«™æ•°æ®åº“**ï¼ŒæŸ¥è¯¢ç½‘ç«™æ˜¯å¦è¢«åˆ—å…¥äº†æ¬ºè¯ˆé»‘åå•ã€‚\n\nç»è¿‡äº†ä»¥ä¸Šæ­¥éª¤ï¼Œæµè§ˆå™¨ä¸­æ‰ä¼šæ˜¾ç¤ºå®‰å…¨é”çš„æ ‡å¿—ã€‚ä»»æ„ä¸€ä¸ªæ­¥éª¤å‡ºé—®é¢˜ï¼Œæµè§ˆå™¨éƒ½æ— æ³•å»ºç«‹å®‰å…¨é“¾æ¥ï¼Œå¹¶æœ€ç»ˆæç¤ºâ€œæ‚¨çš„é“¾æ¥ä¸æ˜¯ç§å¯†é“¾æ¥â€ã€‚\n\n## å¯¹ç§°åŠ å¯†\n\nå¯¹ç§°åŠ å¯†ï¼Œåˆå«ç§é’¥åŠ å¯†ï¼ŒæŒ‡**åŠ å¯†å’Œè§£å¯†ä½¿ç”¨ç›¸åŒå¯†é’¥çš„åŠ å¯†ç®—æ³•**ã€‚å…¶ç‰¹ç‚¹æ˜¯ï¼ŒåŠ å¯†å¯†é’¥å’Œè§£å¯†ç§˜é’¥å¯ä»¥ç›¸äº’æ¨ç®—å‡ºæ¥ã€‚å¹¶ä¸”åœ¨å¤§å¤šæ•°å¯¹ç§°åŠ å¯†ç®—æ³•ä¸­ï¼ŒåŠ å¯†å¯†é’¥å’Œè§£å¯†ç§˜é’¥æ˜¯ç›¸åŒçš„ã€‚å› æ­¤ï¼Œå¯†é’¥çš„ä¿å¯†æ€§å¯¹é€šä¿¡çš„å®‰å…¨æ€§è‡³å…³é‡è¦ã€‚\n\nä¼˜ç‚¹ï¼šè®¡ç®—é‡å°ã€åŠ å¯†é€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ã€‚\nç¼ºç‚¹ï¼šåŒæ–¹ä½¿ç”¨åŒæ ·çš„å¯†é’¥ï¼Œå®‰å…¨æ€§å¾—ä¸åˆ°ä¿è¯ã€‚\n\nä»ä»¥ä¸Šç‰¹ç‚¹å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ TLS æ¡æ‰‹é˜¶æ®µä½¿ç”¨å¯¹ç§°åŠ å¯†ï¼Œé‚£ä¹ˆåªè¦æ”»å‡»è€…çªƒå¬åˆ°å¯†é’¥ï¼Œå°±å¯ä»¥è·å–æ‰€æœ‰é€šä¿¡æ•°æ®ï¼Œè¿™ä½¿å¾—åŠ å¯†æ¯«æ— æ„ä¹‰ã€‚å› æ­¤ï¼Œéœ€è¦ç”¨åˆ°éå¯¹ç§°åŠ å¯†æ¥ä¿è¯ TLS æ¡æ‰‹çš„å®‰å…¨ã€‚\n\n## éå¯¹ç§°åŠ å¯†\n\nä¸Šæ–‡ä»‹ç»äº† TLS å››æ¬¡æ¡æ‰‹ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨æ•°æ®ä¼ è¾“ä¹‹å‰ï¼Œéœ€è¦**é€šè¿‡åå•†æ¥äº¤æ¢å¯†é’¥ã€åŠ å¯†ç®—æ³•ç­‰**ã€‚å¯†é’¥åå•†é˜¶æ®µå¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æ˜¯ [RSA](<https://en.wikipedia.org/wiki/RSA_(algorithm)>)ï¼ˆç”¨äºç”Ÿæˆ**å…¬é’¥**å’Œ**ç§é’¥**ï¼‰ã€‚å…¶ä¸­ï¼Œå…¬é’¥ä¼šè¢«åŒ…å«åœ¨è¯ä¹¦ä¸­ï¼Œç§é’¥åˆ™ç”±å®¢æˆ·ç«¯æˆ–æœåŠ¡ç«¯è‡ªå·±æ¥ä¿ç®¡ã€‚\n\nRSA ç®—æ³•å®‰å…¨æ€§å¾ˆé«˜ï¼Œå®ç°ä¹Ÿç®€å•ï¼Œä½†ç¼ºç‚¹æ˜¯éœ€è¦æ¯”è¾ƒå¤§çš„è´¨æ•°ï¼ˆç›®å‰ä¸šç•Œå¸¸ç”¨çš„æ˜¯ 2048 ä½ï¼‰æ¥ä¿è¯å®‰å…¨å¼ºåº¦ï¼Œå¹¶ä¸”è¿ç®—æå…¶æ¶ˆè€— CPU èµ„æºã€‚\n\nä¸€æ¬¡å®Œå…¨çš„ TLS æ¡æ‰‹ä¸­ï¼Œåœ¨å¯†é’¥äº¤æ¢é˜¶æ®µï¼Œéå¯¹ç§°åŠ å¯†çš„è®¡ç®—é‡å æ•´ä¸ªæ¡æ‰‹è¿‡ç¨‹çš„ 90% ä»¥ä¸Šï¼Œè€Œå¯¹ç§°åŠ å¯†çš„è®¡ç®—é‡åªç›¸å½“äºéå¯¹ç§°åŠ å¯†çš„ 0.1% å·¦å³ã€‚æ‰€ä»¥ï¼Œå¦‚æœåç»­çš„æ•°æ®ä¼ è¾“ä¹Ÿä½¿ç”¨éå¯¹ç§°åŠ å¯†ï¼Œåˆ™ä¼šæå…¶æ¶ˆè€— CPU æ€§èƒ½ï¼ŒæœåŠ¡å™¨æ ¹æœ¬æ— æ³•æ‰¿å—ã€‚\n\næ­¤å¤–ï¼Œéå¯¹ç§°åŠ å¯†æœ‰ä¸€ä¸ªé™åˆ¶ï¼š**åŠ å¯†çš„å†…å®¹é•¿åº¦ä¸èƒ½è¶…è¿‡å…¬é’¥çš„é•¿åº¦**ã€‚ä¾‹å¦‚ï¼Œå¸¸ç”¨çš„å…¬é’¥é•¿åº¦ä¸º 2048 ä½ï¼Œæ„å‘³ç€åŠ å¯†å†…å®¹ä¸èƒ½è¶…è¿‡ 256 ä¸ªå­—èŠ‚ã€‚\n\nå› æ­¤ï¼Œéå¯¹ç§°åŠ å¯†ç›®å‰åªé€‚ç”¨äº**å¯†é’¥åå•†**æˆ– **CA ç­¾å**ï¼Œä¸é€‚ç”¨äºä¼ è¾“æ•°æ®çš„åŠ è§£å¯†ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¸å…¨ç¨‹ä½¿ç”¨éå¯¹ç§°åŠ å¯†çš„åŸå› ã€‚\n\n## æ¡æ‰‹æ¢å¤\n\nTLS æ¡æ‰‹é˜¶æ®µä½¿ç”¨äº†éå¯¹ç§°åŠ å¯†ï¼ˆä¾‹å¦‚ RSA ç®—æ³•ï¼‰ï¼Œå…¶è®¡ç®—æ¶ˆè€—éå¸¸å¤§ï¼Œå› æ­¤ TLS æ¡æ‰‹æœºåˆ¶ä¸­æä¾›äº†ä¼šè¯æ¢å¤çš„åŠŸèƒ½ï¼Œä»è€Œæé«˜äº†æ¡æ‰‹ä¸­æ–­åå†æ¬¡æ¡æ‰‹çš„æ€§èƒ½ã€‚\n\næœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥æ¢å¤ä¼šè¯ï¼šä¸€ç§æ˜¯ Session IDï¼Œå¦ä¸€ç§æ˜¯ Session ticketsã€‚\n\n### Session ID\n\nSession ID çš„æ€æƒ³å¾ˆç®€å•ï¼šæ¯æ¬¡ä¼šè¯éƒ½æœ‰ä¸€ä¸ª Session IDã€‚å¦‚æœ TLS æ¡æ‰‹ä¸­æ–­ï¼Œä¸‹æ¬¡é‡è¿çš„æ—¶å€™ï¼Œåªè¦å®¢æˆ·ç«¯ç»™å‡º Session IDï¼Œå¹¶ä¸”æœåŠ¡ç«¯æœ‰å¯¹åº”çš„è®°å½•ï¼Œé‚£ä¹ˆåŒæ–¹å°±å¯ä»¥ä½¿ç”¨ä¹‹å‰çš„â€œä¼šè¯å¯†é’¥â€ï¼Œè€Œä¸å¿…é‡æ–°è®¡ç®—ç”Ÿæˆã€‚\n\nå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼šåœ¨ä¸€æ¬¡ä¼šè¯ä¸­ï¼ŒæœåŠ¡å™¨å‘é€ Session ID ä½œä¸º ServerHello æ¶ˆæ¯çš„ä¸€éƒ¨åˆ†ã€‚å®¢æˆ·ç«¯å°†æ­¤ Session ID ä¸æœåŠ¡ç«¯çš„ IPã€TCP ç«¯å£ç›¸å…³è”ï¼Œä»¥ä¾¿ä¸‹æ¬¡é‡è¿æ—¶ç®€åŒ–æ¡æ‰‹ã€‚æœåŠ¡ç«¯åˆ™ä¼šå°†æ­¤ Session ID ä¸ä¹‹å‰åå•†çš„å¯†é’¥ç›¸å…³è”ï¼Œç‰¹åˆ«æ˜¯â€œä¼šè¯å¯†é’¥ï¼ˆMaster-Secretï¼‰â€ã€‚\n\n### Session tickets\n\nSession ID æœºåˆ¶æœ‰ä¸€äº›å¼Šç«¯ï¼Œä¾‹å¦‚ï¼š1ã€åªèƒ½ä¿ç•™åœ¨ä¸€å°æœåŠ¡å™¨ä¸Šã€‚è´Ÿè½½åŒ€è¡¡ä¸­ï¼Œå¤šå°æœåŠ¡å™¨ä¹‹é—´å¾€å¾€æ²¡æœ‰åŒæ­¥ Session ä¿¡æ¯ï¼Œå¦‚æœå®¢æˆ·ç«¯çš„ä¸¤æ¬¡è¯·æ±‚æ²¡æœ‰è¢«åŒä¸€å°æœåŠ¡å™¨å¤„ç†ï¼Œå°±æ— æ³•é€šè¿‡ Session ID æ¢å¤æ¡æ‰‹ã€‚2ã€æœåŠ¡ç«¯ä¸å¥½æ§åˆ¶ Session ID å¯¹åº”ä¿¡æ¯çš„å¤±æ•ˆæ—¶é—´ã€‚æ—¶é—´å¤ªçŸ­èµ·ä¸åˆ°ä½œç”¨ï¼Œå¤ªé•¿åˆå ç”¨æœåŠ¡å™¨å¤§é‡èµ„æºã€‚\n\nSession tickets çš„å‡ºç°å°±æ˜¯ä¸ºäº† Session ID æœºåˆ¶çš„ä¸€äº›å¼Šç«¯ã€‚\n\nä½¿ç”¨ Session tickets æ—¶ï¼ŒæœåŠ¡å™¨å°†**ä¼šè¯çŠ¶æ€**å­˜å‚¨åœ¨å…¶ä¸­ï¼Œç„¶åå°† Session tickets åŠ å¯†åå­˜å‚¨åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯åœ¨æ¢å¤ä¼šè¯æ—¶ï¼Œå°† Session tickets å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œå°±å¯ä»¥ä½¿ç”¨å…¶ä¸­çš„ä¼šè¯çŠ¶æ€æ¥æ¢å¤ TLS æ¡æ‰‹ã€‚\n\n## TLS å®‰å…¨æ€§\n\nä» TLS çš„åŸç†å¯çŸ¥ï¼Œå…¶è®¾è®¡æ˜¯ä¸¥è°¨ã€å¯é çš„ï¼Œä½†æ˜¯é—®é¢˜å‡ºç°åœ¨ä¸ä¸¥è°¨çš„ä½¿ç”¨ä¸­ã€‚\n\n### ä¸­é—´äººæ”»å‡»\n\nä¸­é—´äººæ”»å‡»ï¼ˆMan-in-the-middle, MITMï¼‰æ˜¯æŒ‡ A å’Œ B é€šä¿¡æ—¶ï¼Œæœ‰ç¬¬ä¸‰è€… C å¤„äºä¿¡é“ä¸­é—´ï¼Œå¯ä»¥å®Œå…¨åŠ«æŒã€çªƒå¬ã€ç¯¡æ”¹è¿™äº›ä¿¡æ¯ã€‚\n\nä¸Šæ–‡ä¸­ä¹Ÿä¸€ç›´å¼ºè°ƒï¼Œä¸ä½¿ç”¨è¯ä¹¦çš„ TLS æ¡æ‰‹æ˜¯ä¸å®‰å…¨çš„ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨å¯†é’¥äº¤æ¢ç®—æ³• [DH](https://en.wikipedia.org/wiki/Diffie%E2%80%93Hellman)ï¼Œè¯¥ç®—æ³•å°±æ²¡æœ‰è¯ä¹¦çš„æ¦‚å¿µï¼Œè¿™æ ·æ”»å‡»è€…å°±å¯ä»¥è½»æ˜“çªƒå¬ã€ç¯¡æ”¹æ•°æ®ï¼Œä»è€Œå†’å……ä»–äººã€‚\n\n### TLS å‰¥ç¦»æ”»å‡»\n\nTLS å‰¥ç¦»æ”»å‡»æ˜¯æŒ‡å°† HTTPS è¿æ¥é™çº§åˆ° HTTP è¿æ¥ï¼Œä»è€Œæˆªè·ç”¨æˆ·ä¼ è¾“çš„å†…å®¹ã€‚ä¹Ÿå±äºä¸­é—´äººæ”»å‡»çš„ä¸€ç§ã€‚\n\nç”¨æˆ·åœ¨è®¿é—®ç½‘ç«™æ—¶ï¼Œä¸€èˆ¬åªä¼šåœ¨åœ°å€æ è¾“å…¥åŸŸåï¼Œä¾‹å¦‚ `github.com`ã€‚è¿™æ ·æ“ä½œçš„ç»“æœæ˜¯ï¼Œæµè§ˆå™¨ç”¨é»˜è®¤çš„ HTTP åè®®å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¼šè¿”å› 302 çŠ¶æ€ç ï¼Œç„¶åå®¢æˆ·ç«¯è¿›è¡Œé‡å®šå‘ï¼Œè¿™æ—¶å€™æ‰ä½¿ç”¨ HTTPS åè®®å»è®¿é—®ç½‘ç«™ã€‚\n\næ”»å‡»è€…æ­£æ˜¯åˆ©ç”¨ HTTP é‡å®šå‘åˆ° HTTPS çš„è¿‡ç¨‹ï¼Œè¿›è¡Œ TLS å‰¥ç¦»æ”»å‡»ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\n\n![](/assets/posts/deep-study-ssl-tls/tls-strip-attack.png)\n\nåœ¨è¯·æ±‚ç¬¬ä¸€æ¬¡èµ° HTTP åè®®æ—¶ï¼Œæ”»å‡»è€…åŠ«æŒ 80 ç«¯å£ï¼Œç„¶åæ¨¡æ‹Ÿ HTTPS è¯·æ±‚åˆ°æœåŠ¡å™¨ä¸Šè·å–æ•°æ®ï¼Œæœ€åä»é€šè¿‡ 80 ç«¯å£è¿”å›ç»™ç”¨æˆ·ï¼Œæ•´ä¸ªè¿‡ç¨‹ç”¨æˆ·å®Œå…¨å¯Ÿè§‰ä¸åˆ°ã€‚\n\næœ‰ä¸¤ç§æƒ…å†µä¸‹å¯èƒ½å­˜åœ¨ TLS å‰¥ç¦»æ”»å‡»ï¼š\n\n- ç”¨æˆ·æ²¡æœ‰é€šè¿‡ `https://` çš„æ–¹å¼è¾“å…¥ç½‘å€ï¼Œæµè§ˆå™¨ä¼šèµ° HTTP åè®®\n- åœ¨ HTTPS é¡µé¢ä¸­ï¼ŒåŒ…å« HTTP é“¾æ¥\n\n  > è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå»ºè®® HTTPS é¡µé¢ä¸­ï¼Œæ‰€æœ‰çš„é“¾æ¥éƒ½è¦ä½¿ç”¨ HTTPS åè®®ã€‚å“ªæ€•å…¶ä¸­æœ‰ä¸€ä¸ªé“¾æ¥ä½¿ç”¨äº† HTTP åè®®ï¼Œé‚£ä¹ˆæ•´ä¸ª HTTPS é¡µé¢éƒ½å¯èƒ½æ˜¯ä¸å®‰å…¨çš„ã€‚\n\n### ä¼ªé€ è¯ä¹¦æ”»å‡»\n\nä¸Šæ–‡ä»‹ç» TLS æ¡æ‰‹æ—¶ï¼Œæåˆ°äº†å¦‚æœæ”»å‡»è€…ä½¿ç”¨äº†ä¼ªé€ çš„è¯ä¹¦ï¼Œé‚£ä¹ˆä¸€å®šä¼šè¢«æ£€éªŒå‡ºæ¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¿¡ä»»æ”»å‡»è€…çš„ä¼ªé€ è¯ä¹¦ä¼šæ€æ ·ï¼Ÿç»“æœä¸è¨€è€Œå–»ï¼Œæ”»å‡»è€…å¯ä»¥éšæ„çªƒå–ç”¨æˆ·çš„æ•°æ®ã€‚\n\nå‡è®¾ç”¨æˆ·è®¿é—® `https://github.com`ï¼Œä½†æ˜¯ç”¨æˆ·çš„ DNS æœåŠ¡å™¨è¢«æ”»å‡»äº†ï¼Œä½¿å¾— IP å¹¶æ²¡æœ‰æŒ‡å‘ Github çš„æœåŠ¡å™¨ï¼Œè€Œæ˜¯æŒ‡å‘äº†æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚æ­¤æ—¶ï¼Œå¦‚æœæ”»å‡»è€…çš„æœåŠ¡å™¨ä¸Šæœ‰åˆæ³•çš„è¯ä¹¦ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±ä¼šä¿¡ä»»æ”»å‡»è€…ï¼Œä»è€Œå’Œæ”»å‡»è€…è¿›è¡Œé€šä¿¡ã€‚\n\nè¿™ç§æ”»å‡»çš„å‰ææ¡ä»¶æ˜¯ï¼š1ã€**ç”¨æˆ·çš„ DNS æœåŠ¡å™¨è¢«æ”»å‡»**ã€‚2ã€**æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸Šæœ‰åˆæ³•çš„è¯ä¹¦**ã€‚å…¶ä¸­ï¼Œç¬¬äºŒç‚¹å¯¹äºç”¨æˆ·æ¥è¯´æ— æ³•æ§åˆ¶ï¼Œéœ€è¦è¯ä¹¦æœºæ„ä¸æ»¥å‘è¯ä¹¦ã€‚\n\nåœ¨å®é™…ä¸­ï¼Œè¿™ç§æ”»å‡»ç¡®å®å‘ç”Ÿè¿‡ï¼Œä¾‹å¦‚ï¼š2016 å¹´ Mozilla å‘ç°æ²ƒé€š CA å­˜åœ¨ä¸¥é‡çš„ä¿¡ä»»é—®é¢˜ï¼Œä¾‹å¦‚å·ç­¾ `github.com` çš„è¯ä¹¦ï¼Œæ•…æ„å€’å¡«è¯ä¹¦æ—¥æœŸç»•è¿‡æµè§ˆå™¨å¯¹ SHA-1 è¯ä¹¦çš„é™åˆ¶ç­‰ï¼Œå°†åœæ­¢ä¿¡ä»» WoSign å’Œ StartCom ç­¾å‘çš„æ–°è¯ä¹¦ã€‚\n\n## å®‰å…¨æªæ–½\n\n### HSTS ç­–ç•¥\n\nä¸ºäº†åº”å¯¹ TLS å‰¥ç¦»æ”»å‡»ï¼Œå¼•å…¥äº† HSTS æŠ€æœ¯ã€‚HSTSï¼ˆHTTP Strict Transport Securityï¼‰çš„ä½œç”¨æ˜¯å¼ºåˆ¶å®¢æˆ·ç«¯ä½¿ç”¨ HTTPS è¿›è¡Œé€šä¿¡ã€‚\n\nè¯¥ç­–ç•¥çš„åŸç†å¾ˆç®€å•ï¼šåœ¨æœåŠ¡ç«¯çš„å“åº”å¤´ä¸­æ·»åŠ  `Strict-Transport-Security` å­—æ®µï¼Œè¯¥å­—æ®µä¸­è®¾ç½®äº† `max-age`ï¼Œä¸‹æ¬¡å®¢æˆ·ç«¯ä½¿ç”¨ HTTP è®¿é—®æ—¶ï¼Œåªè¦ `max-age` æœªè¿‡æœŸï¼Œå°±ç›´æ¥å†…éƒ¨è¿”å› 307 çŠ¶æ€ç ï¼ˆä¸ç»è¿‡æœåŠ¡å™¨ï¼‰ï¼Œç„¶åé‡å®šå‘åˆ° HTTPSã€‚\n\nä½¿ç”¨ç¤ºä¾‹ï¼š\n\n```http\nStrict-Transport-Security: max-age=31536000; includeSubDomains\n```\n\n> `includeSubDomains` è¡¨ç¤ºå¯¹å­åŸŸåä¹Ÿç”Ÿæ•ˆã€‚\n\nè¿™æ„å‘³ç€ä¸¤ç‚¹ï¼š\n\n- åœ¨æ¥ä¸‹æ¥çš„ 31536000 ç§’ï¼ˆå³ä¸€å¹´ï¼‰ä¸­ï¼Œå®¢æˆ·ç«¯å‘èµ· HTTP è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨å¼ºåˆ¶è·³è½¬åˆ° HTTPS\n- åœ¨æ¥ä¸‹æ¥çš„ä¸€å¹´ä¸­ï¼Œå¦‚æœæœåŠ¡å™¨å‘é€çš„ TLS è¯ä¹¦æ— æ•ˆï¼Œç”¨æˆ·ä¸èƒ½å¿½ç•¥æµè§ˆå™¨çš„è­¦å‘Šç»§ç»­è®¿é—®ç½‘ç«™\n\nä½¿ç”¨ HSTS çš„ä¸€äº›å¼Šç«¯ï¼š\n\n- ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®æŸç½‘ç«™ï¼Œè¿˜æ²¡æœ‰ç§ä¸‹ `Strict-Transport-Security` å“åº”å¤´ï¼ŒHSTS ç­–ç•¥æ— æ³•ç”Ÿæ•ˆ\n\n  > è§£å†³è¿™ä¸ªå¼Šç«¯æœ‰ä¸¤ç§æ–¹æ³•ï¼š\n  >\n  > 1. æµè§ˆå™¨é¢„ç½® HSTS åŸŸååˆ—è¡¨\n  > 2. å°† HSTS ä¿¡æ¯åŠ å…¥åˆ°åŸŸåç³»ç»Ÿè®°å½•ä¸­ï¼ˆè¿™éœ€è¦ç¡®ä¿ DNS å®‰å…¨ï¼‰\n\n- ç›´æ¥ä½¿ç”¨ IP è®¿é—®ï¼ŒHSTS ç­–ç•¥æ— æ³•ç”Ÿæ•ˆ\n- å¯ä»¥æ”¹é€šè¿‡ä¿®æ”¹ç³»ç»Ÿæ—¶é—´ç»•è¿‡ `max-age`\n\n  > æ”»å‡»è€…å¯ä»¥é€šè¿‡ä¼ªé€  NTPï¼ˆNetwork Time Protocolï¼Œç½‘ç»œæ—¶é—´åè®®ï¼‰ ä¿¡æ¯ï¼Œè®¾ç½®é”™è¯¯æ—¶é—´æ¥ç»•è¿‡ HSTSã€‚è§£å†³æ–¹æ³•æ˜¯è®¤è¯ NTP ä¿¡æ¯ï¼Œæˆ–è€…ç¦æ­¢ NTP å¤§å¹…åº¦å¢å‡æ—¶é—´ã€‚\n\n- å¦‚æœè¯ä¹¦é”™è¯¯ï¼Œæµè§ˆå™¨ä¸€èˆ¬ä¼šæé†’å­˜åœ¨å®‰å…¨é£é™©ï¼Œä½†ä»ç„¶æä¾›ç»§ç»­è®¿é—®çš„é“¾æ¥ã€‚ä½¿ç”¨ HSTS ç­–ç•¥åï¼Œæµè§ˆå™¨å°±ä¸å†æä¾›ç»§ç»­è®¿é—®çš„é“¾æ¥äº†ï¼Œæ‰€ä»¥ä¸€æ—¦è¯ä¹¦é…ç½®é”™è¯¯ï¼Œå°±ä¼šå¼•èµ·å¾ˆå¤§çš„æ•…éšœ\n- å¦‚æœæœåŠ¡å™¨çš„ HTTPS æ²¡æœ‰é…ç½®å¥½å°±å¼€å¯äº† `Strict-Transport-Security` å“åº”å¤´ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡å™¨çš„ HTTPS é…ç½®å¥½ä¹‹å‰ï¼Œç”¨æˆ·æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œé™¤éç­‰åˆ° `max-age` è¿‡æœŸæˆ–ä½¿ç”¨ IP è®¿é—®\n\nä½¿ç”¨ HSTS çš„é¢å¤–æ”¶ç›Šï¼šèŠ‚çœä¸€æ¬¡ 302/301 é‡å®šå‘è¯·æ±‚ã€‚\n\n---\n\nå‚è€ƒèµ„æ–™ï¼š\n\n- [SSL/TLS åè®®è¿è¡Œæœºåˆ¶çš„æ¦‚è¿°](https://www.ruanyifeng.com/blog/2014/02/ssl_tls.html)\n- [æ·±å…¥æ­ç§˜ HTTPS å®‰å…¨é—®é¢˜&è¿æ¥å»ºç«‹å…¨è¿‡ç¨‹](https://zhuanlan.zhihu.com/p/22142170)\n- [ä»ç½‘ç»œåè®®çš„è§’åº¦èŠä¸€èŠæœ€è¿‘ Github è¢«å¤§è§„æ¨¡æ”»å‡»äº‹ä»¶](https://mp.weixin.qq.com/s/AI0mjOZxBx3bRn71CjbY3w?client=tim&ADUIN=1656081615&ADSESSION=1585797524&ADTAG=CLIENT.QQ.5603_.0&ADPUBNO=26933)\n- [SSL/TLS åŸç†è¯¦è§£](https://www.linuxidc.com/Linux/2016-05/131147.htm)\n- [HTTP over SSL/TLS](https://hit-alibaba.github.io/interview/basic/network/HTTPS.html)\n- [HSTS å­¦ä¹ ç¬”è®°](https://jjayyyyyyy.github.io/2017/04/27/HSTS.html)\n- [ä½ æ‰€ä¸çŸ¥é“çš„ HSTS](https://www.barretlee.com/blog/2015/10/22/hsts-intro/#comments)\n","tags":["SSL/TLS","HTTPS"],"categories":["Web å®‰å…¨"]},{"title":"CSS æ‹·é—®ï¼šæ°´å¹³å‚ç›´å±…ä¸­æ–¹æ³•ä½ ä¼šå‡ ç§ï¼Ÿ","url":"/2020/04/07/css-h-and-v-center/","content":"\nCSS å®ç°æ°´å¹³å‚ç›´å±…ä¸­ï¼Œè¿™æ˜¯ä¸€é“ç»å…¸çš„é¢è¯•é¢˜ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶å¼€å‘ç»å¸¸é‡è§çš„é—®é¢˜ã€‚æœ¬æ–‡æ€»ç»“äº†å¸¸ç”¨çš„æ–¹æ³•ï¼Œä»¥åŠå„ç§å¥‡æ·«å·§æŠ€ï¼Œå¹¶ä¸”ä¼šæ³¨æ˜æ¯ç§æ–¹æ³•çš„å…¼å®¹æ€§ã€‚\n\n<!-- more -->\n\nå¼€å§‹æ­£æ–‡ä¹‹å‰ï¼Œæˆ‘ä»¬å‡†å¤‡ä¸€äº›å…ƒç´ ï¼š\n\n```html\n<div class=\"outer\">\n  <div class=\"inner\">hello world</div>\n</div>\n```\n\nä¸ºäº†ä¾¿äºæŸ¥çœ‹ï¼ŒåŠ ä¸Šä¸€äº›æ ·å¼ï¼š\n\n```css\n.outer {\n  width: 300px;\n  height: 300px;\n  border: 1px solid #999;\n}\n\n.inner {\n  width: 100px;\n  height: 100px;\n  border: 1px solid #999;\n}\n```\n\n**ä¸Šé¢è¿™äº›ä»£ç ä¼šåœ¨ä¸‹æ–‡ä¸­å¤ç”¨ï¼Œå¹¶ä¸”ä¸å†æåŠï¼Œè¯·æ³¨æ„è®°å¿†ã€‚**\n\n## æ°´å¹³å‚ç›´å±…ä¸­\n\nä¸‹é¢æ˜¯æ°´å¹³å’Œå‚ç›´å±…ä¸­éƒ½é€‚ç”¨çš„æ–¹æ³•ï¼š\n\n1. Flex æ–¹æ¡ˆ\n2. Grid æ–¹æ¡ˆ\n3. `absolute` + `transform`\n4. `absolute` + `calc`\n5. `absolute` + è´Ÿ `margin`\n6. `absolute` + `margin: auto`\n7. `writing-mode`\n\n### Flex æ–¹æ¡ˆ\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  display: flex;\n  justify-content: center; /* æ°´å¹³å±…ä¸­ */\n  align-items: center; /* å‚ç›´å±…ä¸­ */\n}\n```\n\nè¯¥æ–¹æ¡ˆçš„å¦ä¸€ç§ç”¨æ³•ï¼š\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  display: flex;\n}\n\n.inner {\n  margin: auto;\n}\n```\n\nç›®å‰åœ¨ç§»åŠ¨ç«¯å·²ç»å®Œå…¨å¯ä»¥ä½¿ç”¨ Flex å¸ƒå±€äº†ï¼ŒPC ç«¯éœ€è¦çœ‹è‡ªå·±ä¸šåŠ¡çš„å…¼å®¹æ€§æƒ…å†µã€‚\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\nå…¼å®¹æ€§ï¼š\n\n- IE 10+, Chrome 4+, Firefox 2+\n- Android 2.3+, iOS 6+\n\n### Grid æ–¹æ¡ˆ\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  display: grid;\n}\n\n.inner {\n  justify-self: center; /* æ°´å¹³å±…ä¸­ */\n  align-self: center; /* å‚ç›´å±…ä¸­ */\n}\n```\n\nè¯¥æ–¹æ¡ˆçš„å¦ä¸€ç§ä½¿ç”¨æ–¹æ³•ï¼š\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  display: grid;\n}\n\n.inner {\n  margin: auto;\n}\n```\n\nè¯¥æ–¹æ¡ˆçš„å…¼å®¹æ€§æ¯” Flex å·®ä¸€ç‚¹ï¼ŒåŒæ ·çš„æ ¹æ®è‡ªå·±ä¸šåŠ¡çš„å…¼å®¹æƒ…å†µé€‰æ‹©ä½¿ç”¨ã€‚\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\nå…¼å®¹æ€§ï¼š\n\n- IE 10+, Chrome 57+, Firefox 52+\n- Android 6+, iOS 10.3+\n\n### absolute + transform\n\nCSS3 ä¸­æ–°å¢çš„ `transform`ï¼Œå…¶ `translate` å±æ€§æ˜¯æ ¹æ®å…ƒç´ è‡ªèº«è®¡ç®—çš„ã€‚ä¾‹å¦‚ï¼šè®¾ç½® `transform: translateX(-50%);`ï¼Œå…ƒç´ ä¼šå‘å·¦åç§»è‡ªèº«å®½åº¦çš„ä¸€åŠã€‚æ ¹æ®è¿™ä¸€ç‰¹æ€§ï¼Œå¾ˆå®¹æ˜“å®ç°å…ƒç´ çš„å±…ä¸­ï¼š\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  position: relative;\n}\n\n.inner {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  transform: translate(-50%, -50%);\n}\n```\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\nå…¼å®¹æ€§ï¼š\n\n- IE 9+, Chrome 4+, Firefox 3.5+\n- Android 3+, iOS 6+\n\n### absolute + calc\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  position: relative;\n}\n\n.inner {\n  position: absolute;\n  left: calc(50% - 50px);\n  top: calc(50% - 50px);\n}\n```\n\nç¼ºç‚¹ï¼šéœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\nå…¼å®¹æ€§ï¼š\n\n- IE 9+, Chrome 19+, Firefox 4+\n- Android 4.4+, iOS 6+\n\n### absolute + è´Ÿ margin\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  position: relative;\n}\n\n.inner {\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  margin-left: -50px;\n  margin-top: -50px;\n}\n```\n\nç¼ºç‚¹ï¼šéœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\nå…¼å®¹æ€§ï¼š\n\n- IE 6+, Chrome 4+, Firefox 2+\n- Android 2.3+, iOS 6+\n\n### absolute + margin: auto\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  position: relative;\n}\n\n.inner {\n  position: absolute;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  margin: auto;\n}\n```\n\nè¯¥æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼šä½¿ç”¨äº† CSS ä¸­çš„å®šä½å±æ€§ï¼ˆ`absolute`ã€`fixed` ç­‰ï¼‰åï¼Œå¦‚æœ `left` è®¾ç½®äº†å…·ä½“å€¼ï¼Œæ²¡æœ‰è®¾ç½® `right` å’Œ `width`ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨è®¡ç®—ï¼ŒæŠŠå‰©ä½™çš„ç©ºé—´åˆ†é…ç»™ `right` å’Œ `width`ã€‚å¦‚æœ `left`ã€`right` å’Œ `width` éƒ½è®¾ç½®äº†å…·ä½“å€¼ï¼Œå¹¶ä¸”æ²¡æœ‰å æ»¡æ¨ªå‘ç©ºé—´ï¼Œé‚£ä¹ˆå‰©ä½™ç©ºé—´å°±å¤„äºå¾…åˆ†é…çŠ¶æ€ï¼Œæ­¤æ—¶è®¾ç½® `margin: auto;` æ„å‘³ç€æŠŠå‰©ä½™çš„ç©ºé—´åˆ†é…ç»™ `margin`ï¼Œå¹¶ä¸”å·¦å³å‡åˆ†ï¼Œæ‰€ä»¥å°±å®ç°äº†æ°´å¹³å±…ä¸­ï¼Œå‚ç›´æ–¹å‘åŒç†ã€‚\n\nä½†æ˜¯è¦çŸ¥é“è¯¥æ–¹æ³•çš„å‰¯ä½œç”¨ï¼š\n\n- `left: 0; right: 0;` ç›¸å½“äº `width: 100%;`\n- `top: 0; bottom: 0;` ç›¸å½“äº `height: 100%;`\n\nç¼ºç‚¹ï¼šéœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ï¼Œå¦åˆ™å…¶å®½é«˜ä¼šè¢«è®¾ä¸º `100%`ï¼ˆå‰¯ä½œç”¨ï¼‰ã€‚\n\nå…¼å®¹æ€§ï¼š\n\n- IE 6+, Chrome 4+, Firefox 2+\n- Android 2.3+, iOS 6+\n\n### writing-mode\n\n`writing-mode` å¯ä»¥æ”¹å˜æ–‡å­—æ˜¾ç¤ºæ–¹å‘ã€‚ä¾‹å¦‚ï¼Œå°†æ–‡å­—æ˜¾ç¤ºä¸ºå‚ç›´æ–¹å‘ï¼š\n\n```html\n<div>å‚ç›´æ˜¾ç¤º</div>\n```\n\n```css\ndiv {\n  writing-mode: vertical-lr;\n}\n```\n\næ˜¾ç¤ºæ•ˆæœå¦‚ä¸‹ï¼š\n\n```\nå‚\nç›´\næ˜¾\nç¤º\n```\n\nè¯¥å±æ€§æœ€ç¥å¥‡çš„åœ°æ–¹åœ¨äºï¼Œä¸ä»…å¯ä»¥ä½¿æ–‡å­—æ˜¾ç¤ºæ–¹å‘æ”¹å˜ï¼Œè¿˜èƒ½ä½¿æ‰€æœ‰ä½œç”¨äºæ°´å¹³æ–¹å‘ä¸Šçš„å±æ€§ï¼Œå˜æˆä½œç”¨äºå‚ç›´æ–¹å‘ã€‚æ‰€ä»¥ï¼Œé€šè¿‡ `writing-mode` å’Œ `text-align: center` å°±å¯ä»¥å®ç°å‚ç›´å±…ä¸­äº†ã€‚\n\nè¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ”¹é€ ä¸‹å¤ç”¨ä»£ç ä¸­çš„ DOM ç»“æ„ï¼š\n\n```html\n<div class=\"outer\">\n  <div class=\"inner\">\n    <div class=\"content\"></div>\n  </div>\n</div>\n```\n\nç„¶åï¼Œè¯¥æ–¹æ¡ˆçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  writing-mode: vertical-lr;\n  text-align: center;\n}\n\n.inner {\n  display: inline-block;\n  width: 100%;\n  height: auto;\n  writing-mode: horizontal-tb;\n  text-align: center;\n}\n\n.content {\n  display: inline-block;\n  text-align: left; /* é‡ç½®æ–‡å­—ä½ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ */\n}\n```\n\nç¼ºç‚¹ï¼šéœ€è¦ä¿®æ”¹ DOM ç»“æ„ï¼ˆä¸ºäº†å±…ä¸­å…ƒç´ ï¼Œéœ€è¦åµŒå¥—ä¸¤å±‚çˆ¶å…ƒç´ ï¼‰ã€‚\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\nå…¼å®¹æ€§ï¼š\n\n- IE 6+, Chrome 4+, Firefox 3.5+\n- Android 2.3+, iOS 5.1+\n\n## æ°´å¹³å±…ä¸­\n\nä¸‹é¢ä»‹ç»åªé€‚ç”¨äºæ°´å¹³å±…ä¸­çš„æ–¹æ¡ˆï¼š\n\n1. `margin: auto`\n2. `text-align` + `inline-block`\n3. `fit-content` + `margin`\n\n### margin: auto\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.inner {\n  display: block; /* è¿˜å¯ä»¥æ˜¯ table | flex | gridï¼Œä½†ä¸èƒ½æ˜¯ inline-xxx */\n  margin: 0 auto;\n}\n```\n\nè¯¥æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼šå…ƒç´ è¢«è®¾ç½®æˆå—çº§åï¼Œä¼šç‹¬å ä¸€è¡Œï¼Œå¦‚æœå…¶å®½åº¦æ²¡æœ‰å æ»¡æ¨ªå‘ç©ºé—´ï¼Œé‚£ä¹ˆå‰©ä½™çš„ç©ºé—´å°±å¤„äºå¾…åˆ†é…çŠ¶æ€ï¼Œæ­¤æ—¶è®¾ç½® `margin: auto;` æ„å‘³ç€æŠŠå‰©ä½™çš„ç©ºé—´åˆ†é…ç»™ `margin`ï¼Œå¹¶ä¸”å·¦å³å‡åˆ†ï¼Œæ‰€ä»¥å°±å®ç°äº†æ°´å¹³å±…ä¸­ã€‚\n\nç¼ºç‚¹ï¼šéœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½ã€‚\n\n### text-align + inline-block\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  text-align: center;\n}\n\n.inner {\n  display: inline-block;\n  text-align: left; /* é‡ç½®æ–‡å­—ä½ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ */\n}\n```\n\nè¯¥æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼šä¸Šé¢ä»£ç ä¸­çš„ `text-align: center;` ä¼šä½¿æ–‡æœ¬å±…ä¸­ï¼Œä½†æ˜¯å¯¹å—çº§å…ƒç´ æ— æ•ˆï¼Œå¦‚æœå°†å…ƒç´ è®¾ç½®ä¸º `inline-block`ï¼Œè¯¥å…ƒç´ å°±ä¼šè¢«å½“åšæ–‡æœ¬å¯¹å¾…ï¼Œä»è€Œå®ç°å…ƒç´ å±…ä¸­ã€‚\n\nç¼ºç‚¹ï¼šä¸ºäº†å±…ä¸­å…ƒç´ ï¼Œä½¿æ–‡æœ¬ä¹Ÿå±…ä¸­äº†ï¼Œå› æ­¤å¯èƒ½éœ€è¦é‡ç½®æ–‡æœ¬ä½ç½®ã€‚\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½ã€‚\n\n### fit-content + margin\n\nè¯¥æ–¹æ¡ˆç”¨æ³•æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ç›´æ¥åº”ç”¨äºå…ƒç´ ä¸Šï¼Œå¦ä¸€ç§æ˜¯åº”ç”¨äºå…ƒç´ çš„çˆ¶å…ƒç´ ä¸Šã€‚\n\n- ç›´æ¥åº”ç”¨äºå…ƒç´ ä¸Š\n\n  ```css\n  /* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n  .inner {\n    width: fit-content;\n    margin: auto;\n  }\n  ```\n\n  ç¼ºç‚¹ï¼šä¼šä½¿å…ƒç´ çš„å®½åº¦æ”¹å˜ï¼ˆåŒå†…å®¹å®½åº¦ï¼‰ã€‚\n\n- åº”ç”¨äºå…ƒç´ çš„çˆ¶å…ƒç´ ä¸Š\n\n  ```css\n  /* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n  .outer {\n    width: fit-content;\n    margin: auto;\n  }\n  ```\n\n  ä¼˜ç‚¹ï¼šå³ä½¿å­å…ƒç´ æ˜¯æµ®åŠ¨å…ƒç´ ä¹Ÿé€‚ç”¨ã€‚\n\nç”±äºç›®å‰ `fit-content` å±æ€§å…¼å®¹æ€§è¾ƒå·®ï¼Œå› æ­¤è¯¥æ–¹æ¡ˆä¸æ¨èä½¿ç”¨ã€‚\n\n## å‚ç›´å±…ä¸­\n\nä¸‹é¢ä»‹ç»åªé€‚ç”¨äºå‚ç›´å±…ä¸­çš„æ–¹æ¡ˆï¼š\n\n1. `table-cell` + `vertical-align`\n2. `inline-block` + `line-height`\n3. `inline-block` + `vertical-align`\n\n### table-cell + vertical-align\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  display: table-cell;\n  vertical-align: middle;\n}\n```\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„é«˜ã€‚\n\nè¯¥æ–¹æ¡ˆå¯é…åˆæ°´å¹³å±…ä¸­çš„æ–¹æ¡ˆ 1ã€2ï¼Œå®ç°æ°´å¹³å‚ç›´å±…ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n- é…åˆæ°´å¹³å±…ä¸­æ–¹æ¡ˆ 1\n\n  ```css\n  /* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n  .outer {\n    display: table-cell;\n    vertical-align: middle;\n  }\n\n  .inner {\n    display: block; /* è¿˜å¯ä»¥æ˜¯ table | flex | gridï¼Œä½†ä¸èƒ½æ˜¯ inline-xxx */\n    margin: 0 auto;\n  }\n  ```\n\n  ç¼ºç‚¹ï¼šéœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½ã€‚\n\n  ä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„é«˜ã€‚\n\n- é…åˆæ°´å¹³å±…ä¸­æ–¹æ¡ˆ 2\n\n  ```css\n  /* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n  .outer {\n    display: table-cell;\n    vertical-align: middle;\n\n    text-align: center;\n  }\n\n  .inner {\n    display: inline-block;\n\n    text-align: left; /* é‡ç½®æ–‡å­—ä½ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ */\n  }\n  ```\n\n  ä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\n### inline-block + line-height\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  line-height: 300px;\n}\n\n.inner {\n  line-height: initial; /* é‡ç½® */\n  vertical-align: middle;\n  display: inline-block;\n}\n```\n\nä¼—æ‰€å‘¨çŸ¥ï¼Œå…ƒç´ çš„ `height` å’Œ `line-height` ç›¸åŒçš„æ—¶å€™ï¼Œä¼šä½¿å…¶æ–‡æœ¬å†…å®¹å‚ç›´å±…ä¸­ã€‚å› æ­¤è¯¥æ–¹æ¡ˆåˆ©ç”¨äº†è¿™ä¸€ç‰¹ç‚¹ï¼Œä¸è¿‡æ–‡æœ¬å†…å®¹è™½ç„¶å‚ç›´å±…ä¸­äº†ï¼Œä½†æ˜¯å…ƒç´ å¹¶æ²¡æœ‰ï¼Œå› æ­¤å†å°†å…ƒç´ è®¾ç½®ä¸º `inline-block`ï¼Œè¿™æ ·å…ƒç´ å°±ä¼šè¢«å½“åšæ–‡æœ¬å¯¹å¾…äº†ã€‚åŒæ—¶ç”±äºå…·æœ‰äº† `inline` å±æ€§ï¼Œ`vertical-align: middle;` ä¹Ÿå°±å¯ä»¥ç”Ÿæ•ˆäº†ã€‚\n\nç¼ºç‚¹ï¼šéœ€è¦çŸ¥é“å…¶çˆ¶å…ƒç´ é«˜åº¦ã€‚\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„é«˜ã€‚\n\nè¯¥æ–¹æ¡ˆå¯é…åˆæ°´å¹³å±…ä¸­çš„æ–¹æ¡ˆ 2ï¼Œå®ç°æ°´å¹³å‚ç›´å±…ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  line-height: 300px;\n\n  text-align: center;\n}\n\n.inner {\n  line-height: initial; /* é‡ç½®è¡Œé«˜ */\n  vertical-align: middle;\n  display: inline-block;\n\n  text-align: left; /* é‡ç½®æ–‡å­—ä½ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ */\n}\n```\n\nç¼ºç‚¹ï¼šéœ€è¦çŸ¥é“å…¶çˆ¶å…ƒç´ é«˜åº¦ã€‚\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\n### inline-block + vertical-align\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer::after {\n  content: \"\";\n  display: inline-block;\n  vertical-align: middle;\n  height: 100%;\n}\n\n.inner {\n  display: inline-block;\n  vertical-align: middle;\n}\n```\n\nè¯¥æ–¹æ¡ˆçš„åŸç†æ˜¯ï¼šåœ¨å±…ä¸­å…ƒç´ çš„çˆ¶å…ƒç´ ä¸Šï¼Œä½¿ç”¨ä¸€ä¸ªä¼ªå…ƒç´ ï¼Œå°†è¿™ä¸ªä¼ªå…ƒç´ è®¾ç½®ä¸º `inline-block` åï¼Œå°±å¥½åƒå®ƒåŸæ¥å°±æ˜¯ä¸€ä¸ªçœŸæ­£çš„ DOM å…ƒç´ ï¼Œå­˜åœ¨äºé¡µé¢ä¸Šã€‚ç„¶åå†å°†å±…ä¸­å…ƒç´ è®¾ç½®ä¸º `inline-block`ï¼Œæ ¹æ® `inline-block` çš„ç‰¹æ€§ï¼ˆå¤šä¸ªç›¸é‚»çš„ `inline-block` å…ƒç´ ä¼šæ¨ªå‘å¹¶æ’æ˜¾ç¤ºï¼‰ï¼Œå±…ä¸­å…ƒç´ ä¼šå’Œä¼ªå…ƒç´ æ¨ªå‘å¹¶æ’æ˜¾ç¤ºã€‚å¹¶ä¸”è®¾ç½® `vertical-align: middle;` åï¼Œå®ƒä»¬ä¼šäº’ç›¸å‚ç›´å¯¹é½ï¼Œæœ€åå°†ä¼ªå…ƒç´ é«˜åº¦æ’‘èµ·æ¥ `height: 100%;`ï¼Œå±…ä¸­å…ƒç´ ä¼šå¯¹é½ä¼ªå…ƒç´ ï¼Œä»è€Œå®ç°äº†å‚ç›´å±…ä¸­ã€‚\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„é«˜ã€‚\n\nè¯¥æ–¹æ¡ˆå¯é…åˆæ°´å¹³å±…ä¸­çš„æ–¹æ¡ˆ 2ï¼Œå®ç°æ°´å¹³å‚ç›´å±…ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```css\n/* è¿™é‡Œå¼•ç”¨å¤ç”¨ä»£ç  */\n\n.outer {\n  text-align: center;\n}\n\n.outer::after {\n  content: \"\";\n  display: inline-block;\n  vertical-align: middle;\n  height: 100%;\n}\n\n.inner {\n  display: inline-block;\n  vertical-align: middle;\n\n  text-align: left; /* é‡ç½®æ–‡å­—ä½ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ */\n}\n```\n\nä¼˜ç‚¹ï¼šä¸éœ€è¦å›ºå®šå±…ä¸­å…ƒç´ çš„å®½é«˜ã€‚\n\n## æ–‡ç« å°ç»“\n\næœ¬æ–‡ä»‹ç»çš„æ–¹æ³•ä¸­ï¼Œé™¤äº† `fit-content` æ–¹æ¡ˆå’Œ `Grid` æ–¹æ¡ˆå…¼å®¹æ€§è¾ƒå·®ï¼Œå…¶ä»–çš„æ–¹æ¡ˆéƒ½å¯ä»¥åœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨ã€‚æ¯ç§æ–¹æ¡ˆéƒ½æœ‰å…¶åº”ç”¨åœºæ™¯ï¼Œåº”è¯¥æ ¹æ®å®é™…ä¸šåŠ¡çµæ´»è¿ç”¨ï¼Œè€Œä¸æ˜¯ Flex ä¸€æŠŠæ¢­ã€‚\n","tags":["CSS","CSS å¸ƒå±€"],"categories":["CSS åŸºç¡€"]},{"title":"ä½¿ç”¨ Karma + Mocha + Chai æ­å»º Web å•å…ƒæµ‹è¯•ç¯å¢ƒ","url":"/2020/03/20/use-karma-mocha-chai-to-test/","content":"\næœ¬æ–‡å±äºå¯¹é…ç½®é¡¹ç›®çš„æ€»ç»“ï¼Œä¸ä¼šè¿‡å¤šè®²è§£ç›¸å…³çŸ¥è¯†ã€‚é˜…è¯»æ­£æ–‡ä¹‹å‰ï¼Œä½ éœ€è¦äº†è§£å¹¶ä½¿ç”¨è¿‡ webpackã€Babelï¼Œäº†è§£ ES6ã€CommonJS è§„èŒƒï¼Œäº†è§£è¿‡å‰ç«¯å•å…ƒæµ‹è¯•ã€‚\n\n<!-- more -->\n\n## é€‚ç”¨åœºæ™¯\n\nè¯´æ˜ä¸€ä¸‹æœ¬æ–‡çš„é€‚ç”¨åœºæ™¯ï¼š\n\n1. é¡¹ç›®ä½¿ç”¨äº† ES6 æˆ– CommonJS ç­‰æ¨¡å—åŒ–è§„èŒƒï¼Œéœ€è¦æ‰“åŒ…ç¼–è¯‘æ‰èƒ½åœ¨æµè§ˆå™¨é‡Œè¿è¡Œã€‚\n2. éœ€è¦è¿›è¡Œ DOM, BOM ç›¸å…³çš„å•å…ƒæµ‹è¯•ã€‚\n\nå¦‚æœä½ çš„é¡¹ç›®ä¸é€‚ç”¨äºä»¥ä¸Šä¸¤ç‚¹ï¼Œé‚£ä¹ˆæ²¡å¿…è¦ä½¿ç”¨ Karmaï¼Œç›´æ¥ä½¿ç”¨ Jest æˆ– Mocha + Chai + Istanbul ç»„åˆå³å¯ã€‚\n\n## ä¸ºä»€ä¹ˆä¸ç”¨ Jest\n\n[Jest](https://jestjs.io/) æ˜¯ Facebook å¼€æºçš„æµ‹è¯•æ¡†æ¶ï¼Œç®€å•æ˜“ç”¨ï¼Œåªéœ€å°‘é‡çš„é…ç½®å³å¯å¼€å§‹ä½¿ç”¨ã€‚å®ƒä½¿ç”¨äº† JSDOM æ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒæ¥æ”¯æŒæµ‹è¯•ï¼Œæé«˜äº†æ€§èƒ½ï¼Œä½†æ˜¯ä¹Ÿå¸¦æ¥äº† JSDOM çš„å±€é™æ€§ã€‚æœ€å¤§çš„é—®é¢˜æ˜¯ï¼šä¸èƒ½æ–¹ä¾¿çš„åœ¨çœŸå®çš„æµè§ˆå™¨ä¸­æµ‹è¯•ã€‚å› æ­¤éš¾å…ä¼šä½¿å¾—æµ‹è¯•ç»“æœä¸é‚£ä¹ˆå‡†ç¡®ï¼Œæ¯•ç«Ÿæ¨¡æ‹Ÿç¯å¢ƒæ— æ³•åª²ç¾çœŸå®ç¯å¢ƒã€‚\n\nå¦‚æœé¡¹ç›®æ¶‰åŠ DOMï¼ŒBOM ç›¸å…³çš„ä¸€äº›æµ‹è¯•ï¼Œå°±ä¸å¿…æµªè´¹æ—¶é—´åœ¨ Jest ä¸ŠæŠ˜è…¾äº†ï¼Œç›´æ¥ä½¿ç”¨ Karma æ‰‹åŠ¨æ­å»ºæµ‹è¯•ç¯å¢ƒåè€Œä¼šæ›´å®¹æ˜“ã€‚\n\n## è®¤è¯† Karma\n\n[Karma](https://karma-runner.github.io/latest/index.html) æ˜¯ä¸€ä¸ªå¼€æºçš„æµ‹è¯•è¿è¡Œå™¨ï¼ˆTest Runnerï¼‰ï¼Œå®ƒçš„æœ€å¤§ä¼˜åŠ¿æ˜¯ï¼šå…è®¸ä½ åœ¨å¤šç§çœŸå®çš„æµè§ˆå™¨ç¯å¢ƒä¸­æµ‹è¯•ä»£ç ã€‚èƒ½å¤Ÿå’Œä¸»æµçš„æµ‹è¯•æ¡†æ¶ï¼ˆMocha, Jasmine, QUnitï¼‰å¾ˆå¥½çš„ç»“åˆï¼Œå¹¶ä¸”æ”¯æŒ webpack å’Œ Babel çš„ä½¿ç”¨ã€‚\n\nä¸è¿‡ï¼ŒKarma çš„é…ç½®æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œå…¶å®˜æ–¹æ–‡æ¡£ä¸­ï¼Œå¹¶æ²¡æœ‰ä»‹ç»å¦‚ä½•ä» 0 åˆ° 1 è¿›è¡Œé…ç½®ï¼Œå› æ­¤å¯¹æ–°æ‰‹æ¥è¯´ä¸å¤Ÿå‹å¥½ã€‚\n\n## ä½¿ç”¨ Karma\n\nåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¼šç”¨ NPM æ¥ç®¡ç†ä¾èµ–åŒ…ï¼Œæ‰€ä»¥å…ˆåˆå§‹åŒ–å®ƒçš„é…ç½®æ–‡ä»¶ `package.json`ï¼š\n\n```bash\n$ npm init -y\n```\n\n> `-y`ï¼ˆ`--yes`ï¼‰å‚æ•°è¡¨ç¤ºä¸è¿›è¡Œè¯¢é—®ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤çš„é…ç½®ã€‚\n\nç„¶åï¼Œé¡¹ç›®çº§å®‰è£… Karmaï¼š\n\n```bash\n$ npm install --save-dev karma\n```\n\nä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬å°†å…¶å…¨å±€å®‰è£…ä¸€ä¸‹ï¼ˆè¿™é‡Œä¹Ÿå¯ä»¥ä¸å…¨å±€å®‰è£…ï¼Œç›´æ¥è·³è¿‡ï¼‰ï¼š\n\n```bash\n$ npm install --global karma\n```\n\nKarma é…ç½®æ–‡ä»¶çš„å‘½åè§„åˆ™æ˜¯ `[name].conf.js`ã€‚ä½ å¯ä»¥é€‰æ‹©æ‰‹åŠ¨ç¼–å†™ Karma çš„é…ç½®æ–‡ä»¶ï¼Œä¸è¿‡æ›´æ¨èä½¿ç”¨ CLI æ¥è‡ªåŠ¨ç”Ÿæˆï¼š\n\n```bash\n# å¦‚æœä½ å…¨å±€å®‰è£…äº† Karmaï¼Œæ‰§è¡Œè¿™ä¸ª\n$ karma init ./karma.conf.js\n\n# å¦‚æœä½ æ²¡æœ‰å…¨å±€å®‰è£… Karmaï¼Œæ‰§è¡Œè¿™ä¸ª\n$ ./node_modules/.bin/karma init ./karma.conf.js\n```\n\næ¥ä¸‹æ¥ï¼Œæ ¹æ®ä¸€ç³»åˆ—çš„æé—®è¿›è¡Œé€‰æ‹©ï¼ˆæœ¬æ–‡é€‰æ‹©çš„å†…å®¹å¦‚å›¾æ‰€ç¤ºï¼‰ï¼š\n\n![](/assets/posts/use-karma-mocha-chai-to-test/karma-init.png)\n\n1. æƒ³è¦ä½¿ç”¨çš„æµ‹è¯•æ¡†æ¶ `mocha` æˆ– `jasmine`\n   > ä¸¤è€…é€‰å…¶ä¸€å³å¯ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šå…¶å®ƒçš„ï¼Œæœ¬æ–‡ä»¥ `mocha` ä¸ºä¾‹ã€‚\n2. ä½ çš„é¡¹ç›®æ˜¯å¦ç”¨åˆ°äº† `Require.js`\n   > [Require.js](http://www.requirejs.org/) æ˜¯å¼‚æ­¥åŠ è½½è§„èŒƒï¼ˆAMDï¼‰çš„å®ç°ã€‚å¦‚æœä½ ä¸æ¸…æ¥šï¼Œç›´æ¥é€‰ `no`ã€‚\n3. æƒ³è¦æµ‹è¯•çš„æµè§ˆå™¨ç¯å¢ƒ\n   > å¯é€‰å€¼ï¼š`Chrome`, `ChromeHeadLess`, `ChromeCanary`, `Firefox`, `Safari`, `IE`, `Opera`, `PhantomJS`ã€‚\n   > å¯ä»¥æŒ‡å®šå•ä¸ªæˆ–å¤šä¸ªï¼Œæœ¬æ–‡ä»¥ `Chrome` ä¸ºä¾‹ã€‚\n4. æºæ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶çš„è·¯å¾„\n   > å…ˆè¾“å…¥æºæ–‡ä»¶çš„è·¯å¾„ï¼š`src/**/*.js`ï¼ˆä¸¾ä¾‹ï¼‰ï¼Œå›è½¦ä¹‹åï¼Œå†è¾“å…¥æµ‹è¯•æ–‡ä»¶çš„è·¯å¾„ï¼š`test/**/*.js`ï¼ˆä¸¾ä¾‹ï¼‰\n5. éœ€è¦æ’é™¤çš„æ–‡ä»¶\n6. æ˜¯å¦å…è®¸ Karma ç›‘å¬æ‰€æœ‰æ–‡ä»¶çš„å˜åŠ¨ï¼Œå¹¶åœ¨æ–‡ä»¶å‘ç”Ÿå˜åŠ¨æ—¶ï¼Œé‡æ–°æ‰§è¡Œæµ‹è¯•\n\næ ¹æ®ä¸Šé¢é€‰æ‹©çš„é¡¹ï¼Œä¼šè‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹å†…å®¹ï¼ˆè¿™é‡Œå»æ‰äº†é»˜è®¤æ³¨é‡Šï¼Œå¹¶åŠ ä¸Šäº†ä¸­æ–‡æ³¨é‡Šï¼‰ï¼š\n\n```js\n// karma.conf.js\n\nmodule.exports = function(config) {\n  config.set({\n    // è·¯å¾„å‰ç¼€\n    basePath: \"\",\n\n    // ç”¨åˆ°çš„åº“æˆ–æ¡†æ¶\n    // æ·»åŠ åˆ°è¿™é‡Œè¡¨ç¤ºæ³¨å†Œä¸ºå…¨å±€å˜é‡ï¼ˆä¸ç”¨åå¤åœ¨ä»£ç ä¸­ import æˆ– requireï¼‰\n    frameworks: [\"mocha\"],\n\n    // éœ€è¦æä¾›ç»™æµè§ˆå™¨çš„æºæ–‡ä»¶å’Œæµ‹è¯•æ–‡ä»¶\n    files: [\"src/**/*.js\", \"test/**/*.js\"],\n\n    // éœ€è¦æ’é™¤çš„æ–‡ä»¶\n    exclude: [],\n\n    // å°†æ–‡ä»¶æä¾›ç»™æµè§ˆå™¨ä¹‹å‰ï¼Œè¿›è¡Œé¢„å¤„ç†\n    preprocessors: {},\n\n    // æµ‹è¯•ä¿¡æ¯æŠ¥å‘Šå™¨\n    reporters: [\"progress\"],\n\n    // åœ¨æµè§ˆå™¨ä¸­è¿è¡Œçš„ç«¯å£\n    port: 9876,\n\n    // æ˜¯å¦å°†è¾“å‡ºä¿¡æ¯å½©è‰²æ˜¾ç¤ºï¼ˆç”¨äº reporters å’Œæ—¥å¿—ä¿¡æ¯ï¼‰\n    colors: true,\n\n    // æ˜¾ç¤ºæ—¥å¿—çš„çº§åˆ«\n    logLevel: config.LOG_INFO,\n\n    // æ˜¯å¦ç›‘å¬æ‰€æœ‰æ–‡ä»¶çš„å˜åŠ¨\n    autoWatch: true,\n\n    // éœ€è¦æµ‹è¯•çš„æµè§ˆå™¨ç¯å¢ƒ\n    browsers: [\"Chrome\"],\n\n    // å¦‚æœä¸º true çš„è¯ï¼ŒKarma å°†æ•è·æµè§ˆå™¨ï¼Œè¿è¡Œæµ‹è¯•ï¼Œå¹¶è‡ªåŠ¨é€€å‡º\n    // ä½¿ç”¨æŒç»­é›†æˆæ—¶ä¼šç”¨åˆ°è¯¥é€‰é¡¹ï¼ˆè¿™é‡Œå…ˆé»˜è®¤ï¼Œåé¢ä¼šè¯´æ˜ï¼‰\n    singleRun: false,\n\n    // å…è®¸åŒæ—¶å¯åŠ¨çš„æµè§ˆå™¨ä¸ªæ•°ï¼Œé»˜è®¤æ— é™ä¸ª\n    concurrency: Infinity\n  });\n};\n```\n\n## å®‰è£…æ’ä»¶\n\nåˆå§‹åŒ– Karma çš„é…ç½®æ–‡ä»¶åï¼Œé¦–å…ˆéœ€è¦æ ¹æ®ä½ é€‰æ‹©çš„å†…å®¹ï¼Œå®‰è£…ç›¸å…³æ’ä»¶ï¼š\n\n1. æœ¬æ–‡é€‰æ‹©äº† Mocha æµ‹è¯•æ¡†æ¶ï¼Œéœ€è¦å®‰è£… `mocha` å’Œ `karma-mocha` æ’ä»¶ï¼š\n\n   ```bash\n   $ npm install --save-dev mocha karma-mocha\n   ```\n\n   > å…¶ä¸­ `karma-mocha` çš„ä½œç”¨æ˜¯è®© `mocha` å¯ä»¥åœ¨ Karma ä¸­å·¥ä½œã€‚\n\n2. æµ‹è¯•çš„æµè§ˆå™¨æˆ‘é€‰æ‹©äº† Chromeï¼Œéœ€è¦å®‰è£… `karma-chrome-launcher` æ’ä»¶ï¼š\n\n   ```bash\n   $ npm install --save-dev karma-chrome-launcher\n   ```\n\n   > è¯¥æ’ä»¶ç”¨äºåœ¨æµ‹è¯•çš„æ—¶å€™ï¼Œè‡ªåŠ¨æ§åˆ¶å¯¹åº”çš„æµè§ˆå™¨ï¼Œä½ ä¸éœ€è¦å¯¹æµè§ˆå™¨è¿›è¡Œä»»ä½•æ“ä½œï¼Œå› ä¸º Karma ä»…ä»…æ˜¯å€Ÿç”¨æµè§ˆå™¨çš„ç¯å¢ƒè€Œå·²ã€‚\n   >\n   > å¦‚æœä½ é€‰æ‹©äº†å…¶ä»–æµè§ˆå™¨ï¼Œå®‰è£…å¯¹åº”çš„æ’ä»¶å³å¯ã€‚ä¾‹å¦‚é€‰æ‹© FireFoxï¼Œåˆ™éœ€è¦å®‰è£… `karma-firefox-launcher` æ’ä»¶ã€‚\n\nè¿™é‡Œåªæ˜¯å®‰è£…äº†æœ€åŸºæœ¬çš„æ’ä»¶ï¼Œå…¶å®ƒæ’ä»¶çš„å®‰è£…ä¼šåœ¨åé¢ç”¨åˆ°æ—¶è¯´æ˜ã€‚\n\nä¸ºäº†æ–¹ä¾¿è¯»è€…ï¼Œæˆ‘ä¸ºæœ¬æ–‡å»ºäº†ä¸€ä¸ª Github ä»“åº“ï¼š[\nliuyib/karma-mocha-demo](https://github.com/liuyib/karma-mocha-demo)ã€‚å¦‚æœæŸäº›ä¿®æ”¹çš„åœ°æ–¹ä¸å¤ªæ¸…æ¥šï¼Œå¯ä»¥å‚è€ƒè¯¥ä»“åº“ä¸­çš„ commit è®°å½•ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œæœ¬æ–‡ç¤ºä¾‹ä¸­æ‰€åšçš„ä¿®æ”¹åœ¨[è¿™é‡Œ](https://github.com/liuyib/karma-mocha-demo/commit/cfb20fd3a663bfe819350895edb9944d0cceb8b8)æŸ¥çœ‹ã€‚\n\n## ç¼–å†™ä»£ç \n\nä¸ºäº†ä½¿æœ¬æ–‡çš„ç¤ºä¾‹æ›´å…·æœ‰å‚è€ƒæ€§ï¼Œè¿™é‡Œæ–°å»ºä¸¤ä¸ªæ¨¡å— `utils.js` å’Œ `main.js`ã€‚\n\nåœ¨ `src` ç›®å½•ä¸‹ï¼Œæ–°å»º `utils.js`ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š\n\n```js\n// utils.js\n\n// ä¸€ä¸ªåŠ æ³•å‡½æ•°ï¼Œè¿”å›ä¸¤æ•°ä¹‹å’Œ\nexport function add(a, b) {\n  return a + b;\n}\n```\n\nç„¶åï¼Œåœ¨ `src` ç›®å½•ä¸‹ï¼Œæ–°å»º `main.js`ï¼Œç¼–å†™å¦‚ä¸‹ä»£ç ï¼š\n\n```js\n// main.js\n\nimport { add } from \"./utils\";\n\nvar main = function(selector) {\n  var elem = document.querySelector(selector);\n\n  elem.addEventListener(\"click\", function() {\n    var value = parseInt(elem.innerText, 10);\n    elem.innerText = add(value, 1);\n  });\n};\n\nexport default main;\n```\n\nä¸Šé¢è¿™æ®µä»£ç çš„ä½œç”¨ä¸éš¾çœ‹å‡ºï¼Œå°±æ˜¯æ ¹æ®ä¼ å…¥çš„é€‰æ‹©å™¨è·å– DOM å…ƒç´ ï¼Œç„¶åç›‘å¬è¯¥å…ƒç´ çš„ `click` äº‹ä»¶ï¼Œå½“ç”¨æˆ·ç‚¹å‡»æ—¶ï¼Œå°†è¯¥å…ƒç´ å†…å®¹ + 1ï¼ˆä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå‡è®¾è¯¥å…ƒç´ å†…å®¹æ˜¯æ•°å­—ï¼‰ã€‚\n\nä¸‹æ–‡ä¸­æˆ‘ä»¬ä¼šä»‹ç»åˆ°ï¼Œå¦‚ä½•æµ‹è¯•â€œDOM ç›¸å…³çš„æ“ä½œâ€å’Œâ€œéœ€è¦ç”¨æˆ·äº¤äº’çš„é€»è¾‘â€ã€‚\n\n## ä½¿ç”¨ Babel\n\nç”±äºæˆ‘ä»¬çš„ä»£ç ä¸­ç”¨åˆ°äº† ES6 è¯­æ³•ï¼Œæ‰€ä»¥éœ€è¦ç”¨ Babel ç¼–è¯‘ä¸€ä¸‹ï¼Œå®‰è£… Babel å’Œ webpack ç›¸å…³æ’ä»¶ï¼š\n\n```bash\n$ npm install --save-dev @babel/core @babel/preset-env babel-loader webpack\n```\n\n> è¿™é‡Œå®‰è£…çš„ä¾èµ–ç‰ˆæœ¬åˆ†åˆ«ä¸º `babel 7.x` | `babel-loader 8.x` | `webpack 4.x`\n>\n> è¯¦è§ï¼šhttps://github.com/babel/babel-loader#install\n\n- `@babel/core`ï¼ˆæ—§ç‰ˆåç§° `babel-core`ï¼Œå·²åºŸå¼ƒï¼Œä¸æ¨èï¼‰ï¼šæ˜¯ Babel è¯­æ³•åˆ†æçš„æ ¸å¿ƒï¼Œå¾ˆå¤š Babel æ’ä»¶ä¾èµ–äºå®ƒã€‚\n- `@babel/preset-env`ï¼ˆæ—§ç‰ˆåç§° `babel-preset-env`ï¼Œå·²åºŸå¼ƒï¼Œä¸æ¨èï¼‰ï¼šä¼šæ£€æµ‹ä½ çš„é…ç½®æˆ–è¿è¡Œç¯å¢ƒï¼Œå°†ä»£ç ç¼–è¯‘åˆ°åˆé€‚ç‰ˆæœ¬ã€‚\n- `babel-loader`ï¼šå…è®¸ä½ ä½¿ç”¨ Babel å’Œ webpack è½¬è¯‘ JavaScript æ–‡ä»¶ã€‚\n- `webpack`ï¼šè´Ÿè´£æ‰“åŒ…ç¼–è¯‘ã€‚\n\n> å¦‚æœä½¿ç”¨ CommonJS è§„èŒƒï¼Œå¹¶ä¸”æƒ³è¦è¿è¡Œåœ¨æµè§ˆå™¨ä¸­ï¼Œé‚£ä¹ˆä¹Ÿéœ€è¦ä½¿ç”¨ Babel ç¼–è¯‘ã€‚\n\n## é…ç½® webpack\n\né¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å®‰è£… `karma-webpack` æ’ä»¶ï¼š\n\n```bash\n$ npm install --save-dev karma-webpack\n```\n\n> è¯¥æ’ä»¶çš„ä½œç”¨æ˜¯è®© `webpack` å¯ä»¥åœ¨ Karma ä¸­å·¥ä½œã€‚\n\nç„¶åï¼Œå‚ç…§è¯¥æ’ä»¶çš„[æ–‡æ¡£](https://github.com/webpack-contrib/karma-webpack)è¿›è¡Œé…ç½®ï¼Œä¿®æ”¹ `karma.conf.js` æ–‡ä»¶ï¼š\n\n```js\n...\npreprocessors: {\n  // åŒ¹é…æºæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ webpack è¿›è¡Œé¢„å¤„ç†\n  'src/**/*.js': ['webpack'],\n  // åŒ¹é…æµ‹è¯•æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ webpack è¿›è¡Œé¢„å¤„ç†\n  'test/**/*.js': ['webpack']\n},\n...\n```\n\nä¸Šé¢çš„é…ç½®ä½œç”¨æ˜¯ï¼šåœ¨æ–‡ä»¶æä¾›ç»™æµè§ˆå™¨è¿è¡Œä¹‹å‰ï¼Œä½¿ç”¨ webpack è¿›è¡Œé¢„å¤„ç†ã€‚å½“ç„¶ä½ å¯ä»¥ç»§ç»­æ·»åŠ å…¶å®ƒæ’ä»¶æ¥å¤„ç†æ–‡ä»¶ï¼Œç”¨æ³•åŒä¸Šï¼Œå³ï¼š`['æ’ä»¶åç§°', 'æ’ä»¶åç§°', ...]`ã€‚\n\næ¥ä¸‹æ¥ï¼Œä½ éœ€è¦è‡ªå·±é…ç½® webpackï¼Œåœ¨ `karma.conf.js` æ–‡ä»¶é‡Œæ·»åŠ  `webpack: {}` é…ç½®é¡¹ï¼Œç„¶åå‚ç…§ webpack [æ–‡æ¡£](https://webpack.js.org/concepts/)è¿›è¡Œé…ç½®ï¼Œä¸‹é¢æ˜¯ä¸€äº›é…ç½®ç¤ºä¾‹ã€‚\n\nå¦‚æœä½ çš„é¡¹ç›®åªéœ€è¦æŠŠ ES6+ è¯­æ³•ç¼–è¯‘åˆ° ES5ï¼Œé‚£ä¹ˆåªè¿›è¡Œä¸‹é¢çš„é…ç½®å³å¯ï¼Œä¿®æ”¹ `karma.conf.js` æ–‡ä»¶ï¼š\n\n```js\n...\nwebpack: {\n  mode: 'development',\n  module: {\n    rules: [\n      {\n        // åŒ¹é… JavaScript æ–‡ä»¶\n        test: /\\.js$/,\n        // æ’é™¤ node_modules å’Œ bower_components ç›®å½•\n        exclude: /(node_modules|bower_components)/,\n        use: {\n          // ä½¿ç”¨çš„ loader\n          loader: 'babel-loader',\n          // ä¼ é€’ç»™ babel-loader çš„å‚æ•°\n          options: {\n            presets: ['@babel/preset-env']\n          }\n        }\n      }\n    ]\n  }\n},\n...\n```\n\nå…¶ä¸­ï¼Œä¼ é€’ç»™ `babel-loader` çš„å‚æ•°ï¼Œæ›´**æ¨è**å†™å…¥ `.babelrc` æ–‡ä»¶ä¸­ï¼š\n\n```js\n// .babelrc\n{\n  \"presets\": [\"@babel/preset-env\"]\n}\n```\n\nå¯¹äºæœ¬æ–‡çš„ç¤ºä¾‹ä»£ç æ¥è¯´ï¼Œåªéœ€è¦å°† ES6+ è¯­æ³•ç¼–è¯‘åˆ° ES5ï¼Œä¸Šé¢çš„é…ç½®è¶³å¤Ÿä½¿ç”¨ã€‚å› æ­¤ï¼Œå¦‚æœä½ éœ€è¦æ›´å¤æ‚çš„é…ç½®ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹ webpack çš„æ–‡æ¡£ã€‚\n\n> åˆ°æ­¤ä¸ºæ­¢ï¼Œè¯»è€…å¯ä»¥è®¿é—®[è¿™é‡Œ](https://github.com/liuyib/karma-mocha-demo/commit/fc4c77e421c9ae297c604418bfb1697c94b12817)ï¼ŒæŸ¥çœ‹æ‰€åšçš„ä¿®æ”¹ã€‚\n\n## å¯åŠ¨ Karma\n\nåœ¨ `package.json` ä¸­æ·»åŠ ä¸€æ¡ NPM æŒ‡ä»¤ï¼š\n\n```json\n...\n\"script\": {\n  \"test\": \"karma start ./karma.conf.js\"\n},\n...\n```\n\nç„¶ååœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ `npm run test`ï¼Œå¦‚æœæ§åˆ¶å°ä¸­æ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œå¹¶ä¸” Karma è‡ªåŠ¨æ‰“å¼€äº†ä½ é€‰æ‹©çš„æµè§ˆå™¨ï¼Œè¯æ˜ä½ çš„ä¸Šè¿°é…ç½®æ²¡æœ‰é—®é¢˜ã€‚å¦åˆ™ï¼Œä½ éœ€è¦æ£€æŸ¥ä¹‹å‰çš„é…ç½®æ˜¯å¦æ­£ç¡®ã€‚\n\n## ç¼–å†™æµ‹è¯•ä»£ç \n\né¦–å…ˆï¼Œå®‰è£…æ–­è¨€åº“ `chai` å’Œ `karma-chai`ï¼š\n\n```bash\n$ npm install --save-dev chai karma-chai\n```\n\n> å…¶ä¸­ `karma-chai` çš„ä½œç”¨æ˜¯è®© `chai` å¯ä»¥åœ¨ Karma ä¸­å·¥ä½œã€‚\n\nç„¶åå…¨å±€å¼•å…¥ Chaiï¼Œä¿®æ”¹ `karma.conf.js` æ–‡ä»¶ï¼š\n\n```js\n...\nframeworks: ['mocha', 'chai'],\n...\n```\n\nä½ ä¹Ÿå¯ä»¥ä¸å…¨å±€å¼•å…¥ï¼Œé‚£ä¹ˆä½ å¿…é¡»åœ¨æ–‡ä»¶ä¸­ï¼Œæ‰‹åŠ¨è¿›è¡Œ `import` æˆ– `require`ï¼š\n\n```js\nimport { expect } form 'chai';         // ES6\n// æˆ–\nconst expect = require('chai').expect; // CommonJS\n```\n\né€šå¸¸ï¼Œæµ‹è¯•æ–‡ä»¶ä¸æ‰€è¦æµ‹è¯•çš„æºæ–‡ä»¶åŒåï¼Œä½†æ˜¯åç¼€åä¸º `.test.js`ï¼ˆè¡¨ç¤ºæµ‹è¯•ï¼‰æˆ– `.spec.js`ï¼ˆè¡¨ç¤ºè§„æ ¼ï¼‰ã€‚\n\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¼€å§‹ç¼–å†™æµ‹è¯•ä»£ç ã€‚é¦–å…ˆæ¥æµ‹è¯• `utils` æ¨¡å—ï¼Œåœ¨ `test` ç›®å½•ä¸‹ï¼Œæ–°å»º `utils.test.js`ï¼š\n\n```js\n// utils.test.js\n\nimport { add } from \"../src/utils\";\n\ndescribe(\"utils::add test\", function() {\n  it(\"should 3 when add(1, 2) return\", function() {\n    expect(add(1, 2)).to.equal(3);\n  });\n});\n```\n\nä¸Šè¿°ä»£ç ä¸­ï¼š\n\n- `describe` å—ç§°ä¸ºâ€œæµ‹è¯•å¥—ä»¶ï¼ˆtest suiteï¼‰â€ï¼Œè¡¨ç¤ºä¸€ç»„ç›¸å…³çš„æµ‹è¯•ã€‚å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•å¥—ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®é™…æ‰§è¡Œçš„å‡½æ•°ã€‚\n\n- `it` å—ç§°ä¸ºâ€œæµ‹è¯•ç”¨ä¾‹ï¼ˆtest caseï¼‰â€ï¼Œè¡¨ç¤ºä¸€ä¸ªå•ç‹¬çš„æµ‹è¯•ï¼Œæ˜¯æµ‹è¯•çš„æœ€å°å•ä½ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•ç”¨ä¾‹çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®é™…æ‰§è¡Œçš„å‡½æ•°ã€‚\n\næœ¬æ–‡ä½¿ç”¨äº† expect é£æ ¼çš„æ–­è¨€ï¼Œå…¶ç‰¹ç‚¹æ˜¯æ›´æ¥è¿‘è‡ªç„¶è¯­è¨€ã€‚ä¾‹å¦‚ä¸Šé¢çš„ä»£ç ä¸­ï¼š`expect(add(1, 2)).to.equal(3)`ï¼Œæ„æ€æ˜¯â€œæœŸæœ› `add(1, 2)` ç­‰äº `3`â€ã€‚å¦‚æœè¿™ä¸ªæ–­è¨€ä¸ºçœŸï¼Œåˆ™å¯¹åº”æµ‹è¯•ç”¨ä¾‹é€šè¿‡ï¼Œå¦åˆ™ä¸é€šè¿‡ã€‚\n\nç„¶åï¼Œå†æ¥æµ‹è¯• `main` æ¨¡å—ï¼Œåœ¨ `test` ç›®å½•ä¸‹ï¼Œæ–°å»º `main.test.js`ï¼š\n\n```js\n// main.test.js\n\nimport main from \"../src/main\";\n\ndescribe(\"main::DOM test\", function() {\n  // é’©å­å‡½æ•°\n  beforeEach(function() {\n    // å‘é¡µé¢çš„ body å…ƒç´ ä¸­æ·»åŠ  DOM å…ƒç´ ï¼Œæ¥è¾…åŠ©æµ‹è¯•\n    document.body.innerHTML = '<button id=\"btn\">0</button>';\n\n    main(\"#btn\");\n  });\n\n  it(\"should 1 when button is clicked once\", function() {\n    // è·å–å‰é¢æ·»åŠ çš„å…ƒç´ \n    var btn = document.querySelector(\"#btn\");\n    // æ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»\n    btn.click();\n\n    expect(btn.innerText).to.equal(\"1\");\n  });\n});\n```\n\n> ä¸Šè¿°ä»£ç ä¸­ï¼Œ`beforeEach` æ˜¯ Mocha æä¾›çš„é’©å­å‡½æ•°ï¼Œä½œç”¨æ˜¯ï¼šåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼ˆ`it` å—ï¼‰æ‰§è¡Œä¹‹å‰ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚\n>\n> ç±»ä¼¼çš„ Mocha æä¾›çš„é’©å­å‡½æ•°æ€»å…±æœ‰å››ä¸ªï¼š`before`, `after`, `beforeEach`, `afterEach`ã€‚å®ƒä»¬çš„å…·ä½“ä½œç”¨è¿™é‡Œä¸å†ä»‹ç»ã€‚\n\nå¦‚æœæƒ³è¦æµ‹è¯• DOM ç›¸å…³çš„æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦åœ¨æµ‹è¯•ä¹‹å‰ï¼Œå‘é¡µé¢ä¸­æ·»åŠ éœ€è¦ç”¨åˆ°çš„å…ƒç´ ï¼Œä¾‹å¦‚ä¸Šè¿°ç¤ºä¾‹ä»£ç ä¸­çš„ `document.body.innerHTML = '<button id=\"btn\">0</button>';`ã€‚\n\næ¥ç€ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ç”¨ä¾‹ï¼ˆ`it` å—ï¼‰ä¸­ï¼Œè·å–äº†æå‰æ·»åŠ å¥½çš„ DOM å…ƒç´ ï¼Œç„¶åé€šè¿‡ `btn.click();` æ¥ä¸»åŠ¨è§¦å‘è¯¥å…ƒç´ çš„ç‚¹å‡»äº‹ä»¶ï¼Œä»è€Œæ¨¡æ‹Ÿäº†ç”¨æˆ·æ“ä½œã€‚\n\næœ€åï¼Œè¿›è¡Œæ–­è¨€æ¥å®Œæˆæµ‹è¯•ï¼š`expect(btn.innerText).to.equal('1');`ã€‚\n\n> åˆ°æ­¤ä¸ºæ­¢ï¼Œè¯»è€…å¯ä»¥è®¿é—®[è¿™é‡Œ](https://github.com/liuyib/karma-mocha-demo/commit/69748d28ac7cf17b6ac761fb3629055aa88590f2)ï¼ŒæŸ¥çœ‹æ‰€åšçš„ä¿®æ”¹ã€‚\n\n## æ±‡æŠ¥æµ‹è¯•ç»“æœ\n\nç¼–å†™å®Œæµ‹è¯•ä»£ç åï¼Œæ‰§è¡Œæµ‹è¯•æŒ‡ä»¤ `npm run test`ï¼ŒKarma ä¼šä½¿ç”¨é»˜è®¤çš„æŠ¥å‘Šå™¨æ¥æ±‡æŠ¥æµ‹è¯•ç»“æœï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n\n![](/assets/posts/use-karma-mocha-chai-to-test/karma-default-reporter.png)\n\n{% note success %}\nå¦‚æœä½ æƒ³ä½¿ç”¨é»˜è®¤çš„æŠ¥å‘Šå™¨ï¼Œè¯·ç›´æ¥è·³è¿‡ä¸‹é¢è¿™æ®µã€‚\n{% endnote %}\n\nè¿™é‡Œåˆ—ä¸¾å‡ ä¸ªå¸¸ç”¨çš„æŠ¥å‘Šå™¨æ’ä»¶ï¼š\n\n- [karma-spec-reporter](https://github.com/mlex/karma-spec-reporter)\n- [karma-mocha-reporter](https://github.com/litixsoft/karma-mocha-reporter)\n- [karma-nyan-reporter](https://github.com/dgarlitt/karma-nyan-reporter)\n\n> æŸ¥çœ‹æ›´å¤šæŠ¥å‘Šå™¨æ’ä»¶è¯·è®¿é—®ï¼š[https://npmjs.org/browse/keyword/karma-reporter](https://npmjs.org/browse/keyword/karma-reporter)\n\n> æ³¨æ„ï¼Œè¿™äº›æ’ä»¶çš„æ–‡æ¡£ä¸­æŒ‡å‡ºäº† `karma.conf.js` ä¸­çš„ `plugins` é…ç½®é¡¹ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä»¥ `karma-` å¼€å¤´å‘½åçš„æ’ä»¶ï¼Œä¼šè‡ªåŠ¨è¢« Karma å¼•å…¥ï¼Œæ‰€ä»¥ä¸€èˆ¬ä½ ä¸éœ€è¦æŒ‡å®š `plugins` é…ç½®é¡¹ã€‚ä½†è¦çŸ¥é“ï¼Œä¸€æ—¦ä½ è®¾ç½®äº† `plugins` é…ç½®é¡¹ï¼Œå°±å¿…é¡»å¼•å…¥**æ‰€æœ‰**ä»¥ `karma-` å¼€å¤´çš„æ’ä»¶ï¼Œå¦åˆ™è¯·ç›´æ¥ç•™ç©ºã€‚\n\næœ¬æ–‡ä»¥ `karma-spec-reporter` ä½œä¸ºç¤ºä¾‹ï¼Œé¦–å…ˆå®‰è£…æ’ä»¶ï¼š\n\n```bash\n$ npm install --save-dev karma-spec-reporter\n```\n\né…ç½®ä¹Ÿå¾ˆç®€å•ï¼Œåªéœ€è¦ä¿®æ”¹ `karma.conf.js` æ–‡ä»¶ï¼š\n\n```js\n...\nreporters: ['spec'],\n...\n```\n\nç„¶åæ‰§è¡Œ `npm run test`ï¼Œæ§åˆ¶å°ä¼šè¾“å‡º â€œå“ªäº›æµ‹è¯•ç”¨ä¾‹é€šè¿‡äº†ï¼Œå“ªäº›æ²¡é€šè¿‡â€ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n\n![](/assets/posts/use-karma-mocha-chai-to-test/karma-spec-reporter.png)\n\n> åˆ°æ­¤ä¸ºæ­¢ï¼Œè¯»è€…å¯ä»¥è®¿é—®[è¿™é‡Œ](https://github.com/liuyib/karma-mocha-demo/commit/5db1630e08f9bfb73b781ee410e5acedda2ac6e8)ï¼ŒæŸ¥çœ‹æ‰€åšçš„ä¿®æ”¹ã€‚\n\n## ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š\n\nè¿™é‡Œåˆ—ä¸¾ä¸¤ä¸ªå¸¸ç”¨çš„ç”Ÿæˆè¦†ç›–ç‡çš„æ’ä»¶ï¼š\n\n- [karma-coverage](https://github.com/karma-runner/karma-coverage)\n- [karma-coverage-istanbul-reporter](https://github.com/mattlewis92/karma-coverage-istanbul-reporter)\n\nå…¶ä¸­ `karma-coverage` æ˜¯å®˜æ–¹çš„æ’ä»¶ï¼Œè€Œ `karma-coverage-istanbul-reporter` åŸºäºå®ƒè¿›è¡Œäº†ä¸€äº›æ”¹è¿›ã€‚åœ¨æˆ‘ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä½“éªŒåˆ°å®ƒä¿©æœ€å¤§çš„ä¸åŒæ˜¯ï¼šç”Ÿæˆ `text` å’Œ `text-summary` ç±»å‹çš„æŠ¥å‘Šæ–¹å¼ä¸åŒã€‚å‰è€…ä¼šå°†è¿™ä¸¤ç§ç±»å‹çš„æŠ¥å‘Šç”Ÿæˆåˆ°æ–‡ä»¶ä¸­ï¼Œè€Œåè€…ä¼šå°†è¿™ä¸¤ç§ç±»å‹çš„æŠ¥å‘Šç”Ÿæˆåˆ°æ§åˆ¶å°ä¸­ã€‚æœ¬æ–‡ä»¥ `karma-coverage` ä½œä¸ºä¸¾ä¾‹ã€‚\n\né¦–å…ˆï¼Œå®‰è£… `karma-coverage` æ’ä»¶ï¼š\n\n```bash\n$ npm install --save-dev karma-coverage\n```\n\nç„¶åï¼Œå‚ç…§è¯¥æ’ä»¶çš„[æ–‡æ¡£](https://github.com/karma-runner/karma-coverage)è¿›è¡Œé…ç½®ï¼Œä¿®æ”¹ `karma.conf.js` æ–‡ä»¶ï¼š\n\n```js\n...\npreprocessors: {\n  'src/**/*.js': ['webpack', 'coverage'],\n  'test/**/*.js': ['webpack']\n},\n\nreporters: ['spec', 'coverage'],\n\ncoverageReporter: {\n  // ç”ŸæˆæŠ¥å‘Šçš„ç›®å½•\n  dir: 'coverage/',\n  // è¦ç”Ÿæˆçš„æŠ¥å‘Šç±»å‹\n  reporters: [\n    { type: 'lcov', subdir: '.' },\n    { type: 'text', subdir: '.', file: 'text.txt' },\n    { type: 'text-summary', subdir: '.', file: 'text-summary.txt' }\n  ]\n},\n...\n```\n\næ‰§è¡Œæµ‹è¯•æŒ‡ä»¤ `npm run test`ï¼Œä¼šç”Ÿæˆ `coverage` ç›®å½•ï¼Œå¹¶åœ¨è¯¥ç›®å½•ä¸‹ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šã€‚\n\n> è¿™é‡Œéœ€è¦ä»‹ç»ä¸€ä¸‹å‡ ç§å¸¸ç”¨çš„æŠ¥å‘Šç±»å‹ï¼š\n>\n> - `html` æŠ¥å‘Šç±»å‹\n>   è¿™æ˜¯ç»™äººçœ‹çš„è¦†ç›–ç‡æŠ¥å‘Šã€‚é»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ª `lcov-report` æ–‡ä»¶å¤¹ã€‚\n> - `lcovonly` æŠ¥å‘Šç±»å‹\n>   è¿™æ˜¯ç»™ CI ç”¨çš„ï¼Œé»˜è®¤ç”Ÿæˆçš„æ–‡ä»¶åä¸º `lcov.info`ã€‚\n> - `lcov` æŠ¥å‘Šç±»å‹\n>   è¯¥æŠ¥å‘Šç±»å‹ == `html` æŠ¥å‘Šç±»å‹ + `lcovonly` æŠ¥å‘Šç±»å‹\n> - `text-summary` æŠ¥å‘Šç±»å‹ï¼ˆæ•ˆæœå¦‚ä¸‹ï¼‰\n>   ```\n>   =============================== Coverage summary ===============================\n>   Statements   : 54.02% ( 47/87 )\n>   Branches     : 19.23% ( 10/52 )\n>   Functions    : 56.52% ( 13/23 )\n>   Lines        : 61.64% ( 45/73 )\n>   ================================================================================\n>   ```\n> - `text` æŠ¥å‘Šç±»å‹ï¼ˆæ•ˆæœå¦‚ä¸‹ï¼‰\n>   ```\n>   ----------|----------|----------|----------|----------|-------------------|\n>   File      |  % Stmts | % Branch |  % Funcs |  % Lines | Uncovered Line #s |\n>   ----------|----------|----------|----------|----------|-------------------|\n>   All files |    54.02 |    19.23 |    56.52 |    61.64 |                   |\n>    main.js  |    54.55 |    19.23 |    58.33 |    62.16 |... 69,70,71,72,73 |\n>    utils.js |    53.49 |    19.23 |    54.55 |    61.11 |... 69,70,71,72,73 |\n>   ----------|----------|----------|----------|----------|-------------------|\n>   ```\n>   ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¸¸ç”¨çš„æŠ¥å‘Šç±»å‹å°±æ˜¯ `lcov`, `text`, `text-summary` è¿™ä¸‰ç§ã€‚ä½ å¯ä»¥è®¿é—®[è¿™é‡Œ](https://istanbul.js.org/docs/advanced/alternative-reporters/)ï¼ŒæŸ¥çœ‹æ‰€æœ‰æŠ¥å‘Šç±»å‹çš„æ ¼å¼å’Œä½œç”¨ã€‚\n\næ‰¾åˆ° `coverage/lcov-report` ç›®å½•ä¸­çš„ `index.html` æ–‡ä»¶ï¼Œå°†å…¶åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œå¯ä»¥æŸ¥çœ‹åˆ°è¯¦ç»†çš„è¦†ç›–ç‡æŠ¥å‘Šä¿¡æ¯ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n\n![](/assets/posts/use-karma-mocha-chai-to-test/coverage-in-browser-1.png)\n\n> åˆ°æ­¤ä¸ºæ­¢ï¼Œè¯»è€…å¯ä»¥è®¿é—®[è¿™é‡Œ](https://github.com/liuyib/karma-mocha-demo/commit/0b70ec801aabdfd60ddd4e5c0b17e089c51872bd)ï¼ŒæŸ¥çœ‹æ‰€åšçš„ä¿®æ”¹ã€‚\n\næœ¬æ–‡çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œç†è®ºä¸Šæµ‹è¯•è¦†ç›–ç‡åº”è¯¥æ˜¯ 100%ï¼Œä½†æ˜¯å®é™…å¹¶æ²¡æœ‰è¿™ä¹ˆå¤šã€‚è€Œä¸”ï¼Œç»†å¿ƒçš„è¯å¯ä»¥å‘ç°ï¼Œä»£ç çš„æ€»è¡Œæ•°ä¹Ÿå˜å¤šäº†ï¼Œè¿™æ˜¯å› ä¸º webpack ä¼šåœ¨ç¼–è¯‘ä¹‹ååŠ å…¥ä¸€äº›ä»£ç ï¼Œå½±å“äº†è¦†ç›–ç‡ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ä¸ªæ’ä»¶å¯ä¾›é€‰æ‹©ï¼š\n\n- [babel-plugin-istanbul](https://github.com/istanbuljs/babel-plugin-istanbul)\n- [istanbul-instrumenter-loader](https://github.com/webpack-contrib/istanbul-instrumenter-loader)\n\nå¦‚æœä½ çš„é¡¹ç›®åªä½¿ç”¨äº† Babelï¼Œæ²¡æœ‰ä½¿ç”¨ webpackï¼Œé‚£ä¹ˆä½ åªèƒ½ä½¿ç”¨ `babel-plugin-istanbul` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä½ çš„é¡¹ç›®ä½¿ç”¨äº† webpackï¼Œé‚£ä¹ˆä¸¤ä¸ªæ’ä»¶å¯ä»¥ä»»é€‰å…¶ä¸€æ¥ä½¿ç”¨ã€‚\n\nç”±äºæœ¬æ–‡ç¤ºä¾‹ä¸­ç”¨åˆ°äº† webpackï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæ’ä»¶å¯ä»¥ä»»é€‰å…¶ä¸€ï¼Œæˆ‘ä»¬ä»¥ `babel-plugin-istanbul` ä¸ºä¾‹ï¼š\n\né¦–å…ˆï¼Œå®‰è£…è¯¥æ’ä»¶ï¼š\n\n```bash\n$ npm install --save-dev babel-plugin-istanbul\n```\n\nç„¶åï¼Œå‚ç…§å…¶æ–‡æ¡£è¿›è¡Œé…ç½®ï¼Œä¿®æ”¹ `karma.conf.js` æ–‡ä»¶ï¼š\n\n```diff\n...\nwebpack: {\n  mode: 'development',\n  module: {\n    rules: [\n      {\n        test: /\\.js$/,\n        exclude: /(node_modules|bower_components)/,\n        use: {\n          loader: 'babel-loader',\n          options: {\n            presets: ['@babel/preset-env'],\n+           plugins: ['istanbul']\n          }\n        }\n      }\n    ]\n  }\n},\n...\n```\n\nå¦‚æœå°†è¯¥é…ç½®æ”¾å…¥ `.babelrc` æ–‡ä»¶ï¼Œåˆ™å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n```diff\n// .babelrc\n{\n  \"presets\": [\"@babel/preset-env\"],\n+ \"plugins\": [\"istanbul\"]\n}\n```\n\nå†æ¬¡æ‰§è¡Œæµ‹è¯•æŒ‡ä»¤ `npm run test`ï¼Œå³å¯å¾—åˆ° 100% çš„è¦†ç›–ç‡ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š\n\n![](/assets/posts/use-karma-mocha-chai-to-test/coverage-in-browser-2.png)\n\n> å¦‚æœä½ ä½¿ç”¨ `karma-coverage-istanbul-reporter` æ’ä»¶æ¥ç”Ÿæˆè¦†ç›–ç‡ï¼Œå¯èƒ½ä¼šé‡åˆ°è¦†ç›–ç‡ä¿¡æ¯å…¨ä¸º `0` æˆ– `Unknown` çš„æƒ…å†µã€‚è¿™ä¸ªé—®é¢˜å’Œä¸Šè¿°è¦†ç›–ç‡ç»Ÿè®¡ä¸æ­£ç¡®ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”±äºæ’ä»¶é»˜è®¤æ— æ³•ç»Ÿè®¡ ES6+ ä»£ç å¼•èµ·çš„ã€‚ä½ åªéœ€è¦æŒ‰ç…§ä¸Šæ–‡ä¸­çš„è¯´æ˜ï¼Œä½¿ç”¨ `babel-plugin-istanbul` æˆ– `istanbul-instrumenter-loader` æ’ä»¶å³å¯è§£å†³æ­¤ç±»é—®é¢˜ã€‚\n\n> åˆ°æ­¤ä¸ºæ­¢ï¼Œè¯»è€…å¯ä»¥è®¿é—®[è¿™é‡Œ](https://github.com/liuyib/karma-mocha-demo/commit/8ec8303fd703a9681ca6b3f96ff1bab5a3ba8495)ï¼ŒæŸ¥çœ‹æ‰€åšçš„ä¿®æ”¹ã€‚\n\n## æŒç»­é›†æˆ\n\nå¸¸ç”¨çš„æŒç»­é›†æˆå·¥å…·æœ‰ [Travis CI](https://travis-ci.com/) å’Œ [CircleCI](https://circleci.com/)ã€‚æœ¬æ–‡ä»¥ Travis CI ä½œä¸ºä¸¾ä¾‹ã€‚\n\n### é…ç½® Travis CI\n\nç”±äº Travis CI æ˜¯åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œï¼Œå› æ­¤è·‘ä¸äº† GUI ç¨‹åºã€‚å¦‚æœè¦åœ¨ Travis CI ä¸­è¿è¡Œéœ€è¦ GUI çš„æµ‹è¯•ï¼Œåˆ™è¦ç”¨åˆ° `xvfb`ï¼ˆX Virtual Framebufferï¼‰æ¥æ¨¡æ‹Ÿæ˜¾ç¤ºã€‚è¯¦è§ï¼š[Using xvfb to Run Tests That Require a GUI](https://docs.travis-ci.com/user/gui-and-headless-browsers/#using-xvfb-to-run-tests-that-require-a-gui)ã€‚\n\næ–°å»º Travis CI çš„é…ç½®æ–‡ä»¶ `.travis.yml`ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼š\n\n```yaml\nlanguage: node_js\n\nnode_js:\n  - 10\n\n# ä½¿ç”¨ xvfb æ¥æ¨¡æ‹Ÿæ˜¾ç¤º GUI\nservices:\n  - xvfb\n\n# æŒ‡å®šè¦ä½¿ç”¨çš„æµè§ˆå™¨ä»¥åŠç‰ˆæœ¬\naddons:\n  chrome: stable\n\nscript:\n  - npm run test\n\nafter_script:\n  - npm run codecov\n```\n\né™¤äº†é…ç½® Travis CI å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é…ç½® Kramaï¼Œä¿®æ”¹ `karma.conf.js` æ–‡ä»¶ï¼š\n\n> å¦‚æœä½ ä¸å‡†å¤‡ä½¿ç”¨ CIï¼Œè¯·å¿½ç•¥è¯¥é…ç½®ï¼Œé»˜è®¤å³å¯ã€‚\n\n```js\n...\n// å¦‚æœè®¾ä¸º true çš„è¯ï¼ŒKarma å°†æ•è·æµè§ˆå™¨ï¼Œè¿è¡Œæµ‹è¯•ï¼Œå¹¶è‡ªåŠ¨é€€å‡º\n// process.env.CI æ˜¯ç¯å¢ƒå˜é‡ï¼Œåœ¨ CI ä¸­å€¼ä¸º trueï¼Œå¦åˆ™å€¼ä¸º false\nsingleRun: !!process.env.CI,\n...\n```\n\nè¯¥é…ç½®é¡¹é»˜è®¤ä¸º `false`ï¼Œä¼šä½¿å¾— Karma åœ¨æµ‹è¯•ç»“æŸåä»ç„¶ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œä¸ä¼šé€€å‡ºæµ‹è¯•ï¼Œä½†æ˜¯åœ¨ CI ä¸­å¿…é¡»åœ¨æµ‹è¯•ç»“æŸåé€€å‡ºæµ‹è¯•ï¼Œå¦åˆ™ CI å°†ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°è¶…æ—¶ã€‚\n\n### ä¸Šä¼ è¦†ç›–ç‡\n\nç”Ÿæˆäº†è¦†ç›–ç‡ï¼Œé…ç½®äº† CIï¼Œæœ€åè¿˜éœ€è¦åšçš„æ˜¯ï¼Œå°†è¦†ç›–ç‡ä¸Šä¼ åˆ° [Coveralls](https://coveralls.io/) æˆ– [Codecov](https://codecov.io/) ä¸­è¿›è¡Œåˆ†æã€‚æœ¬æ–‡ä»¥ Codecov ä¸ºä¾‹ã€‚\n\né¦–å…ˆï¼Œå®‰è£… `codecov` æ’ä»¶ï¼š\n\n```bash\n$ npm install --save-dev codecov\n```\n\nç„¶åï¼Œå‚ç…§è¯¥æ’ä»¶çš„[æ–‡æ¡£](https://github.com/codecov/codecov-node)è¿›è¡Œé…ç½®ï¼Œæ·»åŠ ä¸€ä¸ª NPM æŒ‡ä»¤ï¼Œä¿®æ”¹ `package.json` æ–‡ä»¶ï¼š\n\n```diff\n...\n\"script\": {\n  \"test\": \"karma start ./karma.conf.js\",\n+ \"codecov\": \"./node_modules/.bin/codecov\"\n},\n...\n```\n\nè¯¥æŒ‡ä»¤çš„ä½œç”¨æ˜¯ï¼šè¯»å– `coverage` ç›®å½•ä¸­çš„ `lcov.info` æ–‡ä»¶ï¼Œç„¶åä¸Šä¼ åˆ° Codecov ç½‘ç«™ã€‚\n\n> åœ¨ä¸Šä¼ è¦†ç›–ç‡ä¹‹å‰ï¼Œä½ æœ€å¥½ç¡®è®¤ä¸€ä¸‹å½“ä½ æ‰§è¡Œ `npm run test` æŒ‡ä»¤åï¼Œå¯ä»¥åœ¨ `coverage` ç›®å½•ä¸­ç”Ÿæˆ `lcov.info` æ–‡ä»¶ã€‚\n\n> åˆ°æ­¤ä¸ºæ­¢ï¼Œè¯»è€…å¯ä»¥è®¿é—®[è¿™é‡Œ](https://github.com/liuyib/karma-mocha-demo/commit/cef265c71b6d0c002cd83863d53a434d8a0e01fe)ï¼ŒæŸ¥çœ‹æ‰€åšçš„ä¿®æ”¹ã€‚\n\n### å±•ç¤ºå¾½ç« \n\næœ€åï¼Œæˆ‘ä»¬æŠŠæµ‹è¯•çš„ç»“æœï¼Œä»¥ Travis CI å’Œ Codecov å¾½ç« çš„å½¢å¼æ”¾å…¥ READMEã€‚ä¾‹å¦‚ï¼Œæœ¬æ–‡é…å¥—çš„ Github ä»“åº“ [karma-mocha-demo](https://github.com/liuyib/karma-mocha-demo) çš„æµ‹è¯•ç»“æœï¼š\n\n[![Travis CI](https://img.shields.io/travis/liuyib/karma-mocha-demo.svg)](https://travis-ci.com/github/liuyib/karma-mocha-demo)\n[![Codecov](https://img.shields.io/codecov/c/github/liuyib/karma-mocha-demo.svg)](https://codecov.io/gh/liuyib/karma-mocha-demo)\n\nå¯¹åº”ä»£ç å¦‚ä¸‹ï¼š\n\n```md\n[![Travis CI](https://img.shields.io/travis/liuyib/karma-mocha-demo.svg)](https://travis-ci.com/github/liuyib/karma-mocha-demo)\n[![Codecov](https://img.shields.io/codecov/c/github/liuyib/karma-mocha-demo.svg)](https://codecov.io/gh/liuyib/karma-mocha-demo)\n```\n\nå°†å…¶ä¸­çš„ç”¨æˆ·åï¼ˆ`liuyib`ï¼‰å’Œä»“åº“åï¼ˆ`karma-mocha-demo`ï¼‰æ¢æˆä½ çš„å³å¯ã€‚\n\n---\n\nå‚è€ƒèµ„æ–™ï¼š\n\n- [æ­å»º Karma+Mocha+Chai æµ‹è¯• TypeScript é¡¹ç›®](https://blog.crimx.com/2019/06/19/%E6%90%AD%E5%BB%BA-karma-mocha-chai-%E6%B5%8B%E8%AF%95-typescript-%E9%A1%B9%E7%9B%AE/)\n- [æµ‹è¯•æ¡†æ¶ Mocha å®ä¾‹æ•™ç¨‹](http://www.ruanyifeng.com/blog/2015/12/a-mocha-tutorial-of-examples.html)\n- [å­¦ä¹  Karma+Jasmine+istanbul+webpack è‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•](https://www.cnblogs.com/tugenhua0707/p/8433847.html)\n- [ä½¿ç”¨ Karma + Jasmine æ„å»º Web æµ‹è¯•ç¯å¢ƒ](https://www.ibm.com/developerworks/cn/web/wa-lo-use-karma-jasmine-build-test-environment/index.html)\n- [Travis CI XVFB Breaking Change](https://benlimmer.com/2019/01/14/travis-ci-xvfb/)\n","tags":["å•å…ƒæµ‹è¯•","Karma","Mocha","Chai"],"categories":["é¡¹ç›®æ­å»º"]},{"title":"é›†æˆ Pjax å®ç°ç½‘ç«™æ— åˆ·æ–°åŠ è½½","url":"/2019/09/24/use-pjax-to-your-site/","content":"\nä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»ä¸€ä¸ªç½‘é¡µé“¾æ¥åï¼Œæµè§ˆå™¨å°±ä¼šåŠªåŠ›å‘é€ç½‘ç»œè¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚åˆ°çš„ç½‘é¡µæ¸²æŸ“å‡ºæ¥ã€‚æœ‰æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šåœ¨ä¸€ä¸ªç½‘ç«™ä¸­ä¸åœåœ°ç‚¹å‡»é“¾æ¥ï¼Œç„¶åç½‘é¡µä¸åœåœ°è·³è½¬ã€‚é€šå¸¸ï¼Œæµè§ˆå™¨ä¼šå¯¹æ–‡ä»¶èµ„æºè¿›è¡Œä¸€å®šçš„ç¼“å­˜ï¼Œè¿™æ ·ä½¿å¾—åŒä¸€ä¸ªç½‘ç«™ä¹‹é—´çš„é¡µé¢è·³è½¬æ—¶ï¼Œèƒ½å¤Ÿæ›´å¿«çš„åŠ è½½ã€‚\n\n<!-- more -->\n\nè™½ç„¶æµè§ˆå™¨å¯¹èµ„æºçš„ç¼“å­˜åŠ å¿«äº†é¡µé¢çš„åŠ è½½é€Ÿåº¦ï¼Œä½†æ˜¯é¡µé¢æ¯ä¸€æ¬¡è·³è½¬æ—¶ï¼Œéƒ½ä¼šæ•´ä½“åˆ·æ–°ä¸€æ¬¡ï¼Œè¿™ä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ç”¨æˆ·ä½“éªŒã€‚ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Pjax å®ç°ç½‘ç«™æ— åˆ·æ–°åŠ è½½ã€‚\n\n## Pjax åŸç†\n\né¦–å…ˆè¦çŸ¥é“ `Pjax = Ajax + pushState`ã€‚å½“ç”¨æˆ·è¿›è¡Œè¶…é“¾è¯·æ±‚æ—¶ï¼ŒPjax ä¼šæ‹¦æˆªè¯·æ±‚ï¼Œç„¶åè§¦å‘ Ajax è¯·æ±‚å’Œ `pushState`ã€‚å…¶ä¸­ï¼ŒAjax ä½¿ä½ çš„é¡µé¢å±€éƒ¨åˆ·æ–°ï¼Œ`pushState` ç”¨äºä¿®æ”¹ URL è€Œä¸è·³è½¬é¡µé¢ï¼Œä»è€Œå®ç°ä¸è·³è½¬é¡µé¢å±€éƒ¨åˆ·æ–°çš„åŠŸèƒ½ã€‚\n\n## å¼€å§‹ä½¿ç”¨\n\nPjax æœ‰ä¾èµ–å’Œä¸ä¾èµ– jQuery çš„ä¸¤ç§ç‰ˆæœ¬ï¼š\n\n- [defunkt/jquery-pjax](https://github.com/defunkt/jquery-pjax)ã€ä¾èµ–äº jQueryã€‘\n- [MoOx/pjax](https://github.com/MoOx/pjax)ã€æ¨èã€‘\n\nè¿™é‡Œä»¥ä¸ä¾èµ– jQuery çš„ [MoOx/pjax](https://github.com/MoOx/pjax) ä½œä¸ºæ•™ç¨‹ã€‚\n\n### å¼•ç”¨æ–‡ä»¶\n\nä¸ºäº†æ–¹ä¾¿ï¼Œè¿™é‡Œç›´æ¥ä½¿ç”¨ JSDelivr å…¬å…±çš„ CDN åœ°å€ï¼š\n\n```html\n<script src=\"https://cdn.jsdelivr.net/npm/pjax/pjax.js\"></script>\n```\n\n### åˆ†æé¡µé¢\n\nåœ¨ç½‘ç«™é¡µé¢åˆ‡æ¢æ—¶ï¼Œæœ‰äº›éƒ¨åˆ†æ˜¯ä¸å˜çš„ï¼Œæœ‰äº›æ˜¯æ”¹å˜çš„ã€‚æˆ‘ä»¬éœ€è¦æ ¹æ®ç½‘ç«™çš„ DOM ç»“æ„è‡ªè¡Œåˆ†æã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾é¡µé¢çš„ç»“æ„å¦‚ä¸‹ï¼š\n\n```html\n<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"UTF-8\" />\n    <title>Liuyib's Blog</title>\n    <meta name=\"description\" content=\"Liuyib's Blog\" />\n  </head>\n  <body>\n    <header id=\"header\" class=\"header\">\n      é¡¶éƒ¨æ ...\n    </header>\n    <main id=\"main\" class=\"main\">\n      ä¸»ä½“éƒ¨åˆ†...\n    </main>\n    <footer id=\"footer\" class=\"footer\">\n      åº•éƒ¨æ ...\n    </footer>\n  </body>\n</html>\n```\n\næ¯æ¬¡åˆ‡æ¢é¡µé¢æ—¶ï¼Œ`title` ä¼šéšä¹‹æ”¹å˜ï¼Œ`header` å’Œ `footer` ä¸€èˆ¬ä¸å˜ï¼Œè€Œ `main` æ˜¯ç½‘ç«™çš„ä¸»ä½“éƒ¨åˆ†ï¼Œä¹Ÿä¼šæ”¹å˜ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ä½¿ç”¨ Pjaxï¼š\n\n```js\nvar pjax = new Pjax({\n  // è¿™é‡Œå¡«å†™é¡µé¢ä¸­æ”¹å˜çš„éƒ¨åˆ†ï¼ˆå’Œ CSS é€‰æ‹©å™¨ç”¨æ³•ä¸€æ ·ï¼‰\n  selectors: [\"head title\", \"#main\"],\n});\n```\n\nè¿™æ ·ï¼Œå°±å®ç°äº†ä¸€ä¸ªæœ€ç®€å•çš„ Pjax ç½‘ç«™ï¼Œä¸è¿‡è¿™æ‰åˆšå¼€å§‹ã€‚ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å‚æ•°ï¼š\n\n- `elements`ï¼šé»˜è®¤å€¼ `a[href], form[action]`\n\n  æŒ‡å®šåº”ç”¨ Pjax çš„é“¾æ¥ã€‚\n\n- `switches`ï¼šé»˜è®¤å€¼ `{}`\n\n  ä½¿ç”¨æ—§å…ƒç´ æ›¿æ¢æ–°å…ƒç´ ã€‚\n\n- `history`ï¼šé»˜è®¤å€¼ `true`\n\n  æ˜¯å¦å¯ç”¨ `pushState`ã€‚ç¦ç”¨å Pjax å°±å˜æˆäº† Ajaxã€‚\n\n- `scrollTo`ï¼šé»˜è®¤å€¼ `0`\n\n  é¡µé¢åˆ‡æ¢ååˆ°é¡¶éƒ¨çš„è·ç¦»ã€‚è®¾ä¸º `false` è¡¨ç¤ºé¡µé¢ä¿æŒåœ¨åˆ‡æ¢å‰çš„ä½ç½®ã€‚\n\n- `scrollRestoration`ï¼šé»˜è®¤å€¼ `true`\n\n  åˆ‡æ¢é¡µé¢åï¼ŒPjax å°†å°è¯•æ¢å¤æ»šåŠ¨ä½ç½®ã€‚\n\n- `cacheBust`ï¼šé»˜è®¤å€¼ `true`\n\n  æ˜¯å¦åœ¨ URL ä¸Šæ·»åŠ æ—¶é—´æˆ³ï¼Œé˜²æ­¢æµè§ˆå™¨ç¼“å­˜ã€‚\n\nå…³äºè¿™äº›å‚æ•°çš„ä½œç”¨å’Œè®¾ç½®ï¼Œæ ¹æ®éœ€è¦è‡ªè¡Œé€‰æ‹©ã€‚æ›´å¤šå‚æ•°ï¼Œè¯·æŸ¥çœ‹ MoOx/pjax é¡¹ç›®çš„ [READMD](https://github.com/MoOx/pjax)ã€‚\n\n### æ·»åŠ è¿›åº¦æ¡\n\nä½¿ç”¨äº† Pjax åï¼Œåœ¨è¿›è¡Œé¡µé¢è·³è½¬æ—¶ï¼Œæµè§ˆå™¨æ²¡æœ‰ä»»ä½•åŠ è½½æç¤ºï¼Œå¹¶ä¸”åœ¨è·³è½¬å®Œæˆä¹‹å‰ï¼Œé¡µé¢ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ï¼Œå› æ­¤åœ¨ç½‘é€Ÿæ¯”è¾ƒæ…¢çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä»¥ä¸ºé¡µé¢å¹¶æ²¡æœ‰è¿›è¡Œè·³è½¬ã€‚ä¸ºäº†æ”¹å–„ä½“éªŒï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªè¿›åº¦æ¡ï¼Œä»¥æ­¤æ¥å‘Šè¯‰ç”¨æˆ·â€œé¡µé¢æ­£åœ¨åŠ è½½â€ã€‚\n\nè¯´åˆ°è¿™é‡Œï¼Œå°±ä¸å¾—ä¸æåˆ° Github çš„åŠ è½½è¿›åº¦æ¡ã€‚å¦‚æœå¿ƒç»†çš„åŒå­¦å¯èƒ½ä¼šå‘ç°ï¼ŒGithub ä¹Ÿä½¿ç”¨äº† Pjaxã€‚é‚£ä¹ˆä¸‹é¢æˆ‘ä»¬ä»¿ç…§ Github æ¥å®ç°ä¸€ä¸ª Pjax åŠ è½½è¿›åº¦æ¡å§ã€‚\n\né¦–å…ˆè¦æ¸…æ¥šä¸€ç‚¹ï¼Œè¿™é‡Œè¦å®ç°çš„åŠ è½½è¿›åº¦æ¡å®é™…ä¸Šæ˜¯**å‡çš„**ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé¡µé¢å®é™…åŠ è½½äº†å¤šå°‘æˆ‘ä»¬å¹¶æ²¡æœ‰åŠæ³•çŸ¥é“ï¼Œè¿›åº¦æ¡ä¹Ÿåªæ˜¯æŒ‰ç…§ä¸€å®šçš„é€Ÿåº¦å¢åŠ çš„ã€‚\n\n> å¦‚æœå¯ä»¥æ§åˆ¶æœåŠ¡ç«¯çš„è¯ï¼Œå¯ä»¥åšå‡º**çœŸçš„**åŠ è½½è¿›åº¦æ¡ï¼Œè‡³å°‘åœ¨ Github Pages ä¸Šè¿˜æš‚æ—¶åšä¸åˆ°ã€‚\n\nHTML (Pug):\n\n```pug\ndiv.loading-bar\n  div.progress\n```\n\nCSS (Stylus):\n\n```stylus\n.loading-bar {\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 99999;\n  opacity: 0;\n  transition: opacity .4s linear;\n\n  .progress {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 2px;\n    background-color: #77b6ff;\n    box-shadow: 0 0 10px rgba(119, 182, 255, .7);\n  }\n\n  &.loading {\n    opacity: 1;\n    transition: none;\n\n    .progress {\n      transition: width .4s ease;\n    }\n  }\n}\n```\n\nJavaScript:\n\n```js\nvar loadingBar = document.querySelector(\".loading-bar\");\nvar progress = document.querySelector(\".loading-bar .progress\");\nvar timer = null;\n\n// Pjax å¼€å§‹æ—¶æ‰§è¡Œçš„å‡½æ•°\ndocument.addEventListener(\"pjax:send\", function () {\n  // è¿›åº¦æ¡é»˜è®¤å·²ç»åŠ è½½ 20%\n  var loadingBarWidth = 20;\n  // è¿›åº¦æ¡çš„æœ€å¤§å¢åŠ å®½åº¦\n  var MAX_LOADING_WIDTH = 95;\n\n  // æ˜¾ç¤ºè¿›åº¦æ¡\n  loadingBar.classList.add(\"loading\");\n  // åˆå§‹åŒ–è¿›åº¦æ¡çš„å®½åº¦\n  progress.style.width = loadingBarWidth + \"%\";\n\n  clearInterval(timer);\n  timer = setInterval(function () {\n    // è¿›åº¦æ¡çš„å¢åŠ é€Ÿåº¦ï¼ˆå¯ä»¥æ”¹ä¸ºä¸€ä¸ªéšæœºå€¼ï¼Œæ˜¾å¾—æ›´åŠ çœŸå®ï¼‰\n    loadingBarWidth += 3;\n\n    // å½“è¿›åº¦æ¡åˆ°è¾¾ 95% ååœæ­¢å¢åŠ \n    if (loadingBarWidth > MAX_LOADING_WIDTH) {\n      loadingBarWidth = MAX_LOADING_WIDTH;\n    }\n\n    progress.style.width = loadingBarWidth + \"%\";\n  }, 500);\n});\n\n// Pjax å®Œæˆä¹‹åæ‰§è¡Œçš„å‡½æ•°\ndocument.addEventListener(\"pjax:complete\", function () {\n  clearInterval(timer);\n  progress.style.width = \"100%\";\n  loadingBar.classList.remove(\"loading\");\n\n  setTimeout(function () {\n    progress.style.width = 0;\n  }, 400);\n});\n```\n\nä¸Šé¢çš„ä»£ç åŸºæœ¬ä¸Šå®ç°äº† Github ä¸­ Pjax åŠ è½½è¿›åº¦æ¡çš„æ•ˆæœï¼Œä»…ä¾›å‚è€ƒã€‚å…·ä½“æ•ˆæœå¯ä»¥åœ¨æˆ‘çš„[ä¸ªäººåšå®¢](https://liuyib.github.io/)ä¸Šä½“éªŒä¸€ä¸‹ã€‚\n\n### é‡è½½ JS è„šæœ¬\n\n**è¿™é‡Œçš„é‡è½½æŒ‡çš„æ˜¯é‡æ–°åŠ è½½**ã€‚ç”±äºé€šè¿‡ Pjax åˆ‡æ¢çš„é¡µé¢å¹¶æ²¡æœ‰å®Œå…¨åˆ·æ–°ï¼Œæµè§ˆå™¨ä¸ä¼šå°†ç½‘é¡µä»å¤´æ‰§è¡Œä¸€éï¼Œå› æ­¤æœ‰äº› JS å°†ä¸ä¼šç”Ÿæ•ˆã€‚é‡è½½ JS è„šæœ¬å¤§è‡´åˆ†ä¸ºä¸‰ç§ï¼šä¸€ç§æ˜¯é‡è½½ JS å‡½æ•°ï¼Œä¸€ç§æ˜¯é‡è½½æ•´ä¸ª JS æ–‡ä»¶ï¼Œå¦ä¸€ç§æ˜¯é‡è½½å†…è”çš„ `script` æ ‡ç­¾ã€‚\n\n1ï¼‰é‡è½½ JS å‡½æ•°\n\nè¿™ç§é‡è½½ä¸€èˆ¬é€‚ç”¨äºç”¨æˆ·è‡ªå·±ç¼–å†™çš„ä¸€äº› JS å‡½æ•°ã€‚ä½†æ˜¯å…·ä½“æƒ…å†µæ¯”è¾ƒå¤æ‚ï¼Œå‡½æ•°è¦ä¸è¦é‡è½½è¿˜å¾—å…·ä½“åˆ†æã€‚ä¸‹é¢ä¸¾ä¸€äº›ä¾‹å­ï¼š\n\n- é¡µé¢ä¸å˜éƒ¨åˆ†å¯¹åº”çš„äº‹ä»¶\n\n  æ¯”å¦‚ï¼Œé¡µé¢é¡¶éƒ¨æ æœ‰ä¸€ä¸ªæœç´¢æŒ‰é’®ï¼Œç‚¹å‡»ä¹‹åä¼šå¼¹å‡ºæœç´¢æ¡†ï¼š\n\n  ```js\n  document.querySelector(\".search-button\").onclick = function () {\n    // ...\n  };\n  ```\n\n  ç”±äºé¡µé¢é¡¶éƒ¨æ ä¸å˜ï¼Œæ‰€ä»¥å…¶ä¸­çš„å…ƒç´ ä¸Šç»‘å®šçš„äº‹ä»¶ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œè¿™éƒ¨åˆ†å…ƒç´ å¯¹åº”çš„ JS äº‹ä»¶ä¸éœ€è¦é‡è½½ã€‚\n\n- é¡µé¢å¯å˜éƒ¨åˆ†å¯¹åº”çš„äº‹ä»¶\n\n  æ¯”å¦‚ï¼Œé¡µé¢ä¸»ä½“éƒ¨åˆ†æ˜¯å˜åŒ–çš„ï¼Œæ‡’åŠ è½½å…¶ä¸­çš„å›¾ç‰‡ï¼š\n\n  ```js\n  var imgs = document.querySelectorAll(\"#main img.lazyload\");\n\n  lazyload(imgs);\n  ```\n\n  å½“é€šè¿‡ Pjax åˆ‡æ¢é¡µé¢åï¼Œç”±äºä¸»ä½“éƒ¨åˆ†æ”¹å˜ï¼Œä¸Šè¿°ä»£ç å·²ç»å¤±æ•ˆï¼Œå› æ­¤éœ€è¦è¿›è¡Œé‡è½½ã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘ä»¬ä½¿ç”¨å‡½æ•°å°è£…ä¸€ä¸‹ï¼š\n\n  ```js\n  function pjax_reload() {\n    var imgs = document.querySelectorAll(\"#main img.lazyload\");\n\n    lazyload(imgs);\n  }\n\n  // Pjax å®Œæˆåï¼Œé‡æ–°åŠ è½½ä¸Šé¢çš„å‡½æ•°\n  document.addEventListener(\"pjax:complete\", function () {\n    pjax_reload();\n  });\n  ```\n\n2ï¼‰é‡è½½æ•´ä¸ª JS æ–‡ä»¶\n\nè¿™ç§æƒ…å†µå¤šæ•°ç”¨äºç¬¬ä¸‰æ–¹æ–‡ä»¶ï¼Œæ¯”å¦‚ï¼Œåœç®—å­ç»Ÿè®¡çš„è„šæœ¬ã€è°·æ­Œ/ç™¾åº¦/è…¾è®¯åˆ†æçš„è„šæœ¬ç­‰ï¼Œè¿™äº›è„šæœ¬åœ¨æ¯ä¸€æ¬¡é¡µé¢åŠ è½½åéƒ½éœ€è¦æ‰§è¡Œã€‚\n\næˆ‘çš„åšæ³•æ˜¯ï¼Œåœ¨å¼•å…¥è¿™äº›æ–‡ä»¶çš„æ ‡ç­¾ä¸Šæ·»åŠ  `data-pjax` å±æ€§ï¼Œç„¶åå°†å…·æœ‰è¿™ä¸ªå±æ€§çš„æ ‡ç­¾é‡æ–°æ·»åŠ åœ¨é¡µé¢ä¸­ã€‚æœ‰æ—¶å€™ä¸æ–¹ä¾¿åœ¨è¿™äº›æ ‡ç­¾ä¸Šæ·»åŠ é¢å¤–çš„å±æ€§ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨è¿™äº›æ ‡ç­¾å¤–å¥—ä¸€å±‚æ ‡ç­¾ï¼Œå¦‚ `<div class=\".pjax-reload\"></div>`ï¼Œç„¶åå°† `.pjax-reload` é‡Œçš„å…ƒç´ å…¨éƒ¨é‡æ–°æ·»åŠ åˆ°é¡µé¢ä¸­å³å¯ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```html\n<script\n  data-pjax\n  src=\"https://cdn.jsdelivr.net/gh/sukkaw/busuanzi/bsz.pure.mini.js\"\n></script>\n\n<div class=\".pjax-reload\">\n  <script src=\"https://www.google-analytics.com/analytics.js\"></script>\n</div>\n```\n\n```js\n// jQuery å†™æ³•\n$(\"script[data-pjax], .pjax-reload script\").each(function () {\n  $(this).parent().append($(this).remove());\n});\n\n// JS å†™æ³•\ndocument\n  .querySelector(\"script[data-pjax], .pjax-reload script\")\n  .forEach(function (elem) {\n    var id = element.id || \"\";\n    var src = element.src || \"\";\n    var code = element.text || element.textContent || element.innerHTML || \"\";\n    var parent = element.parentNode;\n    var script = document.createElement(\"script\");\n\n    parent.removeChild(element);\n\n    if (id !== \"\") {\n      script.id = element.id;\n    }\n\n    if (src !== \"\") {\n      script.src = src;\n      script.async = false;\n    }\n\n    if (code !== \"\") {\n      script.appendChild(document.createTextNode(code));\n    }\n\n    parent.appendChild(script);\n  });\n```\n\nçœ‹åˆ°ä¸¤ç§å†™æ³•çš„å·®è·ï¼Œæ„Ÿè§‰æ•´ä¸ªäººéƒ½ä¸å¥½äº†ã€‚\n\n3ï¼‰é‡è½½æ•´ä¸ª `script` æ ‡ç­¾\n\nè¿™ç§æƒ…å†µå’Œå‰é¢ç±»ä¼¼ï¼Œå¦‚æœä¸€äº› JS è„šæœ¬å†™åœ¨ `script` æ ‡ç­¾ä¸­ï¼Œå¹¶ä¸”éœ€è¦é‡è½½ï¼Œå¯ä»¥é€‰æ‹©ç›´æ¥é‡è½½æ•´ä¸ª `script` æ ‡ç­¾ã€‚å…·ä½“åšæ³•å’Œä¸Šä¸€æ­¥ç›¸åŒï¼Œåœ¨æ ‡ç­¾ä¸Šæ·»åŠ  `data-pjax` å±æ€§ï¼Œç„¶åå°†å…·æœ‰è¿™ä¸ªå±æ€§çš„æ ‡ç­¾é‡æ–°æ·»åŠ åˆ°é¡µé¢ä¸­ã€‚\n\n## æ€»ç»“\n\næœ¬æ–‡ä¸»è¦ä»‹ç»äº† Pjax çš„åŸºæœ¬ç”¨æ³•ï¼Œå’Œä¸€äº›å¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ³•ã€‚ä¸‹é¢ï¼Œèµ¶å¿«åŠ¨èµ·æ‰‹æ¥ï¼Œè®©ä½ çš„ç½‘ç«™ä½¿ç”¨ Pjax å§ã€‚\n\n---\n\nå‚è€ƒèµ„æ–™ï¼š\n\n- [pjax æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ](https://www.zhihu.com/question/20289254)\n- [è®©ä½ çš„ç½‘ç«™å®ç° PJAX æ— åˆ·æ–°](https://paugram.com/coding/add-pjax-to-your-website.html)\n","tags":["Pjax","ç¬¬ä¸‰æ–¹åº“","å±€éƒ¨åˆ·æ–°"],"categories":["ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ"]},{"title":"ä» 0 åˆ° 1 å¼€å‘ Hexo ä¸»é¢˜æ‚è°ˆ","url":"/2019/08/20/develop-hexo-theme-from-0-to-1/","content":"\nåœ¨æ²¡æœ‰å¼€å‘è‡ªå·±çš„ Hexo ä¸»é¢˜ä¹‹å‰ï¼Œæˆ‘éƒ½æ˜¯åœ¨ Github issues é‡Œå†™[åšå®¢](https://github.com/liuyib/blog/issues)ï¼Œä½†è¿™æ ·çš„åšæ³•æ€»è¢«å°ä¼™ä¼´å„ç§åæ§½ (ï¿£_ï¿£ )ã€‚æƒ³åˆ°å¦‚æœæ–‡ç« å¤šçš„æ—¶å€™ï¼Œä½¿ç”¨ Github issues æµè§ˆèµ·æ¥ä¸å¤Ÿæ–¹ä¾¿ï¼Œæ‰€ä»¥è¿˜æ˜¯æ¢å›äº† Hexoã€‚\n\n<!-- more -->\n\nä½¿ç”¨ Hexo é¦–å…ˆæ˜¯è¦æŒ‘é€‰å–œæ¬¢çš„ä¸»é¢˜ï¼Œä»¥æˆ‘ä¸ªäººçš„æ„Ÿå—æ¥è®²ï¼ŒHexo çš„ä¸»é¢˜è™½ç„¶æœ‰ä¸¤ç™¾å¤šä¸ªï¼Œä½†æ˜¯èƒ½æ‹¿å‡ºæ‰‹çš„ä¹Ÿå°±ä¸åˆ°äºŒåä¸ªã€‚å…¶ä¸­æˆ‘æœ€ä½©æœçš„ä¸»é¢˜ Next å·²ç»è¶³å¤Ÿä¼˜ç§€ï¼Œä½†æ˜¯é£æ ¼æˆ‘å¹¶ä¸å–œæ¬¢ï¼Œæœ€åå†³å®šè‡ªå·±å¼€å‘ã€‚\n\næœ¬æ–‡ä¸»è¦è®°å½•äº†æˆ‘ä»é›¶å¼€å‘ Hexo ä¸»é¢˜ -- [Stun](https://github.com/liuyib/hexo-theme-stun) æ—¶ï¼Œé‡åˆ°çš„æ‰€æœ‰å‘å’Œç»éªŒï¼Œ**ä»…ä¾›å‚è€ƒ**ï¼Œæœ‰ä¸è¶³çš„åœ°æ–¹æ¬¢è¿æŒ‡å‡ºã€‚\n\n## çŸ¥è¯†å‚¨å¤‡\n\n### æ¨¡æ¿å¼•æ“\n\nä¼ ç»Ÿçš„ HTML å†™èµ·æ¥æ—¢ä¸æ–¹ä¾¿ï¼Œåˆä¸èƒ½å¤ç”¨ï¼Œå› æ­¤åœ¨ Hexo ä¸­é€šå¸¸ä½¿ç”¨æ¨¡æ¿å¼•æ“æ¥å‘ˆç°ç½‘ç«™å†…å®¹ã€‚\n\nå¸¸ç”¨çš„å‡ ç§æ¨¡æ¿å¼•æ“æœ‰ï¼š[Swig](https://github.com/paularmstrong/swig)ã€[EJS](https://github.com/hexojs/hexo-renderer-ejs)ã€[Haml](https://github.com/hexojs/hexo-renderer-haml) æˆ– [Jade](https://github.com/hexojs/hexo-renderer-jade)ã€‚å…¶ä¸­ Jade ç”±äºå•†æ ‡é—®é¢˜ï¼Œæ”¹åä¸º [Pug](https://github.com/pugjs/pug)ï¼Œè™½ç„¶å®ƒä»¬æ˜¯å…¼å®¹çš„ï¼Œä½†ä½¿ç”¨çš„æ—¶å€™ï¼Œæ¨èå®‰è£… Pug è€Œä¸æ˜¯ Jadeã€‚Hexo å†…ç½®äº† Swigï¼Œå°†æ–‡ä»¶æ‰©å±•åæ”¹ä¸º `.swig` å³å¯ä½¿ç”¨ï¼Œä½ ä¹Ÿå¯ä»¥å®‰è£…æ’ä»¶æ¥è·å¾—å¦å¤–å‡ ç§æ¨¡æ¿å¼•æ“çš„æ”¯æŒï¼ŒHexo ä¼šæ ¹æ®æ–‡ä»¶æ‰©å±•åæ¥å†³å®šä½¿ç”¨å“ªä¸€ç§ã€‚ä¾‹å¦‚ï¼š\n\n``` text\nlayout.pug   -- ä½¿ç”¨ pug\nlayout.swig  -- ä½¿ç”¨ swig\n```\n\nè¿™é‡Œä½ éœ€è¦åšçš„æ˜¯ï¼Œé€‰æ‹©ä¸€ä¸ªè‡ªå·±å–œæ¬¢çš„æ¨¡æ¿å¼•æ“ï¼Œç„¶åæµè§ˆæ–‡æ¡£ï¼Œäº†è§£è¿™ä¸ªæ¨¡æ¿å¼•æ“çš„åŸºæœ¬ç”¨æ³•ã€‚\n\n- è‹±æ–‡æ–‡æ¡£åœ°å€åˆ†åˆ«å¦‚ä¸‹ï¼š[Swig](https://node-swig.github.io/swig-templates/docs/)ã€[EJS](https://ejs.co/#docs)ã€[Pug](https://pugjs.org/api/getting-started.html)ã€[Haml](http://haml.info/docs.html)ã€‚\n- ä¸­æ–‡æ–‡æ¡£åœ°å€åˆ†åˆ«å¦‚ä¸‹ï¼š[Swig](https://myvin.github.io/swig.zh-CN/docs/index.html)ã€[EJS](https://ejs.bootcss.com/#docs)ã€[Pug](https://pugjs.org/zh-cn/api/getting-started.html)ã€Hamlï¼ˆæ— ï¼‰ã€‚\n\nè¿™é‡Œæˆ‘é€‰æ‹©äº† Pugï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æ¨èä½¿ç”¨ Swig æˆ– EJSã€‚\n\n### CSS é¢„å¤„ç†è¯­è¨€\n\nä½ å¯ä»¥ä½¿ç”¨åŸç”Ÿ CSS æ¥å†™æ ·å¼ï¼Œä½†æ˜¯åŸç”Ÿ CSS éš¾ä»¥å¤ç”¨ï¼Œä¸èƒ½ä½¿ç”¨å¾ªç¯ï¼Œä¸èƒ½ä½¿ç”¨å¸ƒå°”åˆ¤æ–­ï¼Œä¹¦å†™ä¸å¤Ÿæ–¹ä¾¿ï¼Œç­‰ç­‰ã€‚è¿™ä¼šå¯¼è‡´ä¸»é¢˜å¼€å‘å˜å¾—ç›¸å¯¹éº»çƒ¦ï¼Œç”šè‡³æŸäº›åŠŸèƒ½æ— æ³•å®ç°ï¼Œå› æ­¤æœ€å¥½æ˜¯ä½¿ç”¨ CSS é¢„å¤„ç†è¯­è¨€ã€‚\n\nå¸¸è§çš„ CSS é¢„å¤„ç†è¯­è¨€æœ‰ï¼š[Less](http://lesscss.org/)ã€[Sass](https://sass-lang.com/)ã€[Stylus](http://stylus-lang.com/)ã€‚è‡³äºå®ƒä»¬çš„é€‰æ‹©ï¼Œæ ¹æ®è‡ªå·±çš„å–œå¥½å³å¯ã€‚Hexo é»˜è®¤ä½¿ç”¨çš„æ˜¯ Stylusï¼Œå®ƒçš„åŠŸèƒ½è¶³å¤Ÿå¼ºå¤§ï¼Œå®Œå…¨å¤Ÿç”¨ï¼Œå› æ­¤æˆ‘é€‰ç”¨äº† Stylusã€‚\n\n### Hexo ç›¸å…³çŸ¥è¯†\n\næœ‰å…³ Hexo çš„çŸ¥è¯†ï¼Œè¿™é‡Œåªåˆ—ä¸¾å¿…è¦çš„éƒ¨åˆ†ã€‚\n\n#### æ„å»º Hexo å¼€å‘ç¯å¢ƒ\n\nå¼€å‘ä¸»é¢˜ä¹‹å‰ï¼Œä½ éœ€è¦æ­å»º Hexo å·¥ä½œç›®å½•ï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä¾›é€‰æ‹©ï¼š\n\n1. ä½¿ç”¨ `hexo-cli`\n2. å…‹éš† Hexo ä¸»é¢˜çš„å•å…ƒæµ‹è¯•é¡¹ç›®\n\nç¬¬ä¸€ç§æ–¹å¼ï¼Œå» Hexo [å®˜ç½‘](https://hexo.io/zh-cn/)ï¼ŒæŒ‰ç…§æç¤ºå®‰è£… `hexo-cli` å¹¶ç”Ÿæˆä½ çš„ Hexo å·¥ä½œç›®å½•ï¼Œç›®å½•ä¸»è¦éƒ¨åˆ†å¦‚ä¸‹ï¼š\n\n``` text\n.\nâ”œâ”€â”€ scaffolds\nâ”œâ”€â”€ source\n|   â””â”€â”€ _posts\nâ”œâ”€â”€ themes\nâ”œâ”€â”€ .gitignore\nâ”œâ”€â”€ _config.yml\nâ””â”€â”€ package.json\n```\n\nç¬¬äºŒç§æ–¹å¼ï¼Œå…‹éš† Hexo å®˜æ–¹çš„[å•å…ƒæµ‹è¯•åº“](https://github.com/hexojs/hexo-theme-unit-test)ï¼Œè¿™æ ·ä¼šå¾—åˆ°åŒä¸Šçš„æ–‡ä»¶ç›®å½•ã€‚ç„¶åæ‰§è¡ŒæŒ‡ä»¤ `npm install` å®‰è£…æ‰€æœ‰ä¾èµ–ã€‚\n\nå¯¹äºä¸€èˆ¬çš„ Hexo ç”¨æˆ·ï¼ŒåŸºæœ¬éƒ½æ˜¯ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼ã€‚ä¸è¿‡å¯¹äº Hexo ä¸»é¢˜å¼€å‘è€…æ¥è¯´ï¼Œå¦‚æœä½ çš„ä¸»é¢˜å°†æ¥è¦å‘å¸ƒåˆ° Hexo çš„[ä¸»é¢˜åˆ—è¡¨](https://hexo.io/themes)ï¼Œå»ºè®®ç›´æ¥åœ¨ Hexo çš„ä¸»é¢˜å•å…ƒæµ‹è¯•é¡¹ç›®ä¸­è¿›è¡Œå¼€å‘ï¼Œä¹Ÿå°±æ˜¯ç¬¬äºŒç§æ–¹å¼ã€‚å› ä¸º Hexo å»ºè®®åœ¨ä¸»é¢˜å‘å¸ƒå‰ï¼Œå¯¹ä¸»é¢˜è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œç¡®ä¿æ¯ä¸€é¡¹åŠŸèƒ½éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ã€‚Hexo æä¾›çš„å•å…ƒæµ‹è¯•åº“åŒ…æ‹¬äº†æ‰€æœ‰çš„è¾¹ç¼˜æƒ…å†µï¼Œä¾‹å¦‚ï¼šæ–‡ç« æ ‡é¢˜è¿‡é•¿æ—¶çš„æ˜¾ç¤ºæ•ˆæœã€æ–‡ç« æ ‡é¢˜ä¸ºç©ºæ—¶çš„æ˜¾ç¤ºæ•ˆæœï¼ˆæ˜¯ä»€ä¹ˆéƒ½ä¸æ˜¾ç¤ºï¼Œè¿˜æ˜¯æ˜¾ç¤ºä¸€äº›é»˜è®¤çš„æç¤ºæ–‡å­—ï¼‰ã€å¯¹ Front-Matter çš„æ”¯æŒç¨‹åº¦ï¼Œç­‰ç­‰ã€‚ç›´æ¥ä½¿ç”¨ Hexo ä¸»é¢˜çš„å•å…ƒæµ‹è¯•é¡¹ç›®ä½œä¸ºä½ çš„å¼€å‘ç›®å½•ï¼Œå°±å¯ä»¥åœ¨å¼€å‘è¿‡ç¨‹ä¸­æ³¨æ„åˆ°è¿™äº›è¾¹ç¼˜æƒ…å†µï¼Œè€Œä¸æ˜¯å¼€å‘å®Œå†å»æµ‹è¯•ã€‚\n\næ­å»ºå®Œ Hexo å¼€å‘ç¯å¢ƒåï¼Œéœ€è¦å®‰è£…ç›¸å…³æ’ä»¶æ¥æ”¯æŒä½ æ‰€ä½¿ç”¨çš„æ¸²æŸ“å¼•æ“ã€‚Hexo é»˜è®¤å®‰è£…çš„æ¸²æŸ“å¼•æ“æ˜¯ EJS å’Œ Stylusï¼Œå¹¶ä¸” Hexo å†…ç½®äº† Swigï¼Œå› æ­¤ï¼Œå¦‚æœä½ é€‰ç”¨äº† `EJS + Stylus` æˆ– `Swig + Stylus`ï¼Œé‚£ä¹ˆå¯ä»¥å¿½ç•¥è¿™æ®µï¼Œå¦‚æœä½ é€‰æ‹©äº†å…¶ä»–çš„æ¸²æŸ“å¼•æ“ï¼Œéœ€è¦è‡ªè¡Œé€‰æ‹©å®‰è£…ï¼š\n\n``` bash\n# Templates\n$ npm install --save hexo-renderer-ejs\n$ npm install --save hexo-renderer-pug\n$ npm install --save hexo-renderer-haml\n\n# Styles\n$ npm install --save hexo-renderer-less\n$ npm install --save hexo-renderer-sass\n$ npm install --save hexo-renderer-stylus\n```\n\n#### ç”Ÿæˆä¸»é¢˜ç»“æ„ç›®å½•\n\nä¸Šä¸€æ­¥åªæ˜¯æ­å»ºå¥½äº† Hexo å·¥ä½œç›®å½•ï¼Œæ¥ä¸‹æ¥æ˜¯åˆ›å»ºä¸»é¢˜çš„æ–‡ä»¶ç›®å½•ï¼Œä½ å¯ä»¥å‚è€ƒç€å·²æœ‰çš„ä¸»é¢˜çš„æ–‡ä»¶ç›®å½•æ‰‹åŠ¨åˆ›å»ºï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ `Yeoman` è‡ªåŠ¨ç”Ÿæˆï¼Œä½¿ç”¨ `Yeoman` è‡ªåŠ¨ç”Ÿæˆçš„æ­¥éª¤å¦‚ä¸‹ã€‚\n\n1. å®‰è£…\n\n``` bash\n$ npm install --global yo\n$ npm install --global generator-hexo-theme\n```\n\n2. ç”Ÿæˆ\n\nè¿›å…¥ Hexo çš„ `themes` ç›®å½•ä¸­ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºä½ çš„ä¸»é¢˜ç›®å½•ï¼Œç„¶åè¿›å…¥è¯¥æ–‡ä»¶å¤¹ä¸­ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼š\n\n``` bash\nyo hexo-theme\n```\n\næŒ‰ç…§æç¤ºï¼Œå¡«å†™æˆ–é€‰æ‹©ç›¸åº”çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾ï¼š\n\n![](/assets/posts/develop-hexo-theme-from-0-to-1/init-hexo-by-yeoman.png)\n\nç”Ÿæˆçš„æ–‡ä»¶ç›®å½•å¦‚ä¸‹ï¼š\n\n``` text\n.\nâ”œâ”€â”€ layout        # å¸ƒå±€æ–‡ä»¶å¤¹\n|   â”œâ”€â”€ includes\n|   |   â”œâ”€â”€ layout.pug       # é¡µé¢æ€»ä½“å¸ƒå±€\n|   |   â””â”€â”€ recent-posts.pug # æ–‡ç« åˆ—è¡¨\n|   â”œâ”€â”€ index.pug            # é¦–é¡µ\n|   â”œâ”€â”€ archive.pug          # å½’æ¡£é¡µ\n|   â”œâ”€â”€ category.pug         # åˆ†ç±»é¡µ\n|   â”œâ”€â”€ tag.pug              # æ ‡ç­¾é¡µ\n|   â”œâ”€â”€ post.pug             # æ–‡ç« é¡µ\n|   â””â”€â”€ page.pug             # é™¤ä»¥ä¸Šé¡µé¢ä¹‹å¤–çš„é¡µé¢\nâ”œâ”€â”€ scripts       # è„šæœ¬æ–‡ä»¶å¤¹\nâ”œâ”€â”€ source        # èµ„æºæ–‡ä»¶å¤¹\n|   â”œâ”€â”€ css\n|   â”œâ”€â”€ js\n|   â””â”€â”€ favicon.ico\nâ”œâ”€â”€ .editorconfig # ç¼–è¾‘å™¨é…ç½®æ–‡ä»¶\nâ”œâ”€â”€ _config.yml   # ä¸»é¢˜é…ç½®æ–‡ä»¶\nâ””â”€â”€ package.json\n```\n\nå½“ç„¶åªæœ‰è¿™äº›æ–‡ä»¶ç›®å½•æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¦å¤–æ·»åŠ ä¸€äº›å…¶ä»–çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¾‹å¦‚ï¼Œ`languages` ç›®å½•ï¼Œæ”¾ç½®è¯­è¨€æ–‡ä»¶ï¼Œç”¨äº[å›½é™…åŒ–ï¼ˆi18nï¼‰](https://hexo.io/zh-cn/docs/internationalization)è®¾ç½®ï¼ˆå¦‚æœä½ çš„ä¸»é¢˜éœ€è¦æ”¯æŒå¤šè¯­è¨€ï¼Œå°±æ·»åŠ è¯¥ç›®å½•ï¼Œå¦åˆ™ä¸ç”¨æ·»åŠ ï¼‰ã€‚\n\næœ‰å…³ä»¥ä¸Šç›®å½•çš„ä»‹ç»ï¼Œè¯¦å‚è§ï¼š[Hexo ä¸»é¢˜](https://hexo.io/zh-cn/docs/themes)ã€‚\n\n> è¿™é‡Œéœ€è¦æä¸€ä¸‹ï¼Œä¸»é¢˜ç›®å½•å’Œ Hexo æ ¹ç›®å½•ä¸­å„æœ‰ä¸€ä¸ª `source` æ–‡ä»¶å¤¹ï¼Œå½“ä½ æ‰§è¡ŒæŒ‡ä»¤ `hexo generate` æ¥ç”Ÿæˆé™æ€æ–‡ä»¶æ—¶ï¼Œè¿™ä¸¤ä¸ª `source` ç›®å½•ä¸­çš„æ–‡ä»¶å¦‚æœæ˜¯ Markdown æ–‡ä»¶ï¼Œåˆ™ä¼šè¢«è§£æä¸º HTMLï¼Œè€Œå…¶ä»–ç±»å‹çš„æ–‡ä»¶åˆ™ä¼šè¢«å¤åˆ¶åˆ° `public` ç›®å½•ä¸­ã€‚`public` ç›®å½•ç”¨äºå­˜æ”¾æ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å°±æ˜¯çº¿ä¸Šè·‘çš„ç½‘ç«™èµ„æºæ–‡ä»¶ã€‚**å› æ­¤ï¼Œå¦‚æœä½ ä¸æ¸…æ¥š `source` ç›®å½•é‡Œæ–‡ä»¶çš„ä½¿ç”¨è·¯å¾„æ˜¯æ€æ ·çš„ï¼Œé‚£ä¹ˆä½ å¯ä»¥è·‘ä¸€ä¸‹æŒ‡ä»¤ `hexo generate`ï¼Œè¿™äº›æ–‡ä»¶ç”Ÿæˆåˆ° `public` ç›®å½•ä¸­åï¼Œå®ƒä»¬çš„è·¯å¾„å…³ç³»å°±å¾ˆæ˜æ˜¾äº†ã€‚**\n\n#### é€šè¯»æ–‡æ¡£\n\nè™½ç„¶ Hexo çš„æ–‡æ¡£ç¡®å®å¾ˆå·®åŠ²ï¼Œæ–‡æ¡£ä¸‹é¢çš„è¯„è®ºåŒºå…¨æ˜¯åæ§½ï¼Œè€Œä¸”æœ‰äº›éƒ¨åˆ†ä¸­è‹±æ–‡ç‰ˆæœ¬æ²¡æœ‰åŒæ­¥ï¼Œä½†æ˜¯å¦‚æœèƒ½è€å¿ƒè¯»å®Œï¼Œä¼šæœ‰å¾ˆå¤§çš„æ”¶ç›Šï¼Œæˆ‘ä¸ªäººçš„æœ€å¤§æ„Ÿå—æ˜¯ Hexo çš„æ–‡æ¡£çœŸçš„ç‰¹åˆ«é‡è¦ã€‚å½“ç„¶ä¸€æ¬¡æŒæ¡æ˜¯ä¸å¯èƒ½çš„ï¼Œæˆ‘çš„å»ºè®®æ˜¯åœ¨å¼€å‘æ—¶æ¯éš”ä¸€æ®µæ—¶é—´è¿‡ä¸€éï¼ˆHexo çš„ä¸€äº›é‡è¦åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼šæ ‡ç­¾æ’ä»¶ã€Front-Matterï¼Œç­‰ç­‰ï¼Œä¹Ÿåªæœ‰é€šè¿‡é˜…è¯»æ–‡æ¡£ç†Ÿæ‚‰äº†ä¹‹åï¼Œæ‰èƒ½æ›´å¥½çš„å®ç°å’Œæ”¯æŒï¼‰ã€‚\n\nåˆšå¼€å§‹å¼€å‘ä¸»é¢˜ï¼Œä¸å¯èƒ½ç†è§£ Hexo æ–‡æ¡£ä¸­æåˆ°çš„æ‰€æœ‰åœ°æ–¹ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªç‚¹å¿…é¡»é¦–å…ˆæŒæ¡ï¼š[å˜é‡](https://hexo.io/zh-cn/docs/variables)å’Œ[è¾…åŠ©å‡½æ•°](https://hexo.io/zh-cn/docs/helpers)ï¼Œè¿™ä¸¤ç‚¹åœ¨å¼€å‘æ—¶ä¼šç»å¸¸ç”¨åˆ°ï¼Œå¹¶ä¸”è´¯ç©¿æ•´ä¸ªå¼€å‘è¿‡ç¨‹ã€‚\n\n## ä¸»é¢˜å¼€å‘\n\næœ‰äº†ä¸Šè¿°çš„å‡†å¤‡åï¼Œå°±å¯ä»¥å¼€å§‹ä¸»é¢˜çš„å¼€å‘äº†ã€‚ä¸‹é¢æ˜¯ä¸»é¢˜å¼€å‘ä¸­ä¸€äº›å€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œäº†è§£è¿™äº›ï¼Œå¯ä»¥å¸®åŠ©ä½ é¿å…è¸©é‡å¤çš„å‘ã€‚\n\n### ä¸»é¢˜é…ç½®æ–‡ä»¶\n\nä¸»é¢˜çš„é…ç½®æ–‡ä»¶é‡‡ç”¨äº† [Yaml](https://docs.ansible.com/ansible/latest/reference_appendices/YAMLSyntax.html) è¯­æ³•ï¼Œå’Œ Json ç±»ä¼¼ï¼Œäº†è§£ä¸€ä¸‹è¯­æ³•æ ¼å¼å°±å¯ä»¥ä¸Šæ‰‹ä½¿ç”¨äº†ã€‚\n\nå¼€å‘ä¸»é¢˜æ—¶ï¼Œæœ‰çš„åŠŸèƒ½å¯ä»¥è®©ç”¨æˆ·è‡ªå·±é…ç½®ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å°†è¿™äº›åŠŸèƒ½çš„é…ç½®é¡¹æš´éœ²å‡ºæ¥ï¼Œå¡«å……åˆ°ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ `_config.yml` ä¸­ã€‚ç„¶ååœ¨æ¨¡æ¿å¼•æ“ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡ Hexo å†…ç½®çš„ `theme` å˜é‡æ¥è·å–è¿™äº›é…ç½®é¡¹ã€‚ä¾‹å¦‚ï¼š\n\né…ç½®æ–‡ä»¶ï¼š\n\n``` yaml _config.yml\ncopyright:\n  enable: true\n  text:\n```\n\nè¿™æ ·ä½¿ç”¨ï¼š\n\n``` html\n// -------------------- Pug è¯­æ³• --------------------\nif theme.copyright.enable\n  div.copyright= theme.copyright.text\n\n// -------------------- Swig è¯­æ³• --------------------\n{% if theme.copyright.enable %}\n<div class=\"copyright\">{{ theme.copyright.text }}</div>\n{% endif %}\n```\n\n{% note default %}\næ–‡ç« æ¥ä¸‹æ¥çš„éƒ¨åˆ†ä¸­ï¼Œæ¨¡æ¿è¯­è¨€ç¤ºä¾‹ä»£ç éƒ½ä¼šç”¨ Pug å’Œ Swig ä¸¤ç§è¯­æ³•ç»™å‡ºã€‚\n{% endnote %}\n\néšç€é¡¹ç›®çš„å‘å±•ï¼Œé…ç½®æ–‡ä»¶ä¼šè¶Šæ¥è¶Šå¤§ï¼Œä¸Šé¢è¿™ç§åšæ³•çš„ç¼ºç‚¹ä¹Ÿä¼šè¶Šæ¥è¶Šæ˜æ˜¾ã€‚\n\n- å¯¹äºä½¿ç”¨è€…\n\n  å½“æ›´æ–°ä¸»é¢˜æ—¶ï¼Œç”±äºé…ç½®æ–‡ä»¶ä¼šè¢«è¦†ç›–ï¼Œå› æ­¤ç”¨æˆ·å¿…é¡»æå‰å°†é…ç½®æ–‡ä»¶å¤‡ä»½ï¼Œç­‰æ›´æ–°å®Œä¸»é¢˜åå†å°†å¤‡ä»½çš„æ•°æ®æ‹·è´å›å»ï¼Œè¿™ä¸ªè¿‡ç¨‹ç¹çåˆå®¹æ˜“å‡ºé”™ã€‚\n\n- å¯¹äºå¼€å‘è€…\n\n  åœ¨å‘å¸ƒä¸»é¢˜æ—¶ï¼Œå¼€å‘è€…ä¸å¯èƒ½å°†è‡ªå·±æµ‹è¯•ç”¨çš„æ•°æ®ä¿ç•™åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œåº”è¯¥é¢„ç•™ä¸€ä»½å¹²å‡€çš„é…ç½®æ–‡ä»¶ã€‚å› æ­¤æ¯æ¬¡å‘å¸ƒä¸»é¢˜ä¹‹å‰ï¼Œéƒ½éœ€è¦æŠŠä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œçš„æµ‹è¯•æ•°æ®æ¸…ç©ºã€å¤‡ä»½ï¼Œç„¶åç­‰å‘å¸ƒå®Œä¸»é¢˜åå†æ¢å¤å›æ¥ã€‚è¿™ç§åšæ³•æ˜¯æ— æ³•ä»¤äººå¿å—çš„ï¼Œå› ä¸ºæ¯æ¬¡ `git commit` ä¹‹å‰éƒ½éœ€è¦è¿™æ ·åšä¸€æ¬¡ã€‚\n\nå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§æ›´å‹å¥½çš„æ–¹å¼æ¥ä½¿ç”¨é…ç½®æ–‡ä»¶ã€‚åœ¨æŸ¥æ‰¾èµ„æ–™å’Œå‚è€ƒç°æœ‰ä¸»é¢˜ NexTã€Melody çš„å®ç°åï¼Œå‘ç°å¯ä»¥åˆ©ç”¨ Hexo 3.0 æä¾›çš„æ–°ç‰¹æ€§ -- [æ•°æ®æ–‡ä»¶](https://hexo.io/zh-cn/docs/data-files)ï¼Œæ¥è§£å†³ä¸Šé¢çš„ç—›ç‚¹ã€‚\n\nä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œåœ¨ Hexo æ ¹ç›®å½•ä¸‹çš„ `source/_data` æ–‡ä»¶å¤¹ä¸­ï¼ˆæ²¡æœ‰çš„æ–‡ä»¶å¤¹éœ€è¦è‡ªå·±åˆ›å»ºï¼‰ï¼Œæ–°å»ºä¸€ä¸ª Yaml é…ç½®æ–‡ä»¶ï¼Œå¹¶**å‘½åä¸ºä¸»é¢˜çš„åç§°**ï¼Œä¾‹å¦‚ Stun ä¸»é¢˜ï¼Œå°±å«åš `stun.yml`ã€‚ç„¶åå°†ä¸»é¢˜é…ç½®æ–‡ä»¶ `_config.yml` é‡Œçš„å†…å®¹å¤åˆ¶åˆ° `stun.yml` ä¸­ï¼Œè¿™æ · `stun.yml` å°±ä¼šè¦†ç›– `_config.yml`ã€‚å¦‚æœæƒ³è¦ä¿®æ”¹é…ç½®ï¼Œç›´æ¥ä¿®æ”¹ `stun.yml` å°±å¥½äº†ã€‚å½“ç”¨æˆ·æ›´æ–°ä¸»é¢˜æˆ–è€…å¼€å‘è€…å‘å¸ƒä¸»é¢˜æ—¶ï¼Œé…ç½®æ•°æ®ä¿å­˜åœ¨ `stun.yml` ä¸­ï¼Œä¸»é¢˜åŸæ¥çš„é…ç½®æ–‡ä»¶ `_config.yml` ä»ç„¶æ˜¯å¹²å‡€çš„ã€‚\n\nä¸‹é¢æ˜¯ä»£ç å®ç°ï¼Œåœ¨ä¸»é¢˜æ ¹ç›®å½•ä¸‹çš„ `scripts` æ–‡ä»¶å¤¹ä¸­ï¼ˆæ²¡æœ‰å°±æ–°å»ºï¼‰ï¼Œæ·»åŠ ä¸€ä¸ª JS æ–‡ä»¶ï¼Œæ–‡ä»¶åéšæ„ï¼Œæ·»åŠ å¦‚ä¸‹ä»£ç ï¼š\n\n``` js\nhexo.on('generateBefore', function () {\n  var rootConfig = hexo.config;\n\n  if (hexo.locals.get) {\n    // è·å– source/_data ç›®å½•ä¸‹çš„æ–‡ä»¶\n    var data = hexo.locals.get('data');\n\n    // å¦‚æœå­˜åœ¨ stun.yml æ–‡ä»¶ï¼Œå°±ç”¨å®ƒè¦†ç›–åŸæ¥çš„é…ç½®æ–‡ä»¶\n    if (data && data.stun) {\n      hexo.theme.config = data.stun;\n    }\n  }\n\n  hexo.theme.config.rootConfig = rootConfig;\n});\n```\n\n### é¡µé¢æ­å»º\n\nä½ éœ€è¦åˆ†æä¸»é¢˜é¡µé¢çš„ç»“æ„ï¼Œå°†èƒ½å¤Ÿå…¬ç”¨çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥ï¼Œä¾‹å¦‚ï¼š\n\n- HTML çš„ `head` éƒ¨åˆ†\n- é¡¶éƒ¨å¯¼èˆªæ \n- é¡µé¢å¤´éƒ¨ã€åº•éƒ¨\n- é¡µé¢ä¾§è¾¹æ \n- é¡µé¢ä¸»ä½“éƒ¨åˆ†ï¼ˆæ˜¾ç¤ºæ–‡ç« çš„åœ°æ–¹ï¼‰\n- ......\n\nå°†è¿™äº›éƒ¨åˆ†å¯¹åº”çš„ä»£ç æ”¾åœ¨ä¸»é¢˜ `layout` ç›®å½•ä¸‹çš„ `layout.pug` æ–‡ä»¶ä¸­ç”¨ä»¥å¤ç”¨ï¼Œä¾‹å¦‚ï¼š\n\n``` html\n// -------------------- Pug è¯­æ³• --------------------\nhtml\n  head\n    title\n      block title\n  body\n    header#header.header\n      div.header-inner\n        include ./header.pug\n    \n    main#main.main\n      div.main-inner\n        div#content.content\n          div.content-inner\n            block content\n        \n        div#sidebar.sidebar\n          div.sidebar-inner\n            block sidebar\n\n    footer#footer.footer\n      div.footer-inner\n        include ./footer.pug\n\n// -------------------- Swig è¯­æ³• --------------------\n<html>\n  <head>\n    <title>{% block title %}{% endblock %}</title>\n  </head>\n\n  <body>\n    <header id=\"header\" class=\"header\">\n      <div class=\"header-inner\">\n        {% include './header.swig' %}\n      </div>\n    </header>\n\n    <main id=\"main\" class=\"main\">\n      <div class=\"main-inner\">\n        <div id=\"content\" class=\"content\">\n          <div class=\"content-inner\">\n            {% block content %}{% endblock %}\n          </div>\n        </div>\n        \n        <div id=\"sidebar\" class=\"sidebar\">\n          <div class=\"sidebar-inner\">\n            {% block sidebar %}{% endblock %}\n          </div>\n        </div>\n      </div>\n    </main>\n\n    <footer id=\"footer\" class=\"footer\">\n      <div class=\"footer-inner\">\n        {% include './footer.swig' %}\n      </div>\n    </footer>\n  </body>\n</html>\n```\n\n`layout.pug` æ˜¯ç½‘ç«™æœ€åŸºç¡€çš„å¸ƒå±€ä»£ç ï¼Œæ‰€æœ‰çš„é¡µé¢éƒ½æ˜¯ç»§æ‰¿å®ƒè€Œæ¥ã€‚Pug / Swig ä½¿ç”¨ `extends` å’Œ `block` å®ç°ç»§æ‰¿ï¼Œä¾‹å¦‚ï¼š\n\n``` html\n// -------------------- Pug è¯­æ³• --------------------\nhtml\n  head\n    title\n      block title\n\n  body\n    block content\n\n// -------------------- Swig è¯­æ³• --------------------\n<html>\n  <head>\n    <title>{% block title %}{% endblock %}</title>\n  </head>\n  <body>\n    {% block content %}{% endblock %}\n  </body>\n</html>\n```\n\n``` html\n// -------------------- Pug è¯­æ³• --------------------\nextends layout.pug\n\nblock title\n  My Page\n\nblock content\n  This is a awesome page.\n\n// -------------------- Swig è¯­æ³• --------------------\n{% extends 'layout.swig' %}\n\n{% block title %}My Page{% endblock %}\n\n{% block content %}\n<p>This is a awesome page.</p>\n{% endblock %}\n```\n\né™¤äº†ç»§æ‰¿çš„æ–¹å¼å¤ç”¨ä»£ç ï¼Œè¿˜å¯ä»¥é€šè¿‡ `include` è¯­æ³•ç›´æ¥å¼•æ–‡ä»¶æ¥å®ç°ä»£ç å¤ç”¨ï¼Œä¾‹å¦‚ï¼š\n\n``` html\n// -------------------- Pug è¯­æ³• --------------------\ndiv#header.header\n  include ./header.pug\n\n// -------------------- Swig è¯­æ³• --------------------\n<div id=\"header\" class=\"header\">\n  {% include './header.swig' %}\n</div>\n```\n\n> ç”±äº `layout.pug` åªç”¨äºè¢«å…¶ä»–é¡µé¢ç»§æ‰¿ï¼Œå¹¶ä¸ä¼šå•ç‹¬æ¸²æŸ“æˆé¡µé¢ï¼Œå› æ­¤ï¼Œå¯ä»¥å°†æ–‡ä»¶åæ”¹ä¸º `_layout.pug`ï¼ˆä»¥ä¸‹åˆ’çº¿å¼€å¤´ï¼‰è¿™æ · Hexo å°±ä¸ä¼šè§£æè¿™ä¸ªæ–‡ä»¶ï¼Œå¯ä»¥æé«˜ Hexo ç”Ÿæˆé¡µé¢çš„é€Ÿåº¦ã€‚\n\nè¿™é‡Œæˆ‘å¹¶ä¸å‡†å¤‡ä»‹ç»é¡µé¢ä¸­æ›´è¯¦ç»†çš„éƒ¨åˆ†å¦‚ä½•å®ç°ï¼Œç›´æ¥çœ‹[æºç ](https://github.com/liuyib/hexo-theme-stun)æ•ˆæœæ›´å¥½ã€‚\n\n### æ•°æ®äº¤äº’\n\nè¿™é‡Œä»‹ç»ä¸‹ Pug / Swigã€Stylusã€JavaScript è¿™å‡ ç§æ–‡ä»¶å¦‚ä½•ä¸ä¸»é¢˜é…ç½®æ–‡ä»¶è¿›è¡Œæ•°æ®äº¤äº’ã€‚\n\nå‰é¢æˆ‘ä»¬å·²ç»çŸ¥é“äº†ï¼Œä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œçš„é…ç½®é¡¹è¢«åŒ…å«åœ¨ `theme` å˜é‡ä¸‹ã€‚å› æ­¤åœ¨æˆ‘ä»¬éœ€è¦çŸ¥é“å¦‚ä½•åœ¨å¦å¤–ä¸‰ç§æ–‡ä»¶ä¸­ä½¿ç”¨ `theme` å˜é‡ï¼š\n\n- åœ¨ Pug / Swig æ–‡ä»¶ä¸­ä½¿ç”¨\n\n  ``` html\n  // -------------------- Pug è¯­æ³• --------------------\n  div= theme.copyright.text\n\n  html(lang=theme.language)\n\n  if theme.sidebar.enable\n    div.sidebar\n\n  div(class=`sidebar ${ if theme.sidebar.show ? 'show' : '' }`)\n\n  // -------------------- Swig è¯­æ³• --------------------\n  <div>{{ theme.copyright.text }}</div>\n\n  <html lang=\"{{ theme.language }}\"></html>\n\n  {% if theme.sidebar.enable %}\n    <div class=\"sidebar\"></div>\n  {% endif %}\n\n  <div class=\"sidebar {% if theme.sidebar.show %}show{% endif %}\"></div>\n  ```\n\n- åœ¨ Stylus æ–‡ä»¶ä¸­ä½¿ç”¨\n\n  éœ€è¦é€šè¿‡ Hexo å†…ç½®çš„å‡½æ•° `hexo-config` æ¥è·å– `theme` å˜é‡ä¸­çš„å±æ€§ï¼Œä½†æ˜¯ä¸éœ€è¦åŠ  `theme.` å‰ç¼€ï¼š\n\n  ``` stylus\n  // back2top æ˜¯ theme å˜é‡ä¸‹çš„ä¸€ä¸ªå±æ€§\n  if (hexo-config('back2top.enable'))\n    .back2top\n      display: block\n\n  // å¦‚æœé…ç½®é¡¹çš„å€¼ä¸­å«æœ‰æ ·å¼ï¼Œéœ€è¦ä½¿ç”¨ Stylus çš„ convert å‡½æ•°è½¬æ¢ä¸€ä¸‹\n  .post-title\n    color: convert(hexo-config('post.title.color'))\n  ```\n\n  > åœ¨å…¶ä»–çš„ CSS é¢„å¤„ç†è¯­è¨€ä¸­ï¼Œç†è®ºä¸Šä¹Ÿå¯ä»¥é€šè¿‡ `hexo-config` æ¥è·å– `theme` å˜é‡ä¸­çš„å±æ€§ï¼Œæˆ‘æ²¡è¯•è¿‡ï¼Œå¼€å‘è€…å¯ä»¥è‡ªè¡Œå°è¯•ã€‚\n\n- åœ¨ JavaScript æ–‡ä»¶ä¸­ä½¿ç”¨\n\n  åœ¨ JS æ–‡ä»¶ä¸­æ²¡æœ‰åŠæ³•ç›´æ¥è·å–åˆ° Hexo å†…ç½®çš„ `theme` å˜é‡ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥æ¢ä¸€ç§æ–¹å¼æ¥é—´æ¥è·å–ã€‚æ–°å»ºä¸€ä¸ªæ¨¡æ¿å¼•æ“æ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å«å®ƒ `config.pug`ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š\n\n  ``` html\n  // ----- Pug è¯­æ³•ï¼ˆæ³¨æ„ script æ ‡ç­¾åé¢çš„ç‚¹ï¼Œè¡¨ç¤ºè¯¥æ ‡ç­¾åé¢æœ‰å¤šè¡Œä»£ç ï¼‰-----\n  script.\n    var CONFIG = {\n      sidebar: '!{ theme.sidebar }',\n      back2top: '!{ theme.back2top }',\n      ...\n    };\n\n    window.CONFIG = CONFIG;\n\n  // -------------------- Swig è¯­æ³• --------------------\n  <script>\n    var CONFIG = {\n      sidebar: {{ theme.sidebar | json_encode }},\n      back2top: {{ theme.back2top | json_encode }},\n      ...\n    };\n\n    window.CONFIG = CONFIG;\n  </script>\n  ```\n\n  ç„¶åå°† `config.pug` æ–‡ä»¶æ”¾åœ¨ HTML çš„ `head` æ ‡ç­¾ä¸­åŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å…¨å±€å˜é‡ `CONFIG` åœ¨ JS ä¸­è·å–ä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œçš„æ•°æ®äº†ã€‚\n\nåˆ°è¿™é‡Œä¸ºæ­¢ï¼Œå°±ä»‹ç»å®Œäº†å¼€å‘ Hexo ä¸»é¢˜å‰å¿…è¦çš„çŸ¥è¯†å‚¨å¤‡ï¼Œå‰©ä¸‹çš„å°±é å¼€å‘è€…è‡ªå·±å®Œæˆäº†ã€‚\n\n## å‘å¸ƒä¸»é¢˜\n\nå‘å¸ƒä¸»é¢˜ä¹‹å‰ä½ éœ€è¦è¿›è¡Œ[ä¸»é¢˜å•å…ƒæµ‹è¯•](https://github.com/hexojs/hexo-theme-unit-test)ï¼Œç¡®ä¿æ¯ä¸€é¡¹åŠŸèƒ½éƒ½èƒ½æ­£å¸¸ä½¿ç”¨ã€‚å¦‚æœä½ æ˜¯æŒ‰ç…§æˆ‘ä¹‹å‰ä»‹ç»çš„æ–¹æ³•ï¼Œç›´æ¥ Hexo çš„ä¸»é¢˜å•å…ƒæµ‹è¯•åº“ä¸­å¼€å‘ä¸»é¢˜ï¼Œé‚£ä¹ˆä½ åº”è¯¥å°±ä¸éœ€è¦è¿›è¡Œè¿™ä¸€æ­¥äº†ã€‚\n\n1ã€Fork [hexojs/site](https://github.com/hexojs/site)\n2ã€ç¼–è¾‘ `source/_data/themes.yml`ï¼Œåœ¨æ–‡ä»¶ä¸­æ–°å¢æ‚¨çš„ä¸»é¢˜ï¼š\n\n``` yaml themes.yml\n- name: Stun\n  description: A beautiful & simple theme\n  link: https://github.com/liuyib/hexo-theme-stun\n  preview: https://liuyib.github.io/\n  tags:\n    - responsive\n    - beautiful\n    - simple\n    - two_column\n```\n\n3ã€åœ¨ `source/themes/screenshots` ä¸­æ·»åŠ ä¸€ä¸ªå’Œä½ ä¸»é¢˜åŒåçš„å›¾ç‰‡ï¼Œå›¾ç‰‡å¿…é¡»ä¸º 800*500 çš„ PNG æ–‡ä»¶ã€‚\n4ã€å‘èµ·æ–°çš„åˆå¹¶ç”³è¯·ï¼ˆpull requestï¼‰ã€‚\n\næœ€åï¼Œåªéœ€è¦ç­‰å¾… Hexo ä»“åº“çš„ç»´æŠ¤äººå‘˜æ”¶å½•ä½ çš„ä¸»é¢˜å³å¯ã€‚\n\n---\n\nå‚è€ƒèµ„æ–™ï¼š\n\n- [Hexoä¸»é¢˜å¼€å‘ç»éªŒæ‚è°ˆ](https://molunerfinn.com/make-a-hexo-theme/)\n- [Hexo ä¸»é¢˜å¼€å‘æŒ‡å—](http://chensd.com/2016-06/hexo-theme-guide.html)\n","tags":["Hexo"],"categories":["Hexo ä¸»é¢˜å¼€å‘"]},{"title":"theme-stun-gitter","url":"/2019/07/26/theme-stun-gitter/","content":"\nThis is a link for Gitter of theme-stun. Clicking on the title to talking.\n"},{"title":"å‰ç«¯å•å…ƒæµ‹è¯•å’ŒæŒç»­é›†æˆ","url":"/2019/06/04/front-end-unit-test-and-ci/","content":"\nå‰ç«¯çš„å•å…ƒæµ‹è¯•åŒ…æ‹¬ä½†ä¸é™äºï¼šå•å…ƒåŠŸèƒ½æµ‹è¯•ã€UI æµ‹è¯•ã€å…¼å®¹æ€§æµ‹è¯•ç­‰ç­‰ã€‚ä¸€ä¸ªæµ‹è¯•ä½“ç³»å¤§ä½“åŒ…æ‹¬å››éƒ¨åˆ†ï¼š\n\n- æµ‹è¯•è¿è¡Œå™¨ï¼ˆe.g. [Karma](https://github.com/karma-runner/karma)ï¼‰\n- æµ‹è¯•æ¡†æ¶ï¼ˆe.g. [Mocha](https://github.com/mochajs/mocha), [Jest](https://github.com/facebook/jest), [Jasmine](https://github.com/jasmine/jasmine), [Qunit](https://github.com/qunitjs/qunit)ï¼‰\n- æ–­è¨€åº“ï¼ˆe.g. [Should](https://github.com/shouldjs/should.js), [Chai](https://github.com/chaijs/chai)ï¼‰\n- æµ‹è¯•è¦†ç›–ç‡ï¼ˆe.g. [Istanbul](https://github.com/gotwarlost/istanbul)ï¼‰\n\n<!-- more -->\n\næœ¬æ–‡ä¼šé€šè¿‡ä¸€ä¸ªä¾‹å­ï¼Œæ¥ä¸€æ­¥æ­¥äº†è§£å¦‚ä½•è¿›è¡Œå‰ç«¯å•å…ƒæµ‹è¯•ã€‚\n\n> æœ¬æ–‡ä¸¾çš„ä¾‹å­ä¸­ï¼Œæ²¡æœ‰æ¶‰åŠæµ‹è¯•è¿è¡Œå™¨ï¼Œåªæ¶‰åŠæµ‹è¯•æ¡†æ¶ã€æ–­è¨€åº“å’Œæµ‹è¯•è¦†ç›–ç‡ã€‚å¹¶ä»¥ `Mocha + Should + Istanbul` ç»„åˆä¸ºä¾‹ã€‚\n>\n> å¦‚æœä½ çŸ¥é“ Karma æ˜¯å¹²ä»€ä¹ˆçš„ï¼Œå¹¶ä¸”éœ€è¦ç”¨åˆ°å®ƒï¼Œæ¨èé˜…è¯»æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š[ä½¿ç”¨ Karma + Mocha æ„å»º Web å•å…ƒæµ‹è¯•ç¯å¢ƒ](https://liuyib.github.io/2020/03/20/use-karma-mocha-chai-to-test/)\n\n## æ–°å»ºé¡¹ç›®\n\nå¦‚æœä½ çš„ç”µè„‘ä¸Šæ²¡æœ‰å®‰è£… Node.jsï¼Œé‚£ä¹ˆä½ éœ€è¦è®¿é—®å®ƒçš„[å®˜ç½‘](https://nodejs.org/zh-cn/)ï¼Œä¸‹è½½å¹¶å®‰è£…åˆ°ä½ çš„ç”µè„‘ä¸Šã€‚NPM æ˜¯ Node.js çš„åŒ…ç®¡ç†å·¥å…·ï¼Œä¼šéšç€ Node.js ä¸€èµ·å®‰è£…ã€‚\n\nç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç”¨ NPMï¼ˆNode Package Managerï¼‰æ¥ç®¡ç†ä¾èµ–åŒ…ï¼Œæ‰€ä»¥å…ˆåˆå§‹åŒ– NPM çš„é…ç½®æ–‡ä»¶ `package.json`ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼š\n\n```bash\n$ npm init -y\n```\n\n> `-y` å‚æ•°è¡¨ç¤ºä¸è¿›è¡Œè¯¢é—®ï¼Œç›´æ¥ä½¿ç”¨é»˜è®¤çš„é…ç½®ã€‚\n\nä¸‹é¢æˆ‘ä»¬åœ¨ `src` ç›®å½•ä¸‹ï¼Œæ–°å»º `main.js` æ–‡ä»¶ï¼Œå¹¶ç¼–å†™ä¸€ä¸ª `factorial` å‡½æ•°ï¼ˆç”¨äºæ±‚æ•°çš„é˜¶ä¹˜ï¼‰ï¼š\n\n```js\n// main.js\n\nvar factorial = function(n) {\n  if (n === 0) {\n    return 1;\n  }\n\n  return factorial(n - 1) * n;\n};\n\nif (require.main === module) {\n  // å¦‚æœæ˜¯åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œ main.jsï¼Œåˆ™æ­¤å¤„ä¼šæ‰§è¡Œã€‚\n  // å¦‚æœ main.js è¢«å…¶ä»–æ–‡ä»¶ requireï¼Œåˆ™æ­¤å¤„ä¸ä¼šæ‰§è¡Œã€‚\n  var n = Number(process.argv[2]);\n  console.log('factorial(' + n + ') is', factorial(n));\n}\n```\n\nè¿è¡Œä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶ï¼Œçœ‹çœ‹ç»“æœæ˜¯å¦æ­£ç¡®ã€‚æ‰§è¡ŒæŒ‡ä»¤ï¼š`node ./src/main.js 5`ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/run-main-file-in-node.png)\n\nç»“æœæ˜¯ `120`ï¼Œç¬¦åˆé¢„æœŸã€‚ä½†æ˜¯ä¸€ä¸ªä¾‹å­å¹¶ä¸èƒ½è¯´æ˜ä»€ä¹ˆï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹è´Ÿæ•°ã€éæ•°å­—ã€å°æ•°ã€å¾ˆå¤§çš„æ•°ç­‰è¿›è¡ŒéªŒè¯ï¼Œåœ¨é€æ­¥çš„éªŒè¯è¿‡ç¨‹ä¸­ï¼Œä»£ç ä¸­çš„ä¸è¶³ä¹Ÿä¼šé€æ¸æš´éœ²å‡ºæ¥ã€‚æ‰€ä»¥æ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿›è¡Œ**æµ‹è¯•é©±åŠ¨å¼€å‘**ï¼ˆTest-Driven Development, TDDï¼‰ï¼Œé€šè¿‡ä¸æ–­çš„æµ‹è¯•æ¥å®Œå–„ä»£ç ã€‚\n\n## ç¼–å†™æµ‹è¯•æ–‡ä»¶\n\né¦–å…ˆï¼Œåœ¨ `main.js` æ–‡ä»¶æœ€åæ·»åŠ ä»£ç ï¼š\n\n```js\nexports.factorial = factorial;\n```\n\nè¿™æ®µä»£ç çš„ä½œç”¨æ˜¯å°† `factorial` å‡½æ•°æš´éœ²å‡ºå»ï¼Œè¿™æ ·æ‰å¯ä»¥åœ¨å…¶ä»–æ–‡ä»¶ä¸­ `require` è¿™ä¸ªå‡½æ•°ã€‚\n\né€šå¸¸ï¼Œæµ‹è¯•æ–‡ä»¶ä¸æ‰€è¦æµ‹è¯•çš„æºæ–‡ä»¶åŒåï¼Œä½†æ˜¯åç¼€åä¸º `.test.js`ï¼ˆè¡¨ç¤ºæµ‹è¯•ï¼‰æˆ– `.spec.js`ï¼ˆè¡¨ç¤ºè§„æ ¼ï¼‰ã€‚ä¾‹å¦‚ï¼Œ`main.js` çš„æµ‹è¯•æ–‡ä»¶å°±æ˜¯ `main.test.js`ï¼š\n\n```js\n// main.test.js\n\nvar main = require('../src/main');\nvar should = require('should');\n\ndescribe('test/main.js', function() {\n  it('should equal 1 when n === 0', function() {\n    should(main.factorial(0)).equal(1);\n  });\n});\n```\n\nä¸Šé¢çš„ä»£ç ä¸­ï¼š\n\n- `describe` å—ç§°ä¸ºâ€œæµ‹è¯•å¥—ä»¶ï¼ˆtest suiteï¼‰â€ï¼Œè¡¨ç¤ºä¸€ç»„ç›¸å…³çš„æµ‹è¯•ã€‚å®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•å¥—ä»¶çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®é™…æ‰§è¡Œçš„å‡½æ•°ã€‚\n\n- `it` å—ç§°ä¸ºâ€œæµ‹è¯•ç”¨ä¾‹ï¼ˆtest caseï¼‰â€ï¼Œè¡¨ç¤ºä¸€ä¸ªå•ç‹¬çš„æµ‹è¯•ï¼Œæ˜¯æµ‹è¯•çš„æœ€å°å•ä½ã€‚å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æµ‹è¯•ç”¨ä¾‹çš„åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå®é™…æ‰§è¡Œçš„å‡½æ•°ã€‚\n\nä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ä¸­ï¼Œå¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª `describe` å—ï¼Œä¸€ä¸ª `describe` å—ä¸­å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ª `it` å—ã€‚\n\næƒ³è¦è¿è¡Œè¿™ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œéœ€è¦å®‰è£…ä¾èµ– Mocha å’Œ Shouldï¼š\n\n```bash\n$ npm install --save-dev mocha should\n```\n\nç„¶åï¼Œåœ¨ `package.json` ä¸­æ–°å»ºä¸€æ¡ NPM æŒ‡ä»¤ï¼š\n\n```json\n...\n\"scripts\": {\n  \"test\": \"./node_modules/.bin/mocha ./test/main.test.js\"\n}\n...\n```\n\nè¯¥æŒ‡ä»¤çš„ä½œç”¨å°±æ˜¯ï¼šä½¿ç”¨å®‰è£…åœ¨é¡¹ç›®ç›®å½•ä¸­çš„ Mocha å‘½ä»¤ `./node_modules/.bin/mocha` æ¥æµ‹è¯• `./test/main.test.js` æ–‡ä»¶ã€‚\n\næ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤ `npm run test`ï¼Œç»“æœå¦‚ä¸‹ï¼ˆå¯ä»¥çœ‹åˆ°æµ‹è¯•é€šè¿‡ï¼‰ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/mocha-test-one-case.png)\n\nåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±ä½¿ç”¨æµ‹è¯•æ¡†æ¶ + æ–­è¨€åº“ï¼Œä½“éªŒäº†åŸºæœ¬çš„å•å…ƒæµ‹è¯•æµç¨‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡ä¸æ–­å®Œå–„æµ‹è¯•ç”¨ä¾‹ï¼Œæ¥ä½¿ä»£ç å¥å£®èµ·æ¥ã€‚\n\n## å®Œå–„æµ‹è¯•ç”¨ä¾‹\n\né¦–å…ˆï¼Œæ˜ç¡®å‡½æ•°åŠŸèƒ½ã€‚æˆ‘ä»¬çš„ `factorial` å‡½æ•°åº”è¯¥æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š\n\n- å½“ `n === 0` æ—¶ï¼Œè¿”å› `1`ã€‚\n- å½“ `n > 0` æ—¶ï¼Œè¿”å› `factorial(n - 1) * n`ã€‚\n- å½“ `n < 0` æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸ºæ²¡æœ‰æ„ä¹‰ã€‚\n- å½“ `n` ä¸æ˜¯æ•°å­—æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ã€‚\n- å½“ `n > 10` æ—¶ï¼ŒæŠ›å‡ºé”™è¯¯ï¼ˆæœ¬æ–‡ä¸ºäº†æ¼”ç¤ºï¼Œåªè¿›è¡Œ `10` ä»¥å†…çš„é˜¶ä¹˜è¿ç®—ï¼‰ã€‚\n\nç„¶åï¼Œæˆ‘ä»¬æ ¹æ®ç¡®å®šå¥½çš„åŠŸèƒ½æ¥å®Œå–„æµ‹è¯•ç”¨ä¾‹ï¼š\n\n```js\nvar main = require('../src/main');\nvar should = require('should');\n\ndescribe('test/main.js', function() {\n  it('should equal 1 when n === 0', function() {\n    should(main.factorial(0)).equal(1);\n  });\n\n  it('should equal 1 when n === 1', function() {\n    should(main.factorial(1)).equal(1);\n  });\n\n  it('should equal 3628800 when n === 10', function() {\n    should(main.factorial(10)).equal(3628800);\n  });\n\n  it('should throw when n > 10', function() {\n    (function() {\n      main.factorial(11);\n    }.should.throw('n should <= 10'));\n  });\n\n  it('should throw when n < 0', function() {\n    (function() {\n      main.factorial(-1);\n    }.should.throw('n should >= 0'));\n  });\n\n  it('should throw when n is not Number', function() {\n    (function() {\n      main.factorial('123');\n    }.should.throw('n should be a Number'));\n  });\n});\n```\n\næ‰§è¡Œæµ‹è¯•æŒ‡ä»¤ `npm run test`ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/mocha-test-some-case-1.png)\n\nå¯ä»¥çœ‹åˆ°åé¢ä¸‰ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æ²¡æœ‰é€šè¿‡ï¼Œè¿™è¯´æ˜ `factorial` å‡½æ•°å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´æ–° `factorial` çš„å®ç°ï¼š\n\n```js\nvar factorial = function(n) {\n  if (typeof n !== 'number') {\n    throw new Error('n should be a Number');\n  }\n\n  if (n < 0) {\n    throw new Error('n should >= 0');\n  }\n\n  if (n > 10) {\n    throw new Error('n should <= 10');\n  }\n\n  if (n === 0) {\n    return 1;\n  }\n\n  return factorial(n - 1) * n;\n};\n```\n\nå†æ¬¡æ‰§è¡Œæµ‹è¯•æŒ‡ä»¤ `npm run test`ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/mocha-test-some-case-2.png)\n\nå¯ä»¥çœ‹åˆ°ï¼Œæ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹éƒ½é€šè¿‡äº†ï¼Œè¿™è¯æ˜ `factorial` å‡½æ•°çš„åŠŸèƒ½å·²ç»ç¬¦åˆäº†æˆ‘ä»¬çš„é¢„æœŸè¦æ±‚ï¼Œè€Œä¸”ä»£ç å¥å£®æ€§æœ‰äº†å¾ˆå¤§çš„æé«˜ã€‚\n\nä»¥ä¸Šå°±æ˜¯ TDD çš„åŸºæœ¬æµç¨‹ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯ï¼š**é¦–å…ˆæ˜ç¡®ç¨‹åºçš„åŠŸèƒ½ï¼Œç„¶åè·‘æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚æœæµ‹è¯•ç”¨ä¾‹æ²¡æœ‰é€šè¿‡ï¼Œä¿®æ”¹ç¨‹åºï¼Œç›´åˆ°æµ‹è¯•ç”¨ä¾‹é€šè¿‡**ã€‚\n\n## ç”Ÿæˆè¦†ç›–ç‡\n\nå¦‚æœä½ æƒ³çŸ¥é“æµ‹è¯•ç”¨ä¾‹æ˜¯å¦åˆç†ï¼Œå¯ä»¥ç”¨â€œä»£ç è¦†ç›–ç‡â€æ¥åˆ¤æ–­ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¦‚æœæµ‹è¯•ç”¨ä¾‹å†™çš„åˆç†ï¼Œé‚£ä¹ˆä»£ç è¦†ç›–ç‡è¶Šé«˜è¶Šå¥½ï¼Œä½†ä¸æ˜¯ç»å¯¹çš„ã€‚\n\nä»£ç è¦†ç›–ç‡åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\n\n- **è¡Œè¦†ç›–ç‡**ï¼šæ˜¯å¦æ¯ä¸€è¡Œéƒ½æ‰§è¡Œäº†\n- **å‡½æ•°è¦†ç›–ç‡**ï¼šæ˜¯å¦æ¯ä¸ªå‡½æ•°éƒ½è°ƒç”¨äº†\n- **åˆ†æ”¯è¦†ç›–ç‡**ï¼šæ˜¯å¦æ¯ä¸ª `if` ä»£ç å—éƒ½æ‰§è¡Œäº†\n- **è¯­å¥è¦†ç›–ç‡**ï¼šæ˜¯å¦æ¯ä¸ªè¯­å¥éƒ½æ‰§è¡Œäº†\n\nç”Ÿæˆä»£ç è¦†ç›–ç‡ï¼Œéœ€è¦ç”¨åˆ°æ’ä»¶ Istanbulï¼Œé¦–å…ˆå°†å…¶å®‰è£…ï¼š\n\n```bash\n$ npm install --save-dev istanbul\n```\n\nç„¶åï¼Œåœ¨ `package.json` ä¸­æ–°å»ºä¸€æ¡ NPM æŒ‡ä»¤ï¼Œç”¨äºç”Ÿæˆè¦†ç›–ç‡ï¼š\n\n```json\n...\n\"scripts\": {\n  \"coverage\": \"./node_modules/.bin/istanbul cover ./node_modules/mocha/bin/_mocha\"\n}\n...\n```\n\n> æ³¨æ„ï¼ŒæŒ‡ä»¤ä¸­ `_mocha` çš„ä¸‹åˆ’çº¿ä¸èƒ½çœç•¥ã€‚å› ä¸ºï¼Œ`mocha` å’Œ `_mocha` æ˜¯ä¸¤ä¸ªä¸åŒçš„å‘½ä»¤ï¼Œå‰è€…ä¼šæ–°å»ºä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œæµ‹è¯•ï¼Œè€Œåè€…æ˜¯åœ¨å½“å‰è¿›ç¨‹ï¼ˆå³ Istanbul æ‰€åœ¨çš„è¿›ç¨‹ï¼‰æ‰§è¡Œæµ‹è¯•ï¼Œåªæœ‰è¿™æ ·ï¼Œ Istanbul æ‰ä¼šæ•æ‰åˆ°è¦†ç›–ç‡æ•°æ®ã€‚å…¶ä»–æµ‹è¯•æ¡†æ¶ä¹Ÿæ˜¯å¦‚æ­¤ï¼Œå¿…é¡»åœ¨åŒä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œæµ‹è¯•ã€‚\n\næ‰§è¡Œè¿™ä¸ªæŒ‡ä»¤ `npm run coverage`ï¼Œç»“æœå¦‚ä¸‹ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/code-coverage-in-cli-1.png)\n\nå°† `coverage/lcov-report` ç›®å½•ä¸‹çš„ `index.html` æ–‡ä»¶åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œå¯ä»¥æŸ¥çœ‹å…·ä½“çš„è¦†ç›–ç‡ã€‚å¦‚å›¾æ‰€ç¤ºï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/code-coverage-in-browser.png)\n\nå…¶å®ï¼Œè¿™æ¬¡çš„è¦†ç›–ç‡åº”è¯¥æ˜¯ 100%ï¼Œå› ä¸ºå‡½æ•°åœ¨è¢«å…¶ä»–æ–‡ä»¶å¼•ç”¨æ—¶ 24ã€25 è¿™ä¸¤è¡Œä¸ä¼šæ‰§è¡Œï¼Œæ‰€ä»¥æ²¡æ³•æµ‹ã€‚ç”±äºè¿™ä¸¤è¡Œä»£ç ä»…ä»…æ˜¯ä¸ºäº†åˆšå¼€å§‹æ–¹ä¾¿æ¼”ç¤ºç”¨ï¼Œä¹‹åæˆ‘ä»¬å°±ä¸åœ¨å‘½ä»¤è¡Œä¸­æµ‹è¯•äº†ï¼Œæ‰€ä»¥ç›´æ¥å°†è¿™ä¸¤è¡Œè¯­å¥æ‰€åœ¨çš„ `if` å—åˆ é™¤å³å¯ã€‚\n\nå†æ¬¡æ‰§è¡Œæµ‹è¯•æŒ‡ä»¤ï¼Œå°±å¾—åˆ°äº† 100% çš„è¦†ç›–ç‡ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/code-coverage-in-cli-2.png)\n\n## ä¸Šä¼ è¦†ç›–ç‡\n\næƒ³è¦å±•ç¤ºæµ‹è¯•è¦†ç›–ç‡ï¼Œæœ‰ä¸¤ä¸ªç½‘ç«™å¯ä¾›é€‰æ‹©ï¼š[Codecov](https://codecov.io/) å’Œ [Coveralls](https://coveralls.io/)ã€‚æœ¬æ–‡ä»¥ Codecov ä¸ºä¾‹ã€‚\n\né¦–å…ˆï¼Œæ‰“å¼€ Codecov å®˜ç½‘ï¼Œç»‘å®š Github è´¦å·ä¹‹åï¼Œé€‰æ‹©è¦å±•ç¤ºæµ‹è¯•è¦†ç›–ç‡çš„ä»“åº“ã€‚\n\nç„¶åï¼Œå®‰è£… Codecovï¼š\n\n```bash\n$ npm install --save-dev codecov\n```\n\næ¥ç€ï¼Œåœ¨ `package.json` ä¸­æ–°å»ºä¸€æ¡ NPM æŒ‡ä»¤ï¼Œæ¥ä¸Šä¼ æµ‹è¯•è¦†ç›–ç‡ï¼š\n\n```json\n...\n\"script\": {\n  \"codecov\": \"cat ./coverage/lcov.info | ./node_modules/.bin/codecov\"\n}\n...\n```\n\n> å…¶ä¸­ `cat ./coverage/lcov.info` ç”¨äºè¯»å– `coverage` ç›®å½•ä¸‹çš„ `lcov.info` æ–‡ä»¶ï¼Œ`./node_modules/.bin/codecov` ç”¨äºå°†è¦†ç›–ç‡ä¸Šä¼ åˆ° Codecov ç½‘ç«™ã€‚\n\nè¯¥æŒ‡ä»¤åœ¨æ¥ä¸‹æ¥é…ç½® CIï¼ˆContinuous integration, æŒç»­é›†æˆï¼‰æ—¶ä¼šç”¨åˆ°ã€‚\n\n## æŒç»­é›†æˆ\n\nå¦‚æœæ¯æ¬¡ä¿®æ”¹ä»£ç ä¹‹åï¼Œéƒ½æ‰‹åŠ¨è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œä¸ä»…åŠ é‡å·¥ä½œé‡ï¼Œè€Œä¸”å®¹æ˜“å‡ºé”™ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè¿™å°±ç”¨åˆ°äº†æŒç»­é›†æˆã€‚\n\næŒç»­é›†æˆæ˜¯ä¸€ç§è½¯ä»¶å¼€å‘å®è·µï¼Œæ¯æ¬¡é›†æˆéƒ½é€šè¿‡è‡ªåŠ¨åŒ–çš„æ„å»ºï¼ˆåŒ…æ‹¬ç¼–è¯‘ï¼Œå‘å¸ƒï¼Œæµ‹è¯•ç­‰ï¼‰æ¥éªŒè¯ï¼Œä»è€Œå°½æ—©åœ°å‘ç°ä»£ç ä¸­çš„é”™è¯¯ã€‚\n\nå¯ä¾›é€‰æ‹©çš„æŒç»­é›†æˆå·¥å…·æœ‰ [Travis CI](https://travis-ci.org/) å’Œ [Circle CI](https://circleci.com/)ã€‚æœ¬æ–‡ä»¥ Travis CI ä¸ºä¾‹ã€‚\n\n### ä½¿ç”¨ Travis CI\n\né¦–å…ˆï¼ŒTravis CI è¿›å…¥å®˜ç½‘åï¼Œç‚¹å‡» Sign In æŒ‰é’®ç»‘å®š Githubã€‚ç„¶ååœ¨ä»“åº“åˆ—è¡¨ä¸­é€‰æ‹©ä½ è¦è¿›è¡ŒæŒç»­é›†æˆçš„ä»“åº“ï¼Œç‚¹å‡»æŒ‰é’®å¯ç”¨ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/travis-ci-settings.png)\n\nç„¶åï¼Œä½ éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `.travis.yml` æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼ŒTravis CI ä¼šé»˜è®¤æ‰§è¡Œ `npm install` å’Œ `npm test`ï¼‰ï¼Œé…ç½®æ–‡ä»¶ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```yml\n# è¦ä½¿ç”¨çš„è¯­è¨€\nlanguage: node_js\n\n# è¦ä½¿ç”¨çš„è¯­è¨€ç‰ˆæœ¬\nnode_js:\n  - 10\n\n# ç¼“å­˜ NPM ä¾èµ–ï¼ŒåŠ å¿«æ„å»º\ncache:\n  directories:\n    - node_modules\n\n# å®‰è£…ä¾èµ–\ninstall:\n  - npm install\n\n# æ‰§è¡ŒæŒ‡ä»¤\nscript:\n  - npm run coverage\n\n# æŒ‡ä»¤æ‰§è¡ŒæˆåŠŸå\nafter_success:\n  - npm run codecov\n\n# æŒ‡å®šåˆ†æ”¯\nbranches:\n  only:\n    - master\n```\n\næœ€åï¼Œå°†æ‰€æœ‰ä¿®æ”¹æäº¤åˆ°è¿œç¨‹ä»“åº“çš„ master åˆ†æ”¯ä¸Šï¼Œå°±å¯ä»¥çœ‹åˆ° Travis CI æ­£åœ¨è‡ªåŠ¨æ„å»ºã€‚\n\n### å±•ç¤ºå¾½ç« \n\nå½“ CI æ„å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è®¿é—® Travis CI å’Œ Codecov çš„ç½‘ç«™æŸ¥çœ‹åˆ°è¯¦ç»†ç»“æœï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†ç»“æœä»¥å¾½ç« çš„å½¢å¼æ”¾å…¥ READMEï¼Œè¿™æ ·æ›´æ¸…æ™°æ˜äº†ã€‚\n\nTravis CI çš„å¾½ç« è¿™æ ·è·å–ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/travis-badge.png)\n\nCodecov çš„å¾½ç« è¿™æ ·è·å–ï¼š\n\n![](/assets/posts/front-end-unit-test-and-ci/codecov-badge.png)\n\næ¯å½“ CI æ„å»ºå®Œæˆï¼Œç»“æœå°±ä¼šä»¥å¾½ç« çš„å½¢å¼ï¼Œå±•ç¤ºåœ¨ä½ çš„é¡¹ç›®æ–‡æ¡£ä¸­ã€‚\n\n---\n\nå‚è€ƒèµ„æ–™ï¼š\n\n- [ã€ŠNode.js åŒ…æ•™ä¸åŒ…ä¼šã€‹æµ‹è¯•ç”¨ä¾‹ï¼šmochaï¼Œshouldï¼Œistanbul](https://github.com/alsotang/node-lessons/tree/master/lesson6)\n","tags":["å•å…ƒæµ‹è¯•","æŒç»­é›†æˆ","Github å¾½ç« "],"categories":["å‰ç«¯è‡ªåŠ¨åŒ–"]}]